!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("socket.io-client")):"function"==typeof define&&define.amd?define(["exports","socket.io-client"],t):t(e.create_whiteboard={},e.io)}(this,function(exports,socket){"use strict";socket=socket&&socket.hasOwnProperty("default")?socket.default:socket;var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var commands=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){}return i.parse=function(e){var t={command:""},r={str:i.trimLeft(e),token:""};for(i.lexical(r),t.command=r.token;i.lexical(r),""!==r.token;){var n=r.token.split("=");if(1===n.length)t[n[0]]=!0;else{var o=n[1];1<o.length&&"["===o.charAt(0)&&"]"===o.charAt(o.length-1)&&(o=o.substr(1,o.length-2).split(",")),t[n[0]]=o}}return t},i.trimLeft=function(e){for(var t=0;t<e.length&&0<=" \n\r\t\f\v            ​\u2028\u2029　".indexOf(e.charAt(t));)t++;return e.substring(t,e.length-t)},i.trimRight=function(e){for(var t=e.length-1;0<=t&&0<=" \n\r\t\f\v            ​\u2028\u2029　".indexOf(e.charAt(t));)t--;return e.substring(0,t+1)},i.trim=function(e){return this.trimRight(this.trimLeft(e))},i.lexical=function(e){for(var t=" \n\r\t\f\v            ​\u2028\u2029　",r=0;r<e.str.length&&0<=t.indexOf(e.str.charAt(r));)r++;for(e.str=e.str.substr(r,e.str.length-r),r=0;r<e.str.length&&t.indexOf(e.str.charAt(r))<0;)r++;e.token=e.str.substr(0,r),e.str=e.str.substr(r,e.str.length-r)},i}();t.WBCommandParser=r});unwrapExports(commands);var commands_1=commands.WBCommandParser,toolbox=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function s(e,t,r){this._container=e,this._wb=t,this._tools=[],this._curTool=null,this._direction=r,this._strokeColor="#000000",this._fillColor="#ffffff",this.create(this._container)}return s.prototype.create=function(e){(this._container=e).style.display="flex",e.style.flexDirection=this._direction,e.style.flexWrap="wrap",e.style.justifyContent="flex-start",e.style.alignItems="flex-start",e.style.alignContent="flex-start"},s.prototype.loadTools=function(e){var a=this;e.forEach(function(e){a._tools.push(e);var t=parseInt(e.fontSize||"60",10)+10;if("$StrokeColor"===e.activeCommand){var r=document.createElement("input");r.type="color",r.value=a._strokeColor,r.style.width=t+"px",r.style.height=t+"px",r.style.margin="2px",r.onchange=function(){a._strokeColor=r.value},a._container.appendChild(r)}else if("$FillColor"===e.activeCommand){var n=document.createElement("input");n.type="color",n.value=a._fillColor,n.style.width=t+"px",n.style.height=t+"px",n.style.margin="2px",n.onchange=function(){a._fillColor=n.value},a._container.appendChild(n)}else{var o=document.createElement("div");o.classList.add("flex-h","flex-align-x-center","flex-align-y-center"),e.elementId="toolbutton-"+s.uniqueId++,o.classList.add("toolbutton"),o.id=e.elementId,o.style.width=t+"px",o.style.height=t+"px",o.setAttribute("toolIndex",String(a._tools.length-1));var i=document.createElement("i");i.style.fontSize=e.fontSize||"60px",i.style.color="#fff",i.style.lineHeight=e.fontSize||"60px",e.iconClass&&e.iconClass.split(" ").forEach(function(e){i.classList.add(e)}),o.appendChild(i),a._container.appendChild(o),o.addEventListener("click",function(){var e=Number(o.getAttribute("toolIndex")),t=a._tools[e];if(t!==a._curTool&&a._curTool){var r=document.querySelector("#"+a._curTool.elementId);r&&r.classList.remove("active"),a._curTool.deactiveCommand&&a._wb.executeCommand(commands.WBCommandParser.parse(a._curTool.deactiveCommand)),a._curTool=null}if(t){var n=document.querySelector("#"+t.elementId);n&&n.classList.add("active"),a._wb.executeCommand(commands.WBCommandParser.parse(t.activeCommand)),a._curTool=t}})}})},s.prototype.unloadTools=function(){for(;this._container.hasChildNodes();)this._container.removeChild(this._container.firstChild);this._tools=[]},s.uniqueId=1,s}();t.WBEditorToolbox=r});unwrapExports(toolbox);var toolbox_1=toolbox.WBEditorToolbox,point=createCommonjsModule(function(e,t){function r(e){return e.x*e.x+e.y*e.y}function n(e){return Math.sqrt(r(e))}function o(e,t){return{x:t.x-e.x,y:t.y-e.y}}Object.defineProperty(t,"__esModule",{value:!0}),t.GetTopLeft=function(e){return{x:e.x,y:e.y}},t.GetTopRight=function(e){return{x:e.x+e.w,y:e.y}},t.GetBottomLeft=function(e){return{x:e.x,y:e.y+e.h}},t.GetBottomRight=function(e){return{x:e.x+e.w,y:e.y+e.h}},t.Normalize=function(e){var t=n(e);1e-4<t&&(e.x/=t,e.y/=t)},t.VectorLengthSq=r,t.VectorLength=n,t.DistanceSq=function(e,t){return r(o(e,t))},t.Distance=function(e,t){return n(o(e,t))},t.DotProduct=function(e,t){return e.x*t.x+e.y*t.y},t.CrossProduct=function(e,t){return e.x*t.y-e.y*t.x},t.GetVector=o,t.ClampPoint=function(e,t,r){return{x:Math.max(t.x,Math.min(r.x,e.x)),y:Math.max(t.y,Math.min(r.y,e.y))}}});unwrapExports(point);var point_1=point.GetTopLeft,point_2=point.GetTopRight,point_3=point.GetBottomLeft,point_4=point.GetBottomRight,point_5=point.Normalize,point_6=point.VectorLengthSq,point_7=point.VectorLength,point_8=point.DistanceSq,point_9=point.Distance,point_10=point.DotProduct,point_11=point.CrossProduct,point_12=point.GetVector,point_13=point.ClampPoint,boundingshape=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.type=e};t.BoundingShape=r});unwrapExports(boundingshape);var boundingshape_1=boundingshape.BoundingShape,boundinghull=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function n(e){var t=r.call(this,n.type)||this;return t._points=e||[],t._boundingbox=null,t._dirtyFlag=0<t._points.length,t}return o(n,r),n.prototype.addPoint=function(e){this._points.push(e),this._dirtyFlag=!0},Object.defineProperty(n.prototype,"length",{get:function(){return this._points.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundingbox",{get:function(){return this._checkDirty(),this._boundingbox},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"points",{get:function(){return this._checkDirty(),this._points},enumerable:!0,configurable:!0}),n.prototype.getPoint=function(e){return this._checkDirty(),this._points[e]},n.prototype.removePoint=function(e){this._points.splice(e,1),0===this._points.length?(this._boundingbox=null,this._dirtyFlag=!1):this._dirtyFlag=!0},n.prototype.clear=function(){this._points.length=0,this._boundingbox=null,this._dirtyFlag=!1},n.prototype.getBoundingbox=function(){return this.boundingbox},n.prototype.getTransformedShape=function(t){return new n(t?this._points.map(function(e){return t.transformPoint(e)}):this._points)},n.prototype._checkDirty=function(){this._dirtyFlag&&(this._dirtyFlag=!1,this._adjustPoints(),this._computeBoundingbox())},n.prototype._adjustPoints=function(){var e=this._points.length;if(!(e<3)){for(var t=[this._points[0],this._points[1]],r=2;r<e;r++){for(var n=t.length-1;0<n;){var o=point.GetVector(t[0],t[n]),i=point.GetVector(t[0],this._points[r]),a=point.CrossProduct(o,i);if(a<0){t.splice(n+1,0,this._points[r]);break}if(0===a&&point.VectorLengthSq(i)>point.VectorLengthSq(o)){t.splice(n+1,0,this._points[r]);break}n--}0===n&&t.splice(1,0,this._points[r])}this._points=t}},n.prototype._computeBoundingbox=function(){if(0<this._points.length){var n=this._points[0].x,o=this._points[0].y,i=n,a=o;this._points.forEach(function(e){var t=e.x,r=e.y;t<n?n=t:i<t&&(i=t),r<o?o=r:a<r&&(a=r)}),this._boundingbox={x:n,y:o,w:i-n+1,h:a-o+1}}else this._boundingbox=null},n.type="Hull",n}(boundingshape.BoundingShape);t.BoundingHull=r});unwrapExports(boundinghull);var boundinghull_1=boundinghull.BoundingHull,boundingbox=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function i(e){var t=r.call(this,i.type)||this;return t.rect=e||null,t}return o(i,r),i.prototype.getBoundingbox=function(){return this.rect},i.prototype.getTransformedShape=function(e){if(null===this.rect)return null;if(e){var t={x:this.rect.x,y:this.rect.y},r={x:this.rect.x,y:this.rect.y+this.rect.h-1},n={x:this.rect.x+this.rect.w-1,y:this.rect.y+this.rect.h-1},o={x:this.rect.x+this.rect.w-1,y:this.rect.y};return new boundinghull.BoundingHull([e.transformPoint(t),e.transformPoint(r),e.transformPoint(n),e.transformPoint(o)])}return new i(this.rect)},i.type="Box",i}(boundingshape.BoundingShape);t.BoundingBox=r});unwrapExports(boundingbox);var boundingbox_1=boundingbox.BoundingBox,boundingsegment=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function n(e){var t=r.call(this,n.type)||this;return t._segment=e||null,t._dirty=!!e,t._boundingbox=null,t}return o(n,r),Object.defineProperty(n.prototype,"start",{get:function(){return this._segment?this._segment.start:null},set:function(e){e&&(this._segment?this._segment.start=e:this._segment={start:e,end:e},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"end",{get:function(){return this._segment?this._segment.end:null},set:function(e){e&&(this._segment?this._segment.end=e:this._segment={start:e,end:e},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"segment",{get:function(){return this._segment?{start:this.start,end:this.end}:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundingbox",{get:function(){return this._checkDirty(),this._boundingbox},enumerable:!0,configurable:!0}),n.prototype.getBoundingbox=function(){return this.boundingbox},n.prototype.getTransformedShape=function(e){return e&&this._segment?new n({start:e.transformPoint(this._segment.start),end:e.transformPoint(this._segment.end)}):this._segment?new n(this._segment):null},n.prototype._checkDirty=function(){if(this._segment&&this._dirty){this._dirty=!1;var e=this._segment.start.x,t=this._segment.start.y,r=this._segment.end.x,n=this._segment.end.y;if(r<e){var o=e;e=r,r=o}if(n<t){o=t;t=n,n=o}this._boundingbox={x:e,y:t,w:r-e+1,h:n-t+1}}},n.type="Segment",n}(boundingshape.BoundingShape);t.BoundingSegment=r});unwrapExports(boundingsegment);var boundingsegment_1=boundingsegment.BoundingSegment,boundingsphere=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function s(e){var t=r.call(this,s.type)||this;return t._sphere=e||null,t._dirty=!!t._sphere,t._boundingbox=null,t}return o(s,r),Object.defineProperty(s.prototype,"center",{get:function(){return this._sphere?this._sphere.center:null},set:function(e){e&&(this._sphere?this._sphere.center=e:this._sphere={center:e,radius:1},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"radius",{get:function(){return this._sphere?this._sphere.radius:null},set:function(e){null!==e&&(this._sphere?this._sphere.radius=e:this._sphere={center:{x:0,y:0},radius:e},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sphere",{get:function(){return this._sphere?{center:this._sphere.center,radius:this._sphere.radius}:null},set:function(e){this._sphere=e,this._dirty=!!e,this._boundingbox=null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"boundingbox",{get:function(){return this._checkDirty(),this._boundingbox},enumerable:!0,configurable:!0}),s.prototype.getBoundingbox=function(){return this.boundingbox},s.prototype.getTransformedShape=function(e){if(e&&this._sphere){for(var t=.125*Math.PI,r=2*t,n=this._sphere.radius/Math.cos(t),o=new boundinghull.BoundingHull,i=t;i<2*Math.PI;i+=r){var a=e.transformPoint({x:n*Math.cos(i),y:n*Math.sin(i)});a.x=Math.round(a.x),a.y=Math.round(a.y),o.addPoint(a)}return o}return this._sphere?new s(this._sphere):null},s.prototype._checkDirty=function(){this._sphere&&this._dirty&&(this._dirty=!1,this._boundingbox={x:this._sphere.center.x-this._sphere.radius+1,y:this._sphere.center.y-this._sphere.radius+1,w:2*this._sphere.radius-1,h:2*this._sphere.radius-1})},s.type="sphere",s}(boundingshape.BoundingShape);t.BoundingSphere=r});unwrapExports(boundingsphere);var boundingsphere_1=boundingsphere.BoundingSphere,intersect=createCommonjsModule(function(e,t){function r(e,t){return!!e&&!!t&&e.x<=t.x+t.w&&e.x+e.w>=t.x&&e.y<=t.y+t.h&&e.y+e.h>=t.y}function n(e,t){return!!e&&!!t&&t.x>=e.x&&t.x<=e.x+e.w&&t.y>=e.y&&t.y<=e.y+e.h}function o(e,t){return!!e&&!!t&&h([point.GetTopLeft(e),point.GetBottomLeft(e),point.GetBottomRight(e),point.GetTopRight(e)],t)}function i(e,t){return e&&t?p([point.GetTopLeft(e),point.GetBottomLeft(e),point.GetBottomRight(e),point.GetTopRight(e)],t):null}function a(e,t){if(!e||!t)return!1;var r=point.ClampPoint(t.center,{x:e.x,y:e.y},{x:e.x+e.w-1,y:e.y+e.h-1}),n=point.GetVector(r,t.center);return point.DotProduct(n,n)<t.radius*t.radius}function s(e,t){if(!e||!t)return!1;for(var r=e.radius*e.radius,n=0;n<t.length;n++){var o=e.center.x-t[n].x,i=e.center.y-t[n].y;if(o*o+i*i<r)return!0}for(n=0;n<t.length;n++){var a=l(e,{start:t[n],end:t[(n+1)%t.length]});if(null!==a&&0<a.length)return!0}return c(t,e.center)}function c(e,t){for(var r=0;r<e.length;r++){var n=point.GetVector(t,e[r]),o=point.GetVector(t,e[(r+1)%e.length]);if(0<point.CrossProduct(n,o))return!1}return!0}function u(e,t){if(!e||!t)return!1;var r=e.center.x-t.center.x,n=e.center.y-t.center.y,o=e.radius+t.radius;return r*r+n*n<o*o}function l(e,t){if(!e||!t)return null;var r=point.GetVector(t.start,t.end),n=point.GetVector(e.center,t.start),o=point.DotProduct(r,r),i=2*point.DotProduct(n,r),a=i*i-4*o*(point.DotProduct(n,n)-e.radius*e.radius);if(a<0)return null;var s=(-i-(a=Math.sqrt(a)))/(2*o),c=(-i+a)/(2*o);if(c<s){var u=s;s=c,c=u}var l=[];return 0<=s&&s<=1&&l.push({x:t.start.x+s*r.x,y:t.start.y+s*r.y}),0<=c&&c<=1&&l.push({x:t.start.x+c*r.x,y:t.start.y+c*r.y}),l}function p(e,r){if(!e||!r)return null;if(c(e,r.start)&&c(e,r.end))return[];for(var t=[],n=0;n<e.length;n++){var o=m({start:e[n],end:e[(n+1)%e.length]},r);o&&t.push(o)}return 1<t.length&&t.sort(function(e,t){return point.DistanceSq(e,r.start)-point.DistanceSq(t,r.start)}),0<t.length?t:null}function h(e,t){for(var u=[e,t],r=0;r<2;r++)for(var l=u[r],n=function(e){var t=l[(e+1)%l.length].x-l[e].x,r=l[(e+1)%l.length].y-l[e].y,n=Math.sqrt(t*t+r*r);if(n<1)return"continue";for(var o=-r/n,i=t/n,a=[{min:9999999,max:-9999999},{min:9999999,max:-9999999}],s=function(r){u[r].forEach(function(e){var t=e.x*o+e.y*i;t<a[r].min&&(a[r].min=t),t>a[r].max&&(a[r].max=t)})},c=0;c<2;c++)s(c);return a[0].min>a[1].max||a[0].max<a[1].min?{value:!1}:void 0},o=0;o<l.length;o++){var i=n(o);if("object"==typeof i)return i.value}return!0}function f(e,t){if(!e||!t)return!1;var r=e.center.x-t.x,n=e.center.y-t.y;return r*r+n*n<e.radius*e.radius}function d(e,t){if(!e||!t)return!1;var r=e.start.x,n=e.start.y,o=e.end.x,i=e.end.y;if(o<r){var a=r;r=o,o=a}if(i<n){a=n;n=i,i=a}if(t.x<r||t.x>o||t.y<n||t.y>i)return!1;if(o!==r){var s=Math.round(n+(i-n)*(t.x-r)/(o-r))-t.y;return-1<=s&&s<=1}if(i===n)return t.x===r&&t.y===n;var c=Math.round(r+(o-r)*(t.y-n)/(i-n))-t.x;return-1<=c&&c<=1}function m(e,t){function r(e,t){return 0<=e&&0<=t||e<=0&&t<=0}if(!e||!t)return null;var n,o,i,a,s,c=e.start.x,u=e.start.y,l=e.end.x,p=e.end.y,h=t.start.x,f=t.start.y,d=t.end.x,m=t.end.y,y=l-c,g=h-d;if(y<0?(n=l,o=c):(o=l,n=c),0<g){if(o<d||h<n)return null}else if(o<h||d<n)return null;var v=p-u,b=f-m;if(v<0?(i=p,a=u):(a=p,i=u),0<b){if(a<m||f<i)return null}else if(a<f||m<i)return null;var _=c-h,w=u-f,x=v*g-y*b;if(0===x)return null;var P=b*_-g*w;if(0<x){if(P<0||x<P)return null}else if(0<P||P<x)return null;var k=y*w-v*_;if(0<x){if(k<0||x<k)return null}else if(0<k||k<x)return null;return{x:c+(((s=P*y)+(r(s,x)?x/2:-x/2))/x>>0),y:u+(((s=P*v)+(r(s,x)?x/2:-x/2))/x>>0)}}Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectionTestShapeSegment=function(e,t){if(!e||!t)return null;if(e.getBoundingbox())switch(e.type){case boundingbox.BoundingBox.type:return i(e.rect,t);case boundinghull.BoundingHull.type:return p(e.points,t);case boundingsegment.BoundingSegment.type:var r=m(e.segment,t);return r?[r]:[];case boundingsphere.BoundingSphere.type:return l(e.sphere,t)}return null},t.IntersectionTestShapeBox=function(e,t){if(!e.getBoundingbox())return!1;switch(e.type){case boundingbox.BoundingBox.type:return r(e.rect,t);case boundinghull.BoundingHull.type:return o(t,e.points);case boundingsegment.BoundingSegment.type:return null!=i(t,e.segment);case boundingsphere.BoundingSphere.type:return a(t,e.sphere);default:return!1}},t.IntersectionTestShapeHull=function(e,t){if(!e.getBoundingbox())return!1;switch(e.type){case boundingbox.BoundingBox.type:return o(e.rect,t);case boundinghull.BoundingHull.type:return h(e.points,t);case boundingsegment.BoundingSegment.type:return null!=p(t,e.segment);case boundingsphere.BoundingSphere.type:return s(e.sphere,t);default:return!1}},t.IntersectionTestShapePoint=function(e,t){if(!n(e.getBoundingbox(),t))return!1;switch(e.type){case boundingbox.BoundingBox.type:return!0;case boundinghull.BoundingHull.type:return c(e.points,t);case boundingsegment.BoundingSegment.type:return d(e.segment,t);case boundingsphere.BoundingSphere.type:return f(e.sphere,t);default:return!1}},t.IntersectionTestShapeShape=function(e,t){if(!r(e.getBoundingbox(),t.getBoundingbox()))return!1;switch(e.type){case boundingbox.BoundingBox.type:switch(t.type){case boundingbox.BoundingBox.type:return!0;case boundinghull.BoundingHull.type:return o(e.rect,t.points);case boundingsegment.BoundingSegment.type:return null!=i(e.rect,t.segment);case boundingsphere.BoundingSphere.type:return a(e.rect,t.sphere);default:return!1}case boundinghull.BoundingHull.type:switch(t.type){case boundingbox.BoundingBox.type:return o(t.rect,e.points);case boundinghull.BoundingHull.type:return h(e.points,t.points);case boundingsegment.BoundingSegment.type:return null!=p(e.points,t.segment);case boundingsphere.BoundingSphere.type:return s(t.sphere,e.points);default:return!1}case boundingsegment.BoundingSegment.type:switch(t.type){case boundingbox.BoundingBox.type:return null!=i(t.rect,e.segment);case boundinghull.BoundingHull.type:return null!=p(t.points,e.segment);case boundingsegment.BoundingSegment.type:return null!=m(t.segment,e.segment);case boundingsphere.BoundingSphere.type:return null!=l(t.sphere,e.segment);default:return!1}case boundingsphere.BoundingSphere.type:switch(t.type){case boundingbox.BoundingBox.type:return a(t.rect,e.sphere);case boundinghull.BoundingHull.type:return s(e.sphere,t.points);case boundingsegment.BoundingSegment.type:return null!=l(e.sphere,t.segment);case boundingsphere.BoundingSphere.type:return u(e.sphere,t.sphere);default:return!1}default:return!1}},t.IntersectionTestBoxBox=r,t.IntersectionTestBoxPoint=n,t.IntersectionTestBoxHull=o,t.IntersectionTestBoxSegment=i,t.IntersectionTestBoxSphere=a,t.IntersectionTestSphereHull=s,t.IntersectionTestHullPoint=c,t.IntersectionTestSphereSphere=u,t.IntersectionTestSphereSegment=l,t.IntersectionTestHullSegment=p,t.IntersectionTestHullHull=h,t.IntersectionTestSpherePoint=f,t.IntersectionTestSegmentPoint=d,t.IntersectionTestSegmentSegment=m});unwrapExports(intersect);var intersect_1=intersect.IntersectionTestShapeSegment,intersect_2=intersect.IntersectionTestShapeBox,intersect_3=intersect.IntersectionTestShapeHull,intersect_4=intersect.IntersectionTestShapePoint,intersect_5=intersect.IntersectionTestShapeShape,intersect_6=intersect.IntersectionTestBoxBox,intersect_7=intersect.IntersectionTestBoxPoint,intersect_8=intersect.IntersectionTestBoxHull,intersect_9=intersect.IntersectionTestBoxSegment,intersect_10=intersect.IntersectionTestBoxSphere,intersect_11=intersect.IntersectionTestSphereHull,intersect_12=intersect.IntersectionTestHullPoint,intersect_13=intersect.IntersectionTestSphereSphere,intersect_14=intersect.IntersectionTestSphereSegment,intersect_15=intersect.IntersectionTestHullSegment,intersect_16=intersect.IntersectionTestHullHull,intersect_17=intersect.IntersectionTestSpherePoint,intersect_18=intersect.IntersectionTestSegmentPoint,intersect_19=intersect.IntersectionTestSegmentSegment,curve=createCommonjsModule(function(e,t){var n,c,r,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),(r=c=t.SplineType||(t.SplineType={}))[r.STEP=1]="STEP",r[r.LINEAR=2]="LINEAR",r[r.POLY=3]="POLY";var i=function(){function e(e,t){void 0===t&&(t=!1),this.cp=e,this.clamp=t}return e.prototype.eval=function(e){return 0},e.prototype.evalFirst=function(){return 0<this.cp.length?this.cp[0].y:0},e.prototype.evalLast=function(){return 0<this.cp.length?this.cp[this.cp.length-1].y:0},e}(),u=function(n){function e(e,t){void 0===t&&(t=!1);var r=n.call(this,e,t)||this;return r.h=new Array(e.length-1),r.compute(),r}return o(e,n),e.prototype.compute=function(){for(var e=0;e<this.cp.length-1;++e)this.h[e]=this.cp[e+1].x-this.cp[e].x},e.prototype.getSegment=function(e){var t;for(t=0;t<this.cp.length-1&&!(e<this.cp[t+1].x);t++);return t},e.prototype.eval=function(e){if(this.clamp){if(e<0)return this.cp[0].y;if(e>this.cp[this.cp.length-1].x)return this.cp[this.cp.length-1].y}var t=this.getSegment(e);return this.cp[t].y},e}(t.CurveEvaluter=i);t.StepEvaluter=u;var l=function(n){function e(e,t){void 0===t&&(t=!1);var r=n.call(this,e,t)||this;return r.h=new Array(e.length-1),r.cp=e,r.compute(),r}return o(e,n),e.prototype.compute=function(){for(var e=0;e<this.cp.length-1;++e)this.h[e]=this.cp[e+1].x-this.cp[e].x},e.prototype.getSegment=function(e){var t;for(t=0;t<this.cp.length-1&&!(e<this.cp[t+1].x);t++);return t===this.cp.length-1&&t--,t},e.prototype.eval=function(e){if(this.clamp){if(e<0)return this.cp[0].y;if(e>this.cp[this.cp.length-1].x)return this.cp[this.cp.length-1].y}var t=this.getSegment(e),r=e-this.cp[t].x;return this.cp[t].y+(this.cp[t+1].y-this.cp[t].y)*r/this.h[t]},e}(i);t.CoLinearEvaluter=l;var p=function(n){function e(e,t){void 0===t&&(t=!1);var r=n.call(this,e,t)||this;return r.a=new Array(e.length),r.h=new Array(e.length),r.cp=e,r.compute(),r}return o(e,n),e.prototype.solveTridiag=function(e,t,r){for(var n=this.cp.length-2,o=2;o<=n;o++)e[o]/=t[o-1],t[o]-=e[o]*r[o-1],this.a[o]-=this.a[o-1]*e[o];this.a[n]/=t[n];for(o=n-1;1<=o;--o)this.a[o]=(this.a[o]-this.a[o+1]*r[o])/t[o]},e.prototype.compute=function(){var e=this.cp.length,t=new Array(e-1),r=new Array(e-1),n=new Array(e-1);this.a[0]=0,this.a[e-1]=0;for(var o=1;o<e;++o)this.h[o]=this.cp[o].x-this.cp[o-1].x;for(o=1;o<e-1;++o)r[o]=(this.h[o]+this.h[o+1])/3,n[o]=this.h[o+1]/6,t[o]=this.h[o]/6,this.a[o]=(this.cp[o+1].y-this.cp[o].y)/this.h[o+1]-(this.cp[o].y-this.cp[o-1].y)/this.h[o];this.solveTridiag(t,r,n)},e.prototype.getSegment=function(e){var t;for(t=0;t<this.cp.length-1&&!(e<this.cp[t+1].x);t++);return t===this.cp.length-1&&t--,t},e.prototype.eval=function(e){if(this.clamp){if(e<0)return this.cp[0].y;if(e>this.cp[this.cp.length-1].x)return this.cp[this.cp.length-1].y}var t=this.getSegment(e)+1,r=e-this.cp[t-1].x,n=this.h[t]-r;return((-this.a[t-1]/6*(n+this.h[t])*r+this.cp[t-1].y)*n+(-this.a[t]/6*(r+this.h[t])*n+this.cp[t].y)*r)/this.h[t]},e}(i);t.PolynomialsEvaluter=p;var a=function(){function e(e,t,r){void 0===r&&(r=!1),this._evalutors=[],this._array=!1,0<t.length&&("number"==typeof t[0].y?this.initNonArray(e,t,r):this.initArray(e,t,r))}return e.prototype.eval=function(t){if(0<this._evalutors.length){if(this._array){var r=[];return this._evalutors.forEach(function(e){r.push(e.eval(t))}),r}return this._evalutors[0].eval(t)}return 0},e.prototype.evalFirst=function(){if(0<this._evalutors.length){if(this._array){var t=[];return this._evalutors.forEach(function(e){t.push(e.evalFirst())}),t}return this._evalutors[0].evalFirst()}return 0},e.prototype.evalLast=function(){if(0<this._evalutors.length){if(this._array){var t=[];return this._evalutors.forEach(function(e){t.push(e.evalLast())}),t}return this._evalutors[0].evalLast()}return 0},e.prototype.initArray=function(e,t,r){var n=t[0].y.length;if(0<n){for(var o=0;o<n;o++){for(var i=[],a=0;a<t.length;a++){var s=t[a].y.length>o?t[a].y[o]:0;i.push({x:t[a].x,y:s})}switch(e){case c.STEP:this._evalutors.push(new u(i,r));break;case c.LINEAR:this._evalutors.push(new l(i,r));break;case c.POLY:default:this._evalutors.push(new p(i,r))}}this._array=!0}},e.prototype.initNonArray=function(e,t,r){switch(e){case c.STEP:this._evalutors.push(new u(t,r));break;case c.LINEAR:this._evalutors.push(new l(t,r));break;case c.POLY:default:this._evalutors.push(new p(t,r))}this._array=!1},e}();t.Spline=a});unwrapExports(curve);var curve_1=curve.SplineType,curve_2=curve.CurveEvaluter,curve_3=curve.StepEvaluter,curve_4=curve.CoLinearEvaluter,curve_5=curve.PolynomialsEvaluter,curve_6=curve.Spline,keycode=createCommonjsModule(function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.KeyCode||(t.KeyCode={}))[r.kBackspace=8]="kBackspace",r[r.kTab=9]="kTab",r[r.kClear=12]="kClear",r[r.kEnter=13]="kEnter",r[r.kShift=16]="kShift",r[r.kControl=17]="kControl",r[r.kAlt=18]="kAlt",r[r.kPause=19]="kPause",r[r.kCapsLock=20]="kCapsLock",r[r.kEscape=27]="kEscape",r[r.kSpace=32]="kSpace",r[r.kPageUp=33]="kPageUp",r[r.kPageDown=34]="kPageDown",r[r.kEnd=35]="kEnd",r[r.kHome=36]="kHome",r[r.kLeft=37]="kLeft",r[r.kUp=38]="kUp",r[r.kRight=39]="kRight",r[r.kDown=40]="kDown",r[r.kSelect=41]="kSelect",r[r.kPrint=42]="kPrint",r[r.kExecute=43]="kExecute",r[r.kInsert=45]="kInsert",r[r.kDelete=46]="kDelete",r[r.kHelp=47]="kHelp",r[r.k0=48]="k0",r[r.k1=49]="k1",r[r.k2=50]="k2",r[r.k3=51]="k3",r[r.k4=52]="k4",r[r.k5=53]="k5",r[r.k6=54]="k6",r[r.k7=55]="k7",r[r.k8=56]="k8",r[r.k9=57]="k9",r[r.kA=65]="kA",r[r.kB=66]="kB",r[r.kC=67]="kC",r[r.kD=68]="kD",r[r.kE=69]="kE",r[r.kF=70]="kF",r[r.kG=71]="kG",r[r.kH=72]="kH",r[r.kI=73]="kI",r[r.kJ=74]="kJ",r[r.kK=75]="kK",r[r.kL=76]="kL",r[r.kM=77]="kM",r[r.kN=78]="kN",r[r.kO=79]="kO",r[r.kP=80]="kP",r[r.kQ=81]="kQ",r[r.kR=82]="kR",r[r.kS=83]="kS",r[r.kT=84]="kT",r[r.kU=85]="kU",r[r.kV=86]="kV",r[r.kW=87]="kW",r[r.kX=88]="kX",r[r.kY=89]="kY",r[r.kZ=90]="kZ",r[r.kLeftMeta=91]="kLeftMeta",r[r.kRightMeta=92]="kRightMeta",r[r.kMenu=93]="kMenu",r[r.kKP0=96]="kKP0",r[r.kKP1=97]="kKP1",r[r.kKP2=98]="kKP2",r[r.kKP3=99]="kKP3",r[r.kKP4=100]="kKP4",r[r.kKP5=101]="kKP5",r[r.kKP6=102]="kKP6",r[r.kKP7=103]="kKP7",r[r.kKP8=104]="kKP8",r[r.kKP9=105]="kKP9",r[r.kKPMul=106]="kKPMul",r[r.kKPAdd=107]="kKPAdd",r[r.kKPSep=108]="kKPSep",r[r.kKPSub=109]="kKPSub",r[r.kKPDec=110]="kKPDec",r[r.kKPDiv=111]="kKPDiv",r[r.kF1=112]="kF1",r[r.kF2=113]="kF2",r[r.kF3=114]="kF3",r[r.kF4=115]="kF4",r[r.kF5=116]="kF5",r[r.kF6=117]="kF6",r[r.kF7=118]="kF7",r[r.kF8=119]="kF8",r[r.kF9=120]="kF9",r[r.kF10=121]="kF10",r[r.kF11=122]="kF11",r[r.kF12=123]="kF12",r[r.kNumLock=144]="kNumLock",r[r.kScrollLock=145]="kScrollLock",r[r.kAdd=187]="kAdd",r[r.kComma=188]="kComma",r[r.kMinus=189]="kMinus",r[r.kPeriod=190]="kPeriod",r[r.kApostrophe=192]="kApostrophe",r[r.kLeftBrace=219]="kLeftBrace",r[r.kRightBrace=221]="kRightBrace",r[r.kBackSlash=220]="kBackSlash",r[r.kQuot=222]="kQuot",r[r.kSemicolon=186]="kSemicolon",r[r.kSlash=191]="kSlash"});unwrapExports(keycode);var keycode_1=keycode.KeyCode,transform=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function n(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}return n.getIdentity=function(){return new n},n.getTranslate=function(e,t){return(new n).makeTranslate(e,t)},n.getScale=function(e,t){return(new n).makeScale(e,t)},n.getRotate=function(e){return(new n).makeRotate(e)},n.transform=function(e,t){return(new n).copyFrom(e).transform(t)},n.translate=function(e,t,r){return(new n).copyFrom(e).translate(t,r)},n.scale=function(e,t,r){return(new n).copyFrom(e).scale(t,r)},n.rotate=function(e,t){return(new n).copyFrom(e).rotate(t)},n.invert=function(e){return(new n).copyFrom(e).invert()},n.prototype.set=function(e,t,r,n,o,i){return this.a=e,this.b=t,this.c=r,this.d=n,this.e=o,this.f=i,this},n.prototype.makeIdentity=function(){return this.set(1,0,0,1,0,0)},n.prototype.makeTranslate=function(e,t){return this.set(1,0,0,1,e,t)},n.prototype.makeScale=function(e,t){return this.set(e,0,0,t,0,0)},n.prototype.makeRotate=function(e){var t=Math.sin(e),r=Math.cos(e);return this.set(r,t,-t,r,0,0)},n.prototype.copyFrom=function(e){return this.set(e.a,e.b,e.c,e.d,e.e,e.f)},n.prototype.transform=function(e){return this.set(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.e+this.c*e.f+this.e,this.b*e.e+this.d*e.f+this.f)},n.prototype.transformPoint=function(e){return{x:Math.round(this.a*e.x+this.c*e.y+this.e),y:Math.round(this.b*e.x+this.d*e.y+this.f)}},n.prototype.translate=function(e,t){return this.transform(n.getTranslate(e,t))},n.prototype.scale=function(e,t){return this.transform(n.getScale(e,t))},n.prototype.rotate=function(e){return this.transform(n.getRotate(e))},n.prototype.invert=function(){var e=this.a,t=this.b,r=this.c,n=this.d,o=this.e,i=this.f,a=1*n-0*i,s=-1*r+0*o,c=i*r-n*o,u=e*a+t*s+0*c;return u&&(u=1/u,this.a=a*u,this.b=(-1*t+0*i)*u,this.c=s*u,this.d=(1*e-0*o)*u,this.e=c*u,this.f=(-i*e+t*o)*u),this},n.prototype.getTranslationPart=function(){return{x:this.e,y:this.f}},n.prototype.setTranslationPart=function(e){this.e=e.x,this.f=e.y},n.prototype.getScalePart=function(){return{x:Math.sqrt(this.a*this.a+this.b*this.b),y:Math.sqrt(this.c*this.c+this.d*this.d)}},n.prototype.setScalePart=function(e){var t=this.getScalePart(),r=e.x/t.x;this.a*=r,this.b*=r;var n=e.y/t.y;this.c*=n,this.d*=n},n.prototype.getRotationPart=function(){var e=Math.sqrt(this.a*this.a+this.b*this.b);if(0===e)return 0;var t=Math.max(Math.min(this.a/e,1),-1),r=Math.max(Math.min(this.b/e,1),-1),n=Math.acos(t);return 0<=r?n:2*Math.PI-n},n.prototype.setRotationPart=function(e){var t=this.getScalePart(),r=Math.sin(e),n=Math.cos(e);this.a=t.x*n,this.b=t.x*r,this.c=-t.y*r,this.d=t.y*n},n}();t.Matrix2d=r});unwrapExports(transform);var transform_1=transform.Matrix2d,core=createCommonjsModule(function(e,t){var n,s,r,h=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),(r=s=t.EventListenerOrder||(t.EventListenerOrder={}))[r.FIRST=1]="FIRST",r[r.LAST=2]="LAST";var o=function(){function e(e){this.type=e,this.eaten=!1}return e.prototype.eat=function(){this.eaten=!0},e}(),i=function(r){function n(e){var t=r.call(this,n.type)||this;return t.object=e,t.allow=!0,t}return h(n,r),n.type="@componentBeforeAttach",n}(t.BaseEvent=o);t.EvtComponentBeforeAttach=i;var a=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@componentAttached",t}(o);t.EvtComponentAttached=a;var c=function(t){function r(){var e=t.call(this,r.type)||this;return e.allow=!0,e}return h(r,t),r.type="@componentBeforeDetach",r}(o);t.EvtComponentBeforeDetach=c;var u=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@componentDetached",t}(o);t.EvtComponentDetached=u;var l=function(o){function i(e,t,r){var n=o.call(this,i.type)||this;return n.deltaTime=e,n.elapsedTime=t,n.frameStamp=r,n}return h(i,o),i.type="@update",i}(o);t.EvtUpdate=l;var p=function(n){function o(e,t){var r=n.call(this,o.type)||this;return r.canvasWidth=e,r.canvasHeight=t,r.result={},r}return h(o,n),o.prototype.addObject=function(e,t,r){var n=this.result[t]||[];n.push({object:e,z:t,transform:r}),this.result[t]=n},o.type="@cull",o}(o);t.EvtCull=p;var f=function(o){function i(e,t,r){var n=o.call(this,i.type)||this;return n.canvas=e,n.z=t,n.transform=r,n}return h(i,o),i.type="@draw",i}(o);t.EvtDraw=f;var d=function(n){function o(e,t){var r=n.call(this,o.type)||this;return r.x=e,r.y=t,r.result=!1,r}return h(o,n),o.type="@hittest",o}(o);t.EvtHitTest=d;var m=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@getboundingshape",t}(o);t.EvtGetBoundingShape=m;var y=function(o){function i(e,t,r){var n=o.call(this,i.type)||this;return n.deltaTime=e,n.elapsedTime=t,n.frameStamp=r,n}return h(i,o),i.type="@frame",i}(o);t.EvtFrame=y;var g=function(r){function n(e){var t=r.call(this,n.type)||this;return t.focus=e,t}return h(n,r),n.type="@focus",n}(o);t.EvtFocus=g;var v=function(c){function e(e,t,r,n,o,i,a){var s=c.call(this,e)||this;return s.key=t,s.keyCode=r,s.shiftDown=n,s.altDown=o,s.ctrlDown=i,s.metaDown=a,s}return h(e,c),e}(o),b=function(a){function s(e,t,r,n,o,i){return a.call(this,s.type,e,t,r,n,o,i)||this}return h(s,a),s.type="@keydown",s}(t.EvtKeyboard=v);t.EvtKeyDown=b;var _=function(a){function s(e,t,r,n,o,i){return a.call(this,s.type,e,t,r,n,o,i)||this}return h(s,a),s.type="@keyup",s}(v);t.EvtKeyUp=_;var w=function(a){function s(e,t,r,n,o,i){return a.call(this,s.type,e,t,r,n,o,i)||this}return h(s,a),s.type="@keypress",s}(v);t.EvtKeyPress=w;var x=function(u){function e(e,t,r,n,o,i,a,s){var c=u.call(this,e)||this;return c.x=t,c.y=r,c.button=n,c.shiftDown=o,c.altDown=i,c.ctrlDown=a,c.metaDown=s,c.bubble=!0,c}return h(e,u),e.prototype.cancelBubble=function(){this.bubble=!1},e}(o),P=function(s){function c(e,t,r,n,o,i,a){return s.call(this,c.type,e,t,r,n,o,i,a)||this}return h(c,s),c.type="@mousedown",c}(t.EvtMouse=x);t.EvtMouseDown=P;var k=function(s){function c(e,t,r,n,o,i,a){return s.call(this,c.type,e,t,r,n,o,i,a)||this}return h(c,s),c.type="@mouseup",c}(x);t.EvtMouseUp=k;var j=function(s){function c(e,t,r,n,o,i,a){return s.call(this,c.type,e,t,r,n,o,i,a)||this}return h(c,s),c.type="@mousemove",c}(x);t.EvtMouseMove=j;var T=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@mouseenter",t}(o);t.EvtMouseEnter=T;var O=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@mouseleave",t}(o);t.EvtMouseLeave=O;var S=function(s){function c(e,t,r,n,o,i,a){return s.call(this,c.type,e,t,r,n,o,i,a)||this}return h(c,s),c.type="@click",c}(x);t.EvtClick=S;var E=function(s){function c(e,t,r,n,o,i,a){return s.call(this,c.type,e,t,r,n,o,i,a)||this}return h(c,s),c.type="@dblclick",c}(x);t.EvtDblClick=E;var C=function(c){function u(e,t,r,n,o,i,a){var s=c.call(this,u.type,e,t,r,n,o,i,a)||this;return s.data=null,s}return h(u,c),u.type="@dragbegin",u}(x);t.EvtDragBegin=C;var B=function(u){function l(e,t,r,n,o,i,a,s){var c=u.call(this,l.type,e,t,r,n,o,i,a)||this;return c.data=s,c}return h(l,u),l.type="@dragend",l}(x);t.EvtDragEnd=B;var M=function(u){function l(e,t,r,n,o,i,a,s){var c=u.call(this,l.type,e,t,r,n,o,i,a)||this;return c.data=s,c}return h(l,u),l.type="@dragging",l}(x);t.EvtDragging=M;var W=function(l){function p(e,t,r,n,o,i,a,s,c){var u=l.call(this,p.type,e,t,r,n,o,i,a)||this;return u.object=s,u.data=c,u}return h(p,l),p.type="@dragover",p}(x);t.EvtDragOver=W;var A=function(l){function p(e,t,r,n,o,i,a,s,c){var u=l.call(this,p.type,e,t,r,n,o,i,a)||this;return u.object=s,u.data=c,u}return h(p,l),p.type="@dragdrop",p}(x);t.EvtDragDrop=A;var L=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@resize",t}(o);t.EvtResize=L;var D=function(r){function n(e){var t=r.call(this,n.type)||this;return t.view=e,t}return h(n,r),n.type="@canvasresize",n}(o);t.EvtCanvasResize=D;var I=function(r){function n(e){var t=r.call(this,n.type)||this;return t.propName=e,t.propValue=void 0,t}return h(n,r),n.type="@getprop",n}(o);t.EvtGetProp=I;var F=function(n){function o(e,t){var r=n.call(this,o.type)||this;return r.propName=e,r.propValue=t,r}return h(o,n),o.type="@setprop",o}(o);t.EvtSetProp=F;var R=function(o){function i(e,t,r){var n=o.call(this,i.type)||this;return n.view=e,n.oldPage=t,n.newPage=r,n}return h(i,o),i.type="@scenviewpagewillchange",i}(o);t.EvtSceneViewPageWillChange=R;var N=function(o){function i(e,t,r){var n=o.call(this,i.type)||this;return n.view=e,n.oldPage=t,n.newPage=r,n}return h(i,o),i.type="@sceneviewpagechanged",i}(o);t.EvtSceneViewPageChanged=N;var z=function(){function e(){}return e.isWindows=function(){return this._isWindows},e.isMac=function(){return this._isMac},e.isUnix=function(){return this._isX11&&!this._isWindows&&!this._isMac},e.isLinux=function(){return this._isLinux},e.isAndroid=function(){return this._isLinux&&this._isAndroid},e._isWindows="Win32"===navigator.platform||"Windows"===navigator.platform,e._isMac="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,e._isX11="X11"===navigator.platform,e._isLinux=0<=String(navigator.platform).indexOf("Linux"),e._isAndroid=0<=(navigator.userAgent.toLowerCase().match(/android/i)||[]).indexOf("android"),e}();t.EvtSysInfo=z;var G=function(){function e(){}return e.prototype.on=function(e,t,r){V.addEventListener(e,this,t,r||s.FIRST)},e.prototype.off=function(e,t){V.removeEventListener(e,this,t)},e.prototype.trigger=function(e){V.triggerEvent(this,e)},e.prototype.triggerEx=function(e){this.trigger(e)},e.prototype.post=function(e){V.postEvent(this,e)},e}();t.EventObserver=G;var V=function(){function r(){}return r.postEvent=function(e,t){this.eventQueue.push({evt:t,target:e})},r.triggerEvent=function(e,t){this.processEvent(t,e)},r.processPendingEvents=function(){var t=this,e=this.eventQueue;this.eventQueue=[],e.forEach(function(e){t.processEvent(e.evt,e.target)})},r.addEventListener=function(e,t,r,n){for(var o=this.eventListeners[e]||[],i=0;i<o.length;i++)if(o[i].bindObject===t){if(n===s.FIRST)o[i].handlers={handler:r,next:o[i].handlers};else{var a=o[i].handlers;if(a){for(;a.next;)a=a.next;a.next={handler:r,next:null}}}return}o.push({bindObject:t,handlers:{handler:r,next:null}}),this.eventListeners[e]=o},r.removeEventListener=function(e,t,r){for(var n=this.eventListeners[e]||[],o=0;o<n.length;o++)if(n[o].bindObject===t){if(!r){n.splice(o,1);break}for(var i=n[o].handlers,a=null;i&&i.handler!==r;)i=(a=i).next;i&&(a?a.next=i.next:n[o].handlers=i.next),n[o].handlers||n.splice(o,1)}},r.run=function(){this.running||(this.running=!0,this.lastFrameTime=0,this.firstFrameTime=0,this.elapsedTime=0,this.deltaTime=0,this.frameStamp=0,this.init(),requestAnimationFrame(function e(t){r.running&&(0===r.lastFrameTime&&(r.lastFrameTime=t,r.firstFrameTime=t),r.deltaTime=t-r.lastFrameTime,r.elapsedTime=t-r.firstFrameTime,r.lastFrameTime=t,r.frameStamp++,r.processPendingEvents(),r.triggerEvent(null,new y(r.deltaTime,r.elapsedTime,r.frameStamp)),r.running&&requestAnimationFrame(e))}))},r.addView=function(e){return!(!e||!e.canvas||this.findView(e.canvas.canvas))&&(this.views.push(e),this.focusView||this.setFocusView(e),!0)},r.addCanvas=function(e,t){if(this.findView(e))return null;var r=new H(e,void 0!==t&&t);return this.addView(r)?r:null},r.setFocusView=function(e){this.focusView!==e&&(this.focusView&&this.focusView.trigger(new g(!1)),this.focusView=e,this.focusView&&this.focusView.trigger(new g(!0)))},r.findView=function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].canvas.canvas===e)return this.views[t];return null},r.removeView=function(e){for(var t=0;t<this.views.length;t++)this.views[t].canvas.canvas===e&&this.views.splice(t,1)},r.setCapture=function(e){this.capturedView=e},r.init=function(){this.initEventListeners()},r.processEvent=function(e,t){var r=this.eventListeners[e.type];if(r)for(var n=0;n<r.length;n++){var o=r[n];if(!t||o.bindObject===t){for(var i=o.handlers;i&&(i.handler.call(o.bindObject,e),!e.eaten);)i=i.next;if(t)break}}},r.hitView=function(e,t){if(null!==this.capturedView)return this.capturedView;for(var r=0;r<this.views.length;r++){var n=this.views[r],o=n.canvas.viewport_rect;if(e>=o.x&&e<o.x+o.w&&t>=o.y&&t<o.y+o.h)return n}return null},r.resizeHandler=function(){var t=new L;this.views.forEach(function(e){e.triggerEx(t)})},r.mouseDownHandler=function(e){this.clickTick=Date.now();var t=this.hitView(e.clientX,e.clientY);null!==t&&t.handleMouseDown(e)},r.mouseUpHandler=function(e){var t=this.hitView(e.clientX,e.clientY);if(null!==t){var r=Date.now();r<this.clickTick+this.clickTime?r<this.dblClickTick+this.dblclickTime?(t.handleDblClick(e),this.dblClickTick=0):(t.handleClick(e),this.dblClickTick=r):this.dblClickTick=0,t.handleMouseUp(e),this.clickTick=0}else this.clickTick=0,this.dblClickTick=0},r.mouseMoveHandler=function(e){var t=this.hitView(e.clientX,e.clientY);if(t!==this.hoverView&&(this.hoverView&&(this.hoverView.triggerEx(new O),this.hoverView=null),null!==t&&(this.hoverView=t).triggerEx(new T)),null!==t){var r=t.canvas.viewport_rect;t.updateHitObjects(e.clientX-r.x,e.clientY-r.y),t.handleMouseMove(e)}},r.keyDownHandler=function(e){this.focusView&&this.focusView.trigger(new b(e.key,e.keyCode,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey))},r.keyUpHandler=function(e){this.focusView&&this.focusView.trigger(new _(e.key,e.keyCode,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey))},r.keyPressHandler=function(e){this.focusView&&this.focusView.trigger(new w(e.key,e.keyCode,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey))},r.initEventListeners=function(){window.addEventListener("resize",this.resizeHandler.bind(this)),window.addEventListener(window.onpointerdown?"pointerdown":"mousedown",this.mouseDownHandler.bind(this)),window.addEventListener(window.onpointerup?"pointerup":"mouseup",this.mouseUpHandler.bind(this)),window.addEventListener(window.onpointermove?"pointermove":"mousemove",this.mouseMoveHandler.bind(this)),window.addEventListener("keydown",this.keyDownHandler.bind(this)),window.addEventListener("keyup",this.keyUpHandler.bind(this)),window.addEventListener("keypress",this.keyPressHandler.bind(this))},r.elapsedTime=0,r.deltaTime=0,r.eventQueue=[],r.eventListeners={},r.running=!1,r.lastFrameTime=0,r.firstFrameTime=0,r.frameStamp=0,r.capturedView=null,r.hoverView=null,r.focusView=null,r.views=[],r.clickTick=0,r.dblClickTick=0,r.clickTime=400,r.dblclickTime=400,r}();t.App=V;var $=function(r){function e(e){var t=r.call(this)||this;return t.type=e,t.object=null,t}return h(e,r),e.prototype.toString=function(){return"<Component: "+this.type+">"},e}(G);t.Component=$;var K=function(r){function e(){var e=r.call(this)||this;return e.components={},e}return h(e,r),e.prototype.toString=function(){return"<BaseObject>"},e.prototype.addComponent=function(e){if(null===e.object){var t=this.components[e.type]||[];if(t.indexOf(e)<0){var r=new i(this);e.trigger(r),r.object=null,r.allow&&(t.push(e),e.object=this,e.trigger(new a))}this.components[e.type]=t}return this},e.prototype.removeComponent=function(e){if(e.object===this){var t=this.components[e.type].indexOf(e);this.removeComponentByIndex(e.type,t)}return this},e.prototype.removeComponentByIndex=function(e,t){var r=this.components[e];if(r&&0<=t&&t<r.length){var n=new c;r[t].trigger(n),n.allow&&(r[t].trigger(new u),r[t].object=null,r.splice(t,1))}return this},e.prototype.removeComponentsByType=function(e){for(var t=this.components[e];t&&0<t.length;)this.removeComponentByIndex(e,t.length-1);return this},e.prototype.removeAllComponents=function(){var t=this;return Object.keys(this.components).forEach(function(e){t.removeComponentsByType(e)}),this},e.prototype.getComponent=function(e,t){void 0===t&&(t=0);var r=this.components[e];return void 0===r||t<0||r.length<=t?null:r[t]},e.prototype.getComponents=function(e){return this.components[e]},e.prototype.triggerEx=function(t){for(var e in r.prototype.trigger.call(this,t),this.components)this.components.hasOwnProperty(e)&&this.components[e].forEach(function(e){e.trigger(t)})},e.prototype.post=function(e){V.postEvent(this,e)},e}(G),U=function(t){function e(e){var n=t.call(this)||this;return n._view=null,n._parent=null,n._z=0,n._visible=!0,n._children=[],n._localTransform=new transform.Matrix2d,n._worldTranslation=null,n._worldRotation=null,n._worldScale=null,n._anchorPoint={x:0,y:0},e&&e.addChild(n),n.on(p.type,function(e){e.addObject(n,n.z,n.worldTransform)}),n.on(d.type,function(e){var t=n.boundingShape;e.result=!!t&&intersect.IntersectionTestShapePoint(t,{x:e.x,y:e.y})}),n.on(I.type,function(e){switch(e.propName){case"z":e.propValue=n.z,e.eat();break;case"visible":e.propValue=n.visible,e.eat();break;case"transform":e.propValue=n.localTransform,e.eat();break;case"translation":var t=n.translation;e.propValue=[t.x,t.y],e.eat();break;case"scale":var r=n.scale;e.propValue=[r.x,r.y],e.eat();break;case"rotation":e.propValue=n.rotation,e.eat();break;case"anchorPoint":e.propValue=n.anchorPoint,e.eat()}}),n.on(F.type,function(e){switch(e.propName){case"z":n.z=e.propValue,e.eat();break;case"visible":n.visible=e.propValue,e.eat();break;case"transform":n.localTransform=e.propValue,e.eat();break;case"translation":var t=e.propValue;n.translation={x:Math.round(t[0]),y:Math.round(t[1])};break;case"scale":var r=e.propValue;n.scale={x:r[0],y:r[1]};break;case"rotation":n.rotation=e.propValue;break;case"anchorPoint":n.anchorPoint=e.propValue}}),n}return h(e,t),Object.defineProperty(e.prototype,"boundingShape",{get:function(){var e=new m;return this.triggerEx(e),e.shape||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this.setZ(e)},enumerable:!0,configurable:!0}),e.prototype.setZ=function(e){this._z=e},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){this.setVisible(e)},enumerable:!0,configurable:!0}),e.prototype.setVisible=function(e){this._visible=e},Object.defineProperty(e.prototype,"localTransform",{get:function(){return this._localTransform},set:function(e){this.setLocalTransform(e)},enumerable:!0,configurable:!0}),e.prototype.setLocalTransform=function(e){this._localTransform=e},Object.defineProperty(e.prototype,"translation",{get:function(){return this.localTransform.getTranslationPart()},set:function(e){this.setTranslation(e)},enumerable:!0,configurable:!0}),e.prototype.setTranslation=function(e){this.localTransform.setTranslationPart(e)},Object.defineProperty(e.prototype,"scale",{get:function(){return this.localTransform.getScalePart()},set:function(e){this.setScale(e)},enumerable:!0,configurable:!0}),e.prototype.setScale=function(e){this.localTransform.setScalePart(e)},Object.defineProperty(e.prototype,"rotation",{get:function(){return this.localTransform.getRotationPart()},set:function(e){this.setRotation(e)},enumerable:!0,configurable:!0}),e.prototype.setRotation=function(e){this.localTransform.setRotationPart(e)},Object.defineProperty(e.prototype,"worldTransform",{get:function(){var e=this.parent?transform.Matrix2d.transform(this.parent.worldTransform,this.localTransform):this.localTransform;return null!==this._worldTranslation&&e.setTranslationPart(this._worldTranslation),null!==this._worldRotation&&e.setRotationPart(this._worldRotation),null!==this._worldScale&&e.setScalePart(this._worldScale),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldTranslation",{get:function(){return this._worldTranslation},set:function(e){this.setWorldTranslation(e)},enumerable:!0,configurable:!0}),e.prototype.setWorldTranslation=function(e){this._worldTranslation=null===e?null:{x:Math.round(e.x),y:Math.round(e.y)}},Object.defineProperty(e.prototype,"worldRotation",{get:function(){return this._worldRotation},set:function(e){this.setWorldRotation(e)},enumerable:!0,configurable:!0}),e.prototype.setWorldRotation=function(e){this._worldRotation=e},Object.defineProperty(e.prototype,"worldScale",{get:function(){return this._worldScale},set:function(e){this.setWorldScale(e)},enumerable:!0,configurable:!0}),e.prototype.setWorldScale=function(e){this._worldScale=e},Object.defineProperty(e.prototype,"anchorPoint",{get:function(){return this._anchorPoint},set:function(e){this.setAnchorPoint(e)},enumerable:!0,configurable:!0}),e.prototype.setAnchorPoint=function(e){this._anchorPoint=e},Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),e.prototype.collapseTransform=function(){var e=this.worldTransform;this.worldTranslation=null,this.worldRotation=null,this.worldScale=null,this.parent?this.localTransform=transform.Matrix2d.invert(this.parent.worldTransform).transform(e):this.localTransform=e,this.localTransform.e=Math.round(this.localTransform.e),this.localTransform.f=Math.round(this.localTransform.f)},e.prototype.getLocalPoint=function(e,t){return transform.Matrix2d.invert(this.worldTransform).transformPoint({x:e,y:t})},e.prototype.childAt=function(e){return this._children[e]},e.prototype.forEachChild=function(e){this._children.forEach(e)},e.prototype.addChild=function(e){null===e._parent&&(e._parent=this,e._view=this._view,this._children.push(e))},e.prototype.removeChild=function(e){if(e._parent===this){var t=this._children.indexOf(e);this.removeChildAt(t)}},e.prototype.removeChildAt=function(e){if(0<=e&&e<this._children.length){var t=this._children[e];this._children.splice(e,1),t._parent=null,t._view=null}},e.prototype.removeChildren=function(){for(;0<this._children.length;)this.removeChildAt(0)},e.prototype.unrefChildren=function(){for(;0<this._children.length;)this._children[0].unrefChildren(),this.removeChildAt(0)},e.prototype.remove=function(){this._parent&&this._parent.removeChild(this)},e.prototype.triggerRecursive=function(r){t.prototype.trigger.call(this,r),this.forEachChild(function(e,t){e.triggerRecursive(r)})},e.prototype.triggerRecursiveEx=function(r){t.prototype.triggerEx.call(this,r),this.forEachChild(function(e,t){e.triggerRecursiveEx(r)})},e.prototype.setCapture=function(){this._view&&this._view.setCaptureObject(this)},e.prototype.releaseCapture=function(){this._view&&this._view.captureObject===this&&this._view.setCaptureObject(null)},e.prototype.toString=function(){return"<SceneObject>"},e}(t.BaseObject=K);t.SceneObject=U;var H=function(n){function e(e,t){void 0===t&&(t=!1);var i=n.call(this)||this;i._canvas=new X(i,e,t),i._captureObject=null,i._hitObjects=[],i._currentPage=null,i._pages={};var r=new U;return(r.view=i).addPage({name:"page1",rootNode:r,bkImageUrl:null,bkImageRepeat:null,bkImageSize:null,bkImageAttachment:null,bkColor:"#ffffff"}),i.selectPage("page1"),i.on(y.type,function(e){var t=new l(e.deltaTime,e.elapsedTime,e.frameStamp);i.rootNode&&i.rootNode.triggerRecursiveEx(t),i.canvas.clear(),i.triggerEx(new f(i.canvas,0,new transform.Matrix2d)),i.canvas.flip()}),i.on(f.type,function(e){if(i.rootNode){var t=new p(e.canvas.width,e.canvas.height);for(var r in i.rootNode.triggerRecursiveEx(t),t.result)for(var n=t.result[r],o=0;o<n.length;o++)e.canvas.context.save(),e.canvas.applyTransform(n[o].transform),e.canvas.context.translate(.5,.5),n[o].object.triggerEx(new f(e.canvas,n[o].z,n[o].transform)),e.canvas.context.restore()}}),i}return h(e,n),e.prototype.forEachPage=function(e){if(e)for(var t in this._pages)e({name:t,rootNode:this._pages[t].rootNode,bkImageUrl:this._pages[t].bkImageUrl,bkImageRepeat:this._pages[t].bkImageRepeat,bkImageAttachment:this._pages[t].bkImageAttachment,bkImageSize:this._pages[t].bkImageSize,bkColor:this._pages[t].bkColor})},e.prototype.addPage=function(e){var t={name:null,rootNode:null,bkImageUrl:null,bkImageRepeat:"repeat",bkImageAttachment:"scroll",bkImageSize:"auto",bkColor:"#ffffff"},r=e||t,n=r.name||this.genPageName();return n in this._pages?null:(this._pages[n]={name:n,rootNode:r.rootNode,bkImageUrl:r.bkImageUrl,bkImageRepeat:r.bkImageRepeat||t.bkImageRepeat,bkImageAttachment:r.bkImageAttachment||t.bkImageAttachment,bkImageSize:r.bkImageSize||t.bkImageSize,bkColor:r.bkColor||t.bkColor},n)},e.prototype.removePage=function(e){if(e in this._pages){if(e===this._currentPage){var t=!1;for(var r in this._pages)r!==e&&(this.selectPage(r),t=!0);if(!t)return!1}var n=this._pages[e].rootNode;return n&&(n.unrefChildren(),n.view=null,this._pages[e].rootNode=null),delete this._pages[e],!0}return!1},e.prototype.selectPage=function(e){var t=this._currentPage;e in this._pages&&e!==t&&(V.triggerEvent(null,new R(this,t,e)),this._currentPage=e,this._captureObject=null,this._hitObjects.length=0,this.applyPage(this._pages[this._currentPage]),V.triggerEvent(null,new N(this,t,e)))},e.prototype.renamePage=function(e,t){if(e in this._pages&&t&&t!==e&&!(t in this._pages)){var r=this._pages[e];delete this._pages[e],r.name=t,this._pages[t]=r,e===this._currentPage&&(this._currentPage=t)}},Object.defineProperty(e.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImage",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageUrl:null},set:function(e){this._currentPage&&e!==this._pages[this._currentPage].bkImageUrl&&(this._pages[this._currentPage].bkImageUrl=e,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImageRepeat",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageRepeat:null},set:function(e){var t=e||"repeat";this._currentPage&&t!==this._pages[this._currentPage].bkImageRepeat&&(this._pages[this._currentPage].bkImageRepeat=t,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImageAttachment",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageAttachment:null},set:function(e){var t=e||"scroll";this._currentPage&&t!==this._pages[this._currentPage].bkImageAttachment&&(this._pages[this._currentPage].bkImageAttachment=t,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImageSize",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageSize:null},set:function(e){var t=e||"auto";this._currentPage&&t!==this._pages[this._currentPage].bkImageSize&&(this._pages[this._currentPage].bkImageSize=t,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageColor",{get:function(){return this._currentPage?this._pages[this._currentPage].bkColor:null},set:function(e){this._currentPage&&e!==this._pages[this._currentPage].bkColor&&(this._pages[this._currentPage].bkColor=e,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),e.prototype.updateHitObjects=function(e,t){for(var r=this.hitTest(e,t),n=0;n<this._hitObjects.length;)r.indexOf(this._hitObjects[n])<0?(this._hitObjects[n].trigger(new O),this._hitObjects.splice(n,1)):n++;for(n=0;n<r.length;n++)this._hitObjects.indexOf(r[n])<0&&r[n].trigger(new T);this._hitObjects=r,this.rootNode&&this._hitObjects.push(this.rootNode)},Object.defineProperty(e.prototype,"rootNode",{get:function(){if(this._currentPage){var e=this._pages[this._currentPage].rootNode;return e||(((e=new U).view=this)._pages[this._currentPage].rootNode=e),e}return null},set:function(e){this._currentPage&&this._pages[this._currentPage].rootNode!==e&&(this._pages[this._currentPage].rootNode=e,this._hitObjects.length=0,this._captureObject=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureObject",{get:function(){return this._captureObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitObjects",{get:function(){return this._hitObjects},enumerable:!0,configurable:!0}),e.prototype.setCaptureObject=function(e){this._captureObject=e},e.prototype.handleMouseDown=function(e){var t=this.canvas.viewport_rect,r=new P(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey);if(this.isValidObject(this._captureObject))this._captureObject.triggerEx(r);else{for(var n=0;n<this._hitObjects.length;n++){var o=this._hitObjects[n];if(this.isValidObject(o)&&(o.triggerEx(r),!r.bubble))break}r.bubble&&this.triggerEx(r)}},e.prototype.handleMouseUp=function(e){var t=this.canvas.viewport_rect,r=new k(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey);if(this.isValidObject(this._captureObject))this._captureObject.triggerEx(r);else{for(var n=0;n<this._hitObjects.length;n++){var o=this._hitObjects[n];if(this.isValidObject(o)&&(o.triggerEx(r),!r.bubble))break}r.bubble&&this.triggerEx(r)}},e.prototype.handleMouseMove=function(e){var t=this.canvas.viewport_rect,r=new j(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey);if(this.isValidObject(this._captureObject))this._captureObject.triggerEx(r);else{for(var n=0;n<this._hitObjects.length;n++){var o=this._hitObjects[n];if(this.isValidObject(o)&&(o.triggerEx(r),!r.bubble))break}r.bubble&&this.triggerEx(r)}},e.prototype.handleClick=function(e){for(var t=this.canvas.viewport_rect,r=new S(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey),n=0;n<this._hitObjects.length;n++){var o=this._hitObjects[n];if(this.isValidObject(o)&&(o.triggerEx(r),!r.bubble))break}r.bubble&&this.triggerEx(r)},e.prototype.handleDblClick=function(e){for(var t=this.canvas.viewport_rect,r=new E(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey),n=0;n<this._hitObjects.length;n++){var o=this._hitObjects[n];if(this.isValidObject(o)&&(o.triggerEx(r),!r.bubble))break}r.bubble&&this.triggerEx(r)},e.prototype.setFocus=function(){V.setFocusView(this)},e.prototype.hitTest=function(i,a){var e=[];return this.rootNode&&(!function r(e,n){var t=transform.Matrix2d.invert(e.worldTransform).transformPoint({x:i,y:a}),o=new d(t.x,t.y);e.triggerEx(o),o.result&&n.push(e),e.forEachChild(function(e,t){r(e,n)})}(this.rootNode,e),e.sort(function(e,t){return t.z-e.z})),e},e.prototype.isValidObject=function(e){return e&&e.view===this},e.prototype.genPageName=function(){for(var e=1;;){var t="page"+e++;if(!(t in this._pages))return t}},e.prototype.applyPage=function(e){var t=e.bkColor||"",r=e.bkImageUrl&&"url("+e.bkImageUrl+")"||"",n=e.bkImageRepeat||"repeat",o=e.bkImageAttachment||"scroll",i=e.bkImageSize||"auto";this._canvas.canvas.style.background=t+" "+r+" "+n+" "+o+" 0% 0% / "+i},e}(K);function Y(n,o){var e=parseInt(window.getComputedStyle(n).zIndex||"0",10);isNaN(e)&&(e=0),e--;var t=document.createElement("div");t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.overflow="hidden",t.style.zIndex=String(e),t.style.visibility="hidden";var r=document.createElement("div");r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.width="10000000px",r.style.height="10000000px",t.appendChild(r);var i=document.createElement("div");i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.right="0px",i.style.bottom="0px",i.style.overflow="hidden",i.style.zIndex=String(e),i.style.visibility="hidden";var a=document.createElement("div");function s(){t.scrollLeft=1e7,t.scrollTop=1e7,i.scrollLeft=1e7,i.scrollTop=1e7}a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.width="200%",a.style.height="200%",i.appendChild(a),n.appendChild(t),n.appendChild(i),s();var c=n.getBoundingClientRect(),u=c.width,l=c.height,p=function(){var e=n.getBoundingClientRect(),t=e.width,r=e.height;t===u&&r===l||(u=t,l=r,o()),s()};t.addEventListener("scroll",p),i.addEventListener("scroll",p)}t.SceneView=H,t.ResizeSensor=Y;var X=function(o){function e(e,t,r){void 0===r&&(r=!1);var n=o.call(this)||this;return n._view=e,n._canvas=t,n._buffer=null,n._screenCtx=null,n._offscreenCtx=null,n._width=0,n._height=0,n._canvas&&(n.adjustCanvasSize(n._canvas),n._canvas.parentElement&&Y(n._canvas.parentElement,function(){n.adjustCanvasSize(n._canvas)})),n._mouseOver=!1,n._doubleBuffer=r,n}return h(e,o),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._doubleBuffer?this._offscreenCtx:this._screenCtx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport_rect",{get:function(){var e=this._canvas.getBoundingClientRect();return{x:e.left-document.documentElement.clientLeft,y:e.top-document.documentElement.clientTop,w:e.right-e.left,h:e.bottom-e.top}},enumerable:!0,configurable:!0}),e.prototype.clear=function(e){var t=e?e.x:0,r=e?e.y:0,n=e?e.w:this._width,o=e?e.h:this._height;this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(t,r,n,o),this._doubleBuffer&&this._screenCtx&&this._screenCtx.clearRect(t,r,n,o)},e.prototype.applyTransform=function(e){this.context.setTransform(e.a,e.b,e.c,e.d,Math.round(e.e),Math.round(e.f))},e.prototype.flip=function(){this._doubleBuffer&&this._screenCtx&&this._buffer&&this._screenCtx.drawImage(this._buffer,0,0)},e.prototype.adjustCanvasSize=function(e){if(e.parentElement){var t=window.getComputedStyle(e.parentElement);this._width=e.parentElement.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight),this._height=e.parentElement.clientHeight-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom),this._canvas.width=this._width,this._canvas.height=this._height,this._screenCtx=this._canvas.getContext("2d"),this._buffer=document.createElement("canvas"),this._buffer.width=this._width,this._buffer.height=this._height,this._offscreenCtx=this._buffer.getContext("2d"),V.triggerEvent(null,new D(this._view))}},e}(K);t.Canvas=X});unwrapExports(core);var core_1=core.EventListenerOrder,core_2=core.BaseEvent,core_3=core.EvtComponentBeforeAttach,core_4=core.EvtComponentAttached,core_5=core.EvtComponentBeforeDetach,core_6=core.EvtComponentDetached,core_7=core.EvtUpdate,core_8=core.EvtCull,core_9=core.EvtDraw,core_10=core.EvtHitTest,core_11=core.EvtGetBoundingShape,core_12=core.EvtFrame,core_13=core.EvtFocus,core_14=core.EvtKeyboard,core_15=core.EvtKeyDown,core_16=core.EvtKeyUp,core_17=core.EvtKeyPress,core_18=core.EvtMouse,core_19=core.EvtMouseDown,core_20=core.EvtMouseUp,core_21=core.EvtMouseMove,core_22=core.EvtMouseEnter,core_23=core.EvtMouseLeave,core_24=core.EvtClick,core_25=core.EvtDblClick,core_26=core.EvtDragBegin,core_27=core.EvtDragEnd,core_28=core.EvtDragging,core_29=core.EvtDragOver,core_30=core.EvtDragDrop,core_31=core.EvtResize,core_32=core.EvtCanvasResize,core_33=core.EvtGetProp,core_34=core.EvtSetProp,core_35=core.EvtSceneViewPageWillChange,core_36=core.EvtSceneViewPageChanged,core_37=core.EvtSysInfo,core_38=core.EventObserver,core_39=core.App,core_40=core.Component,core_41=core.BaseObject,core_42=core.SceneObject,core_43=core.SceneView,core_44=core.ResizeSensor,core_45=core.Canvas,components=createCommonjsModule(function(e,t){var n,r=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(s){function c(e){var i=s.call(this,c.type)||this;i._tracks={},i._duration=0,i._startTime=0,i._round=0;var t=e||{};if(i._delay=void 0===t.delay?0:t.delay,i._repeat=void 0===t.repeat?0:t.repeat,i._autoRemove=void 0===t.autoRemove||t.autoRemove,i._exclusive=!!t.exclusive,t.tracks)for(var r in t.tracks)if(t.tracks.hasOwnProperty(r)){var n=t.tracks[r],o=void 0===n.type?curve.SplineType.POLY:n.type,a=void 0===n.clamp||n.clamp;i.setTrack(r,o,a,n.cp)}return i.on(core.EvtComponentBeforeAttach.type,function(e){e.object&&i._exclusive&&e.object.removeComponentsByType(i.type)}),i.on(core.EvtUpdate.type,function(e){var t=e.elapsedTime;if(0===i._startTime&&(i._startTime=t),!(i._startTime+i._delay>t)){var r=t-i._startTime-i._delay;for(var n in i._tracks)i._tracks.hasOwnProperty(n)&&(i._tracks[n].value=i._tracks[n].evalutor.eval(r));if(i.object)for(var o in i._tracks)i._tracks.hasOwnProperty(o)&&i.object.triggerEx(new core.EvtSetProp(o,i._tracks[o].value));r>=i._duration&&(i._round++,0===i._repeat||i._round<i._repeat?i._startTime=t+r-i._duration:i._autoRemove&&i.object&&i.object.removeComponent(i))}}),i}return r(c,s),Object.defineProperty(c.prototype,"repeat",{get:function(){return this._repeat},set:function(e){this._repeat=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"autoRemove",{get:function(){return this._autoRemove},set:function(e){this._autoRemove=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"delay",{get:function(){return this._delay},set:function(e){this._delay=e},enumerable:!0,configurable:!0}),c.prototype.setTrack=function(e,t,r,n){0<n.length&&(n[n.length-1].x>this._duration&&(this._duration=n[n.length-1].x),this._tracks[e]={evalutor:new curve.Spline(t,n,r),value:null})},c.prototype.finish=function(){for(var e in this._tracks)this._tracks[e].value=this._tracks[e].evalutor.evalLast();if(this.object)for(var t in this._tracks)this.object.triggerEx(new core.EvtSetProp(t,this._tracks[t].value));this._round++,0===this._repeat||this._round<this._repeat?this._startTime=core.App.elapsedTime:this._autoRemove&&this.object&&this.object.removeComponent(this)},c.type="KeyframeAnimation",c}(core.Component);t.CoKeyframeAnimation=o;var i=function(e){function t(){var a=e.call(this,t.type)||this;return a._dragging=!1,a._draggingData=null,a.on(core.EvtMouseDown.type,function(e){var t=a.object;t.setCapture(),a._dragging=!0;var r=new core.EvtDragBegin(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown);t.triggerEx(r),a._draggingData=r.data,e.cancelBubble()}),a.on(core.EvtMouseUp.type,function(e){var t=a.object;if(t.releaseCapture(),t.view&&a._dragging){var r=new core.EvtDragEnd(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,a._draggingData);t.triggerEx(r),a._dragging=!1,t.view.updateHitObjects(e.x,e.y);for(var n=new core.EvtDragDrop(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,t,a._draggingData),o=0;o<t.view.hitObjects.length;o++){var i=t.view.hitObjects[o];if(i!==t&&i.z<=t.z&&(i.triggerEx(n),!n.bubble))break}n.bubble&&t.view.triggerEx(n),a._draggingData=null,e.cancelBubble()}}),a.on(core.EvtMouseMove.type,function(e){if(a.object&&a._dragging){var t=new core.EvtDragging(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,a._draggingData);a.object.triggerEx(t);var r=a.object;if(r.view){r.view.updateHitObjects(e.x,e.y);for(var n=new core.EvtDragOver(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,r,a._draggingData),o=0;o<r.view.hitObjects.length;o++){var i=r.view.hitObjects[o];if(i!==r&&i.z<=r.z&&(i.triggerEx(n),!n.bubble))break}n.bubble&&r.view.triggerEx(n),e.cancelBubble()}}}),a}return r(t,e),t.type="Draggable",t}(core.Component);t.CoDraggable=i;var a=function(e){function t(){return e.call(this,t.type)||this}return r(t,e),t.type="Droppable",t}(core.Component);t.CoDroppable=a;var s=function(o){function i(e,t,r){void 0===e&&(e=null),void 0===t&&(t=0),void 0===r&&(r=0);var n=o.call(this,i.type)||this;return n._image=new Image,e&&(n._image.src=e),n._width=t?n._image.width=t:n._image.complete?n._image.width:0,n._height=r?n._image.height=r:n._image.complete?n._image.height:0,n._image.complete?n._loaded=!0:(n._loaded=!1,n._image.onload=function(){0===n._width&&(n._width=n._image.width),0===n._height&&(n._height=n._image.height),n._loaded=!0}),n.on(core.EvtCull.type,function(e){if(n._loaded){var t=n.object;e.addObject(n,t.z,t.worldTransform)}}),n.on(core.EvtGetBoundingShape.type,function(e){n.object&&n._loaded&&(e.shape=new boundingbox.BoundingBox({x:-n._width*n.object.anchorPoint.x,y:-n._height*n.object.anchorPoint.y,w:n._width,h:n._height}))}),n.on(core.EvtDraw.type,function(e){n.object&&n._loaded&&e.canvas.context.drawImage(n._image,-Math.round(n._width*n.object.anchorPoint.x)-.5,-Math.round(n._height*n.object.anchorPoint.y)-.5,n._width,n._height)}),n.on(core.EvtGetProp.type,function(e){switch(e.propName){case"width":e.propValue=n._width,e.eat();break;case"height":e.propValue=n._height,e.eat()}}),n.on(core.EvtSetProp.type,function(e){switch(e.propName){case"width":n._width=e.propValue,n._image.width=n._width,e.eat();break;case"height":n._height=e.propValue,n._image.height=n._height,e.eat()}}),n}return r(i,o),i.type="Image",i}(core.Component);t.CoImage=s});unwrapExports(components);var components_1=components.CoKeyframeAnimation,components_2=components.CoDraggable,components_3=components.CoDroppable,components_4=components.CoImage,paint=createCommonjsModule(function(e,t){function w(e,t,r,n,o,i,a,s){var c=4*(o*t+n);e[c]=i,e[c+1]=a,e[c+2]=s,e[c+3]=255}Object.defineProperty(t,"__esModule",{value:!0});var y=null;function h(e){for(var t={r:255,g:255,b:255,a:255},r=[],n=0,o=(e.toLowerCase(),"0".charCodeAt(0)),i="9".charCodeAt(0),a="a".charCodeAt(0),s="f".charCodeAt(0),c=1;c<e.length;c++){var u=e.charCodeAt(c),l=0;o<=u&&u<=i?l=u-o:a<=u&&u<=s&&(l=10+u-a),c%2==1?n=l:r.push(16*n+l)}return 0<r.length&&(t.r=r[0]),1<r.length&&(t.g=r[1]),2<r.length&&(t.b=r[2]),3<r.length&&(t.a=r[3]),t}t.DrawLine=function(e,t,r,n,o,i){var a=h(i),s=n<t?n:t,c=o<r?o:r,u=n<t?t:n,l=o<r?r:o,p=e.getImageData(s,c,u-s+1,l-c+1);!function(e,t,r,n,o,i,a,s,c,u){var l,p=Math.abs(i-n),h=Math.abs(a-o),f=0;p<h&&(f=1,l=n,n=o,o=l,l=i,i=a,a=l,l=p,p=h,h=l);var d=n<i?1:-1,m=o<a?1:-1,y=n,g=o,v=2*h,b=2*(h-p),_=2*h-p;if(1===f)for(;y!==i;)_<0?_+=v:(g+=m,_+=b),w(e,t,0,g,y,s,c,u),y+=d;else for(;y!==i;)_<0?_+=v:(g+=m,_+=b),w(e,t,0,y,g,s,c,u),y+=d}(p.data,p.width,p.height,t-s,r-c,n-s,o-c,a.r,a.g,a.b),e.putImageData(p,s,c)},t.FillCircle=function(e,t,r,n,o){var i=h(o),a=e.getImageData(t-n,r-n,2*n+1,2*n+1);!function(e,s,t,c,u,l,p,h,f){function r(e,t){var r=y,n=e-c,o=t-u,i=1-Math.sqrt((n*n+o*o)/(l*l)),a=4*(t*s+e);r[a]=p*i,r[a+1]=h*i,r[a+2]=f*i,r[a+3]=255*i}(null===y||y.length<e.length)&&(y=new Uint8ClampedArray(e.length));var n,o=0,i=l,a=3,d=2-l-l,m=1-l;for(r(o+c,i+u),r(o+c,-i+u),n=-l+c;n<=l+c;n++)r(n,u);for(;o<i;){for(m<0?(m+=a,a+=2,o++):(m+=a+d,a+=2,d+=2,o++,i--),n=-o+c;n<=o+c;n++)r(n,-i+u),r(n,i+u);for(n=-i+c;n<=i+c;n++)r(n,-o+u),r(n,o+u)}!function(e,t){for(var r=0;r<e.length/4;r++){var n=1-t[4*r+3]/255;e[4*r]=e[4*r]*n+t[4*r],e[4*r+1]=e[4*r+1]*n+t[4*r+1],e[4*r+2]=e[4*r+2]*n+t[4*r+2],e[4*r+3]<t[4*r+3]&&(e[4*r+3]=t[4*r+3])}}(e,y)}(a.data,a.width,a.height,n,n,n,i.r,i.g,i.b),e.putImageData(a,t-n,r-n)}});unwrapExports(paint);var paint_1=paint.DrawLine,paint_2=paint.FillCircle,catk=createCommonjsModule(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(point),t(boundingshape),t(boundingbox),t(boundinghull),t(boundingsegment),t(boundingsphere),t(intersect),t(curve),t(keycode),t(transform),t(core),t(components),t(paint)});unwrapExports(catk);var whiteboard=createCommonjsModule(function(e,t){var n,i=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function o(e,t){var r=n.call(this,o.type)||this;return r.messageType=e,r.messageData=t,r}return i(o,n),o.type="@socketMessage",o}(catk.BaseEvent);t.EvtSocketMessage=r;var o=function(e){function t(){var n=e.call(this,t.type)||this;return n.on(l.type,function(e){e.tool.activateObject(n.object)}),n.on(s.type,function(e){e.tool.deactivateObject(n.object)}),n.on(w.type,function(e){var t=n.object;switch(e.name){case"localx":(r=t.translation).x=Number(e.value),t.translation=r;break;case"localy":(r=t.translation).y=Number(e.value),t.translation=r;break;case"anchorx":(r=t.anchorPoint).x=Number(e.value),t.anchorPoint=r;break;case"anchory":var r;(r=t.anchorPoint).y=Number(e.value),t.anchorPoint=r;break;case"entityName":t.entityName=e.value}}),n.on(x.type,function(e){var t=n.object;switch(e.name){case"localx":e.value=t.translation.x;break;case"localy":e.value=t.translation.y;break;case"anchorx":e.value=t.anchorPoint.x;break;case"anchory":e.value=t.anchorPoint.y;break;case"entityName":e.value=t.entityName;break;case"entityType":e.value=t.entityType}}),n.on(c.type,function(e){e.properties=e.properties||{},e.properties.general=e.properties.general||{desc:"通用",properties:[]},e.properties.general.properties.push({name:"entityType",desc:"类型",readonly:!0,type:"string",value:n.object?n.object.entityType:null}),e.properties.general.properties.push({name:"entityName",desc:"名称",readonly:!1,type:"string",value:n.object?n.object.entityName:null}),e.properties.general.properties.push({name:"localx",desc:"位置X",readonly:!1,type:"number",value:n.object?n.object.translation.x:null}),e.properties.general.properties.push({name:"localy",desc:"位置Y",readonly:!1,type:"number",value:n.object?n.object.translation.y:null}),e.properties.general.properties.push({name:"anchorx",desc:"锚点X",readonly:!1,type:"number",value:n.object?n.object.anchorPoint.x:null}),e.properties.general.properties.push({name:"anchory",desc:"锚点Y",readonly:!1,type:"number",value:n.object?n.object.anchorPoint.y:null})}),n}return i(t,e),t.type="WBComponent",t}(catk.Component);t.WBComponent=o;var a=function(){function e(e){this.name=e}return e.prototype.createEntity=function(e,t,r){var n=this._createEntity(r);return null===n?null:(n.addComponent(new o),n.translation={x:e,y:t},n)},e.prototype.getCreationProperties=function(){return[]},e}();t.WBFactory=a;var l=function(r){function n(e){var t=r.call(this,n.type)||this;return t.tool=e,t}return i(n,r),n.type="@WBToolActivate",n}(catk.BaseEvent);t.WBToolActivateEvent=l;var s=function(r){function n(e){var t=r.call(this,n.type)||this;return t.tool=e,t}return i(n,r),n.type="@WBToolDeactivate",n}(catk.BaseEvent);t.WBToolDeactivateEvent=s;var c=function(e){function t(){return e.call(this,t.type)||this}return i(t,e),t.type="@WBGetObjectPropertyList",t}(catk.BaseEvent);t.WBGetPropertyListEvent=c;var w=function(n){function o(e,t){var r=n.call(this,o.type)||this;return r.name=e,r.value=t,r}return i(o,n),o.type="@WBSetObjectPropertyEvent",o}(catk.BaseEvent);t.WBSetPropertyEvent=w;var x=function(r){function n(e){var t=r.call(this,n.type)||this;return t.name=e,t}return i(n,r),n.type="@WBGetObjectPropertyEvent",n}(catk.BaseEvent);t.WBGetPropertyEvent=x;var u=function(r){function n(e){var t=r.call(this,n.type)||this;return t.name=e,t}return i(n,r),n.type="@WBGetObject",n}(catk.BaseEvent);t.WBGetObjectEvent=u;var p=function(o){function e(e,t,r){var n=o.call(this)||this;return n.name=e,n.desc=r||e,n._wb=t,n.on(x.type,function(e){switch(e.name){case"desc":e.value=n.desc}}),n.on(c.type,function(e){e.properties=e.properties||{}}),n}return i(e,o),e.prototype.activate=function(e){catk.App.triggerEvent(null,new l(this))},e.prototype.deactivate=function(){catk.App.triggerEvent(null,new s(this))},e.prototype.activateObject=function(e){},e.prototype.deactivateObject=function(e){},e.prototype.executeCommand=function(e){},e}(catk.EventObserver);t.WBTool=p;var h=function(n){function e(e,t){void 0===t&&(t=!1);var r=n.call(this)||this;return r.view=null,r.view=catk.App.addCanvas(e,t),r._factories={},r._tools={},r._currentTool="",r._entities={},r.on(u.type,function(e){e.object=r.findEntity(e.name)}),r.on(catk.EvtSceneViewPageWillChange.type,function(e){var t=r._tools[r._currentTool];t&&t.deactivate()}),r.on(catk.EvtSceneViewPageChanged.type,function(e){var t=r._tools[r._currentTool];t&&t.activate()}),r.view&&(r.view.on(catk.EvtKeyDown.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtKeyUp.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtKeyPress.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtMouseDown.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtMouseUp.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtMouseMove.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtClick.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtDblClick.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)}),r.view.on(catk.EvtDraw.type,function(e){""!==r._currentTool&&r._tools[r._currentTool].trigger(e)},catk.EventListenerOrder.LAST)),r}return i(e,n),e.prototype.addTool=function(e){this._tools[e.name]=e},e.prototype.addFactory=function(e){this._factories[e.name]=e},e.prototype.getFactory=function(e){return this._factories[e]||null},e.prototype.createEntity=function(e,t,r,n,o,i){var a=null;if(null===t)for(var s=1;t=""+e.toLowerCase()+s++,null!==this.findEntity(t););else if(null!==(a=this.findEntity(t)))return r?null:a;var c=this._factories[e];if(c&&(a=c.createEntity(n,o,i))&&(a.entityName=t,a.entityType=e,this.view&&this.view.rootNode&&this.view.rootNode.addChild(a),this._entities[t]=a,""!==this._currentTool)){var u=this._tools[this._currentTool];u&&a.triggerEx(new l(u))}return a},e.prototype.deleteEntity=function(e){var t=this.findEntity(e);t&&(t.remove(),delete this._entities[e])},e.prototype.findEntity=function(e){return this._entities[e]||null},e.prototype.encodeCommand=function(e){return JSON.stringify(e)},e.prototype.executeCommand=function(e){var t=this,r=this.encodeCommand(e);if(console.log("CMD: "+r),"UseTool"===e.command){if(this._currentTool!==e.name){if(""!==this._currentTool)this._tools[this._currentTool].deactivate();if(this._currentTool="",e.name){var n=this._tools[e.name];n&&(this._currentTool=e.name,n.activate(e.args||{}))}}}else if("CreateObject"===e.command){var o=e.type,i=e.name||null,a=!!e.failOnExists,s=e.params||{},c=this.createEntity(o,i,a,e.x,e.y,s);e.objectCreated=c}else if("DeleteObject"===e.command)this.deleteEntity(e.name);else if("DeleteObjects"===e.command)e.objects&&e.objects.forEach(function(e){t.deleteEntity(e)});else if("AlignObjectsLeft"===e.command){if(e.objects&&1<e.objects.length){for(var u=(b=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.e,l=1;l<b.length;l++){(h=b[l].worldTransform.e)<u&&(u=h)}b.forEach(function(e){e.worldTranslation={x:u,y:e.worldTransform.f},e.collapseTransform()})}}else if("AlignObjectsRight"===e.command){if(e.objects&&1<e.objects.length){var p=(b=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.e;for(l=1;l<b.length;l++){var h=b[l].worldTransform.e;p<h&&(p=h)}b.forEach(function(e){e.worldTranslation={x:p,y:e.worldTransform.f},e.collapseTransform()})}}else if("AlignObjectsTop"===e.command){if(e.objects&&1<e.objects.length){var f=(b=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.f;for(l=1;l<b.length;l++){(m=b[l].worldTransform.f)<f&&(f=m)}b.forEach(function(e){e.worldTranslation={x:e.worldTransform.e,y:f},e.collapseTransform()})}}else if("AlignObjectsBottom"===e.command){if(e.objects&&1<e.objects.length){var d=(b=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.f;for(l=1;l<b.length;l++){var m=b[l].worldTransform.f;d<m&&(d=m)}b.forEach(function(e){e.worldTranslation={x:e.worldTransform.e,y:d},e.collapseTransform()})}}else if("AlignObjectsHorizontal"===e.command){if(e.objects&&1<e.objects.length){var y=this.findEntity(e.objects[0]);if(y)for(m=y.worldTransform.f,l=1;l<e.objects.length;l++){(c=this.findEntity(e.objects[l]))&&(c.worldTranslation={x:c.worldTransform.e,y:m},c.collapseTransform())}}}else if("ArrangeObjectsHorizontal"===e.command){if(e.objects&&2<e.objects.length){(b=e.objects.map(function(e){return t.findEntity(e)})).sort(function(e,t){return e.worldTransform.e-t.worldTransform.e});var g=b[0].worldTransform.e,v=(b[b.length-1].worldTransform.e-g)/(b.length-1);for(l=1;l<b.length-1;l++)b[l].worldTranslation={x:g+l*v,y:b[l].worldTransform.f},b[l].collapseTransform()}}else if("ArrangeObjectsVertical"===e.command){if(e.objects&&2<e.objects.length){var b;(b=e.objects.map(function(e){return t.findEntity(e)})).sort(function(e,t){return e.worldTransform.f-t.worldTransform.f});for(g=b[0].worldTransform.f,v=(b[b.length-1].worldTransform.f-g)/(b.length-1),l=1;l<b.length-1;l++)b[l].worldTranslation={x:b[l].worldTransform.e,y:g+l*v},b[l].collapseTransform()}}else if("SetObjectProperty"===e.command){if(c=this.findEntity(e.objectName)){var _=new w(e.propName,e.propValue);c.triggerEx(_),c.entityName!==e.objectName&&(this.findEntity(c.entityName)?c.entityName=e.objectName:(delete this._entities[e.objectName],this._entities[c.entityName]=c))}}else if("GetObjectProperty"===e.command){if(c=this.findEntity(e.objectName)){_=new x(e.propName);c.triggerEx(_),e.propValue=_.value}}else"AddPage"===e.command?this.view&&this.view.addPage():"RenamePage"===e.command?this.view&&this.view.currentPage&&this.view.renamePage(this.view.currentPage,e.newName):this._currentTool&&this._tools[this._currentTool].executeCommand(e)},e}(catk.EventObserver);t.WhiteBoard=h});unwrapExports(whiteboard);var whiteboard_1=whiteboard.EvtSocketMessage,whiteboard_2=whiteboard.WBComponent,whiteboard_3=whiteboard.WBFactory,whiteboard_4=whiteboard.WBToolActivateEvent,whiteboard_5=whiteboard.WBToolDeactivateEvent,whiteboard_6=whiteboard.WBGetPropertyListEvent,whiteboard_7=whiteboard.WBSetPropertyEvent,whiteboard_8=whiteboard.WBGetPropertyEvent,whiteboard_9=whiteboard.WBGetObjectEvent,whiteboard_10=whiteboard.WBTool,whiteboard_11=whiteboard.WhiteBoard,editor=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function o(e,t){this._editor=e,this._container=t,this._tools=[],this._curTool=null}return o.prototype.unload=function(){for(;this._container.hasChildNodes();)this._container.removeChild(this._container.firstChild);this._tools=[]},o.prototype.loadToolPalette=function(r){var i=this,e=function(e){var t=n.getOpTool(r,e),o=n.createToolButton(t);o&&o.addEventListener("click",function(){var e=Number(o.getAttribute("toolIndex")),t=i._tools[e];if(t!==i._curTool&&i._curTool){var r=document.querySelector("#"+i._curTool.elementId);r&&r.classList.remove("active"),i._editor.executeCommand({command:"UseTool"}),i._curTool=null}if(t){var n=document.querySelector("#"+t.elementId);n&&n.classList.add("active"),i._editor.executeCommand(t.command),i._curTool=t}})},n=this;for(var t in r)e(t)},o.prototype.loadOpPalette=function(n){var o=this,e=function(e){var t=i.getOpTool(n,e),r=i.createToolButton(t);r&&r.addEventListener("click",function(){var e=Number(r.getAttribute("toolIndex")),t=o._tools[e];o._editor.executeCommand(t.command)})},i=this;for(var t in n)e(t)},o.prototype.getOpTool=function(e,t){var r={command:{command:t},iconClass:e[t].iconClass},n=e[t].command;n&&(r.command.command=n);var o=e[t].args;if(o)for(var i in o)r.command[i]=o[i];return r},o.prototype.createToolButton=function(e){this._tools.push(e);var t=this._editor.toolFontSize+6,r=null;if("function"==typeof e.iconClass)(r=e.iconClass(this._editor))&&r.classList.add("toolbutton");else{(r=document.createElement("div")).classList.add("flex-h","flex-align-x-center","flex-align-y-center"),r.classList.add("toolbutton");var n=document.createElement("i");n.style.fontSize=this._editor.toolFontSize+"px",n.style.color="#fff",e.iconClass.split(" ").forEach(function(e){n.classList.add(e)}),r.appendChild(n)}return r&&(e.elementId="toolbutton-"+o.uniqueId++,r.setAttribute("id",e.elementId),r.style.width=t+"px",r.style.height=t+"px",r.setAttribute("toolIndex",String(this._tools.length-1)),this._container.appendChild(r)),r},o.uniqueId=1,o}();t.WBToolPalette=a;var s=function(){function e(e,t,r){this._editor=e,this._container=t,this._tableId=r,this._object=null;var n=document.createElement("table");n.style.border="solid 1px #95B8E7",n.style.borderSpacing="0px",n.style.margin="0px",n.style.fontSize="12px",n.style.fontFamily="verdana",n.style.width="100%",n.style.tableLayout="fixed",n.style.backgroundColor="#fff",n.setAttribute("id",this._tableId);var o=document.createElement("tbody");n.appendChild(o),this._container.appendChild(n)}return e.prototype.addGroup=function(e){var t=this.createRow();t.style.backgroundColor="#E0ECFF",t.style.fontWeight="bold",this.createGroupCell(t,e)},e.prototype.addButton=function(e,t){var r=this.createRow(),n=this.createCell(r);n.style.padding="5px",n.style.textAlign="center",n.setAttribute("colspan","2");var o=document.createElement("button");o.innerText=e,o.style.width="100%",o.style.padding="5px",o.onclick=function(){t&&t()},n.appendChild(o)},e.prototype.addTextAttribute=function(e,t,r,n,o){var i=this.createRow();this.createPropCell(i).innerText=e;var a=document.createElement("input");a.type="text",t&&(a.value=t),a.style.width="100%",a.style.boxSizing="border-box",a.readOnly=r,a.disabled=r,n&&(o?a.onchange=a.onblur=function(){a.value=String(n(a.value))}:a.oninput=function(){a.value=String(n(a.value))}),this.createPropCell(i).appendChild(a)},e.prototype.addToggleAttribute=function(e,t,r,n){var o=this.createRow();this.createPropCell(o).innerText=e;var i=document.createElement("input");i.type="checkbox",i.checked=t,i.readOnly=r,i.disabled=r,n&&(i.onchange=function(){i.checked=Boolean(n(i.checked))}),this.createPropCell(o).appendChild(i)},e.prototype.addNumberAttribute=function(e,t,r,n){var o=this.createRow();this.createPropCell(o).innerText=e;var i=document.createElement("input");i.type="number",i.value=String(t),i.readOnly=r,i.disabled=r,i.style.width="100%",i.style.boxSizing="border-box",n&&(i.oninput=function(){i.value=String(n(Number(i.value)))}),this.createPropCell(o).appendChild(i)},e.prototype.addChoiceAttribute=function(e,t,r,n,o){var i=this.createRow();this.createPropCell(i).innerText=e;var a=document.createElement("select");t.forEach(function(e){var t=document.createElement("option");t.value=String(e.value),t.innerText=String(e.desc),a.add(t)}),r&&(a.value=String(r)),a.disabled=n,a.style.width="100%",a.style.boxSizing="border-box",o&&(a.onchange=function(){a.value=String(o(a.value))}),this.createPropCell(i).appendChild(a)},e.prototype.addColorAttribute=function(e,t,r,n){var o=this.createRow();this.createPropCell(o).innerText=e;var i=document.createElement("input");i.type="color",i.value=t,i.readOnly=r,i.disabled=r,i.style.width="100%",i.style.boxSizing="border-box",n&&(i.onchange=function(){i.value=String(n(i.value))}),this.createPropCell(o).appendChild(i)},e.prototype.getToolProperty=function(e){if(this._object){var t=new whiteboard.WBGetPropertyEvent(e);return this._object.triggerEx(t),t.value}},e.prototype.setToolProperty=function(e,t){if(this._object){var r=new whiteboard.WBSetPropertyEvent(e,t);this._object.triggerEx(r)}},e.prototype.addToolProperty=function(e){var t=this,r=e.name,n=e.type,o=e.readonly;if(e.enum)this.addChoiceAttribute(e.desc,e.enum,this.getToolProperty(r),o,function(e){switch(n){case"string":return t.setToolProperty(r,e),t.getToolProperty(r);case"number":return t.setToolProperty(r,Number(e)),t.getToolProperty(r);case"boolean":return t.setToolProperty(r,Boolean(e)),t.getObjectProperty(r);case"color":return t.setToolProperty(r,e),t.getToolProperty(r)}});else switch(n){case"string":this.addTextAttribute(e.desc,this.getToolProperty(r),o,function(e){return t.setToolProperty(r,e),t.getToolProperty(r)});break;case"number":this.addNumberAttribute(e.desc,this.getToolProperty(r),o,function(e){return t.setToolProperty(r,e),t.getToolProperty(r)});break;case"boolean":this.addToggleAttribute(e.desc,this.getToolProperty(r),o,function(e){return t.setToolProperty(r,e),t.getToolProperty(r)});break;case"color":this.addColorAttribute(e.desc,this.getToolProperty(r),o,function(e){return t.setToolProperty(r,e),t.getToolProperty(r)})}},e.prototype.getObjectProperty=function(e){if(this._object){var t={command:"GetObjectProperty",objectName:this._object.entityName,propName:e};return this._editor.commandServer.whiteboard.executeCommand(t),t.propValue}},e.prototype.setObjectProperty=function(e,t){this._object&&this._editor.commandServer.executeCommand({command:"SetObjectProperty",objectName:this._object.entityName,propName:e,propValue:t})},e.prototype.addObjectProperty=function(e){var t=this,r=e.name,n=e.type,o=e.readonly;if(e.enum)this.addChoiceAttribute(e.desc,e.enum,this.getObjectProperty(r),o,function(e){switch(n){case"string":return t.setObjectProperty(r,e),t.getObjectProperty(r);case"number":return t.setObjectProperty(r,Number(e)),t.getObjectProperty(r);case"boolean":return t.setObjectProperty(r,Boolean(e)),t.getObjectProperty(r);case"color":return t.setObjectProperty(r,e),t.getObjectProperty(r)}});else switch(n){case"string":this.addTextAttribute(e.desc,this.getObjectProperty(r),o,function(e){return t.setObjectProperty(r,e),t.getObjectProperty(r)});break;case"number":this.addNumberAttribute(e.desc,this.getObjectProperty(r),o,function(e){return t.setObjectProperty(r,e),t.getObjectProperty(r)});break;case"boolean":this.addToggleAttribute(e.desc,this.getObjectProperty(r),o,function(e){return t.setObjectProperty(r,e),t.getObjectProperty(r)});break;case"color":this.addColorAttribute(e.desc,this.getObjectProperty(r),o,function(e){return t.setObjectProperty(r,e),t.getObjectProperty(r)})}},e.prototype.clear=function(){for(var e=document.querySelectorAll("table#"+this._tableId+" input"),t=0;t<e.length;t++)e[t].onchange=null;var r=document.querySelectorAll("table#"+this._tableId+" select");for(t=0;t<r.length;t++)r[t].onchange=null;for(var n=document.querySelector("table#"+this._tableId+" tbody");n&&n.hasChildNodes();)n.removeChild(n.firstChild);this._object=null},e.prototype.reloadToolProperties=function(){var e=this._object;this.clear(),e&&this.loadToolProperties(e)},e.prototype.loadToolProperties=function(e){var t=this;if(this._object!==e&&(this.clear(),this._object=e,this._object)){var r=new whiteboard.WBGetPropertyListEvent;if(this._object.triggerEx(r),r.properties)for(var n in r.properties){var o=r.properties[n];this.addGroup(o.desc),o.properties.forEach(function(e){t.addToolProperty(e)})}}},e.prototype.reloadObjectProperties=function(){var e=this._object;this.clear(),e&&this.loadObjectProperties(e)},e.prototype.loadObjectProperties=function(e){var t=this;if(this._object!==e&&(this.clear(),this._object=e,this._object)){var r=new whiteboard.WBGetPropertyListEvent;if(this._object.triggerEx(r),r.properties)for(var n in r.properties){var o=r.properties[n];this.addGroup(o.desc),o.properties.forEach(function(e){t.addObjectProperty(e)})}}},e.prototype.loadPageProperties=function(){var t=this;this.clear();var r=[],n=this._editor.commandServer.whiteboard.view;n&&(n.forEachPage(function(e){r.push({value:e.name,desc:e.name})}),this.addChoiceAttribute("页面列表",r,n.currentPage,!1,function(e){return n.selectPage(e),t.loadPageProperties(),n.currentPage}),this.addTextAttribute("页面名称",n.currentPage,!1,function(e){if(e!==n.currentPage)return t._editor.commandServer.executeCommand({command:"RenamePage",newName:e}),t.loadPageProperties(),n.currentPage},!0),this.addTextAttribute("页面背景图像",n.pageImage,!1,function(e){return n.pageImage=""===e?null:e,e},!0),this.addChoiceAttribute("页面背景重复",[{value:"repeat",desc:"重复"},{value:"repeat-x",desc:"横向重复"},{value:"repeat-y",desc:"纵向重复"},{value:"no-repeat",desc:"不重复"}],n.pageImageRepeat,!1,function(e){return n.pageImageRepeat=e}),this.addToggleAttribute("页面背景固定","fixed"===n.pageImageAttachment,!1,function(e){return n.pageImageAttachment=e?"fixed":"scroll",e}),this.addTextAttribute("页面背景大小",n.pageImageSize,!1,function(e){return n.pageImageSize=e}),this.addColorAttribute("页面背景颜色",n.pageColor||"",!1,function(e){return n.pageColor=""===e?null:e,e}),this.addButton("新建页面",function(){t._editor.commandServer.executeCommand({command:"AddPage"}),t.loadPageProperties()}),this.addButton("删除页面",function(){t._editor.commandServer.executeCommand({command:"DeletePage"}),t.loadPageProperties()}))},e.prototype.createRow=function(){var e=document.querySelector("#"+this._tableId+" tbody"),t=document.createElement("tr");return e&&t&&e.appendChild(t),t},e.prototype.createCell=function(e){var t=document.createElement("td");return t.style.color="#000",t.style.fontWeight="bold",t.style.overflow="hidden",t.style.whiteSpace="nowrap",t.style.textOverflow="ellipsis",t.style.height="24px",e.appendChild(t),t},e.prototype.createGroupCell=function(e,t){var r=this.createCell(e);return r.style.paddingLeft="5px",r.setAttribute("colspan","2"),r.innerText=t,r},e.prototype.createPropCell=function(e){var t=this.createCell(e);return t.style.paddingLeft="5px",t.style.border="dotted 1px #ccc",t.style.color="#000",t},e}();t.WBPropertyGrid=s;var r=function(){function e(e,t,r,n,o,i){this._strokeColor="#00000000",this._fillColor="red",this._toolFontSize=14,this._cmdServer=e,this._toolset=t,this._toolPalette=new a(this,r),this._toolPalette.loadToolPalette(t.tools),this._opPalette=new a(this,n),this._opPalette.loadOpPalette(t.operations),this._objectPropGrid=new s(this,o,"wb-object"),this._toolPropGrid=new s(this,i,"wb-tool"),this._objectPropGrid.loadPageProperties()}return Object.defineProperty(e.prototype,"toolSet",{get:function(){return this._toolset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opPalette",{get:function(){return this._opPalette},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolPalette",{get:function(){return this._toolPalette},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectPropertyGrid",{get:function(){return this._objectPropGrid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolPropertyGrid",{get:function(){return this._toolPropGrid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"commandServer",{get:function(){return this._cmdServer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokeColor",{get:function(){return this._strokeColor},set:function(e){this._strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},set:function(e){this._fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolFontSize",{get:function(){return this._toolFontSize},set:function(e){this._toolFontSize=e},enumerable:!0,configurable:!0}),e.prototype.executeCommand=function(e){if(0<e.command.length){var t={};for(var r in e){var n=e[r];t[r]="function"==typeof n?n(this):n}this._cmdServer.executeCommand(t)}},e}();t.WBEditor=r});unwrapExports(editor);var editor_1=editor.WBToolPalette,editor_2=editor.WBPropertyGrid,editor_3=editor.WBEditor,toolset=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WBDefaultToolSet={tools:{CreateLabel:{iconClass:"fas fa-font fa-fw",command:"UseTool",args:{name:"Create",args:{createType:"Label",text:"标签",textColor:"#000000"}}},Select:{iconClass:"fas fa-mouse-pointer fa-fw",command:"UseTool",args:{name:"Select"}},Swap:{iconClass:"fas fa-exchange-alt fa-fw",command:"UseTool",args:{name:"Swap"}},Connect:{iconClass:"fas fa-arrow-right fa-fw",command:"UseTool",args:{name:"Connect"}},Write:{iconClass:"fas fa-pen fa-fw",command:"UseTool",args:{name:"HandWriting",args:{mode:"draw"}}},Erase:{iconClass:"fas fa-eraser fa-fw",command:"UseTool",args:{name:"HandWriting",args:{mode:"erase"}}}},operations:{Delete:{iconClass:"fas fa-trash-alt fa-fw",command:"DeleteSelected"},Clone:{iconClass:"fas fa-clone fa-fw"},AlignLeft:{iconClass:"fas fa-align-left fa-fw",command:"AlignSelected",args:{mode:"Left"}},AlignRight:{iconClass:"fas fa-align-right fa-fw",command:"AlignSelected",args:{mode:"Right"}},AlignTop:{iconClass:"fas fa-align-right fa-rotate-270 fa-fw",command:"AlignSelected",args:{mode:"Top"}},AlignBottom:{iconClass:"fas fa-align-right fa-rotate-90 fa-fw",command:"AlignSelected",args:{mode:"Bottom"}},ArrangeH:{iconClass:"fas fa-arrows-alt-h fa-fw",command:"ArrangeSelected",args:{mode:"Horizontal"}},ArrangeV:{iconClass:"fas fa-arrows-alt-v fa-fw",command:"ArrangeSelected",args:{mode:"Vertical"}}}}});unwrapExports(toolset);var toolset_1=toolset.WBDefaultToolSet,editor$2=createCommonjsModule(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(toolbox),t(editor),t(toolset)});unwrapExports(editor$2);var label=createCommonjsModule(function(e,t){var n,r=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(n){function e(e,t){void 0===t&&(t=null);var s=n.call(this,e||void 0)||this,r=t||{};return s._width=Number(r.width||0),s._height=Number(r.height||0),s._fontSize=Number(r.fontSize||16),s._fontStyle=r.fontStyle||"normal",s._fontVariant=r.fontVariant||"normal",s._fontWeight=r.fontWeight||"normal",s._fontFamily=r.fontFamily||"PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Source Han Sans CN,sans-serif",s._font="",s._text=r.text?s.parseText(r.text):"",s._measure=null,s._minwidth=10,s._textcolor=r.textColor||"#000",s._bkColor=r.bkColor||"#f00",s._bkShape=r.bkShape||"rect",s._boundingShape=null,s.anchorPoint={x:.5,y:.5},s.on(catk.EvtUpdate.type,function(e){s.update()}),s.on(catk.EvtGetBoundingShape.type,function(e){s._boundingShape&&(e.shape=s._boundingShape)}),s.on(catk.EvtDraw.type,function(e){if(s._measure){var t=s._measure.width;t<s._minwidth&&(t=s._minwidth);var r=s._fontSize,n=Math.max(s._width,t),o=Math.max(s._height,r);switch(s._bkShape){case"rect":e.canvas.context.fillStyle=s._bkColor,e.canvas.context.fillRect(-n*s.anchorPoint.x,-o*s.anchorPoint.y,n,o);break;case"ellipse":e.canvas.context.fillStyle=s._bkColor,e.canvas.context.beginPath(),e.canvas.context.ellipse(-n*s.anchorPoint.x+n/2,-o*s.anchorPoint.y+o/2,n/2,o/2,0,0,2*Math.PI),e.canvas.context.closePath(),e.canvas.context.fill()}var i=(n-t)/2-n*s.anchorPoint.x,a=(o-r)/2-o*s.anchorPoint.y;e.canvas.context.fillStyle=s._textcolor,e.canvas.context.font=s._font,e.canvas.context.fillText(s._text,i,a,t)}}),s.on(whiteboard.WBGetPropertyEvent.type,function(e){switch(e.name){case"text":e.value=s.text;break;case"textColor":e.value=s._textcolor;break;case"fontSize":e.value=s.fontSize;break;case"fontWeight":e.value=s.fontWeight;break;case"fontStyle":e.value=s.fontStyle;break;case"width":e.value=s._width;break;case"height":e.value=s._height;break;case"bkColor":e.value=s.bkColor;break;case"bkShape":e.value=s.bkShape}}),s.on(whiteboard.WBSetPropertyEvent.type,function(e){switch(e.name){case"text":s.text=e.value;break;case"textColor":s._textcolor=e.value;break;case"fontSize":s.fontSize=Number(e.value);break;case"fontWeight":s.fontWeight=String(e.value);break;case"fontStyle":s.fontStyle=String(e.value);break;case"width":s.width=Number(e.value);break;case"height":s.height=Number(e.value);break;case"bkColor":s.bkColor=String(e.value);break;case"bkShape":s.bkShape=String(e.value)}}),s.on(whiteboard.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[s.entityType]=e.properties[s.entityType]||{desc:s.entityType,properties:[]},e.properties[s.entityType].properties.push({name:"text",desc:"文字内容",readonly:!1,type:"string",value:s.text}),e.properties[s.entityType].properties.push({name:"textColor",desc:"文字颜色",readonly:!1,type:"color",value:s._textcolor}),e.properties[s.entityType].properties.push({name:"fontSize",desc:"字体大小",readonly:!1,type:"number",value:s.fontSize}),e.properties[s.entityType].properties.push({name:"fontWeight",desc:"字体粗细",readonly:!1,type:"string",value:s._fontWeight,enum:[{value:"normal",desc:"正常"},{value:"bold",desc:"粗体"},{value:"bolder",desc:"加粗"},{value:"lighter",desc:"纤细"}]}),e.properties[s.entityType].properties.push({name:"fontStyle",desc:"字体样式",readonly:!1,type:"string",value:s._fontStyle,enum:[{value:"normal",desc:"正常"},{value:"italic",desc:"斜体"}]}),e.properties[s.entityType].properties.push({name:"width",desc:"宽度",readonly:!1,type:"number",value:s.width}),e.properties[s.entityType].properties.push({name:"height",desc:"高度",readonly:!1,type:"number",value:s.height}),e.properties[s.entityType].properties.push({name:"bkColor",desc:"背景颜色",readonly:!1,type:"color",value:s.bkColor}),e.properties[s.entityType].properties.push({name:"bkShape",desc:"背景样式",readonly:!1,type:"string",value:s.bkShape,enum:[{value:"none",desc:"无"},{value:"rect",desc:"矩形"},{value:"ellipse",desc:"圆形"}]})}),s}return r(e,n),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){var t=this.parseText(e);t!==this._text&&(this._text=t,this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),e.prototype.setAnchorPoint=function(e){n.prototype.setAnchorPoint.call(this,e),this._boundingShape=null},Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e!==this._fontSize&&(this._fontSize=e,this._font="",this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){e!==this._fontWeight&&(this._fontWeight=e,this._font="",this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){e!==this._fontStyle&&(this._fontStyle=e,this._font="",this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(e){e!==this._height&&(this._height=e,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bkColor",{get:function(){return this._bkColor},set:function(e){this._bkColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bkShape",{get:function(){return this._bkShape},set:function(e){this._bkShape=e},enumerable:!0,configurable:!0}),e.prototype.parseText=function(e){var t=/\{\{[^\{\}]*\}\}/g,r=e.split(t);if(1===r.length)return e;for(;;){var n=t.exec(e);if(null===n)break;var o=String(new Function("return "+n[0].slice(2,n[0].length-2))());r.splice(1,0,o)}return r.join("")},e.prototype.update=function(){if(""===this._font&&(this._font=this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+this._fontSize+"px "+this._fontFamily,this._boundingShape=null),this.view&&null===this._measure&&(this.view.canvas.context.textAlign="left",this.view.canvas.context.textBaseline="hanging",this.view.canvas.context.font=this._font,this._measure=this.view.canvas.context.measureText(this._text),this._boundingShape=null),this._measure&&!this._boundingShape){var e=Math.max(this._measure.width,this._minwidth),t=this._fontSize,r=Math.max(e,this._width),n=Math.max(t,this._height);this._boundingShape=new catk.BoundingBox({x:-r*this.anchorPoint.x,y:-n*this.anchorPoint.y,w:r,h:n})}},e}(catk.SceneObject);t.WBLabel=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCreationProperties=function(){return[{name:"text",desc:"文字内容",readonly:!1,type:"string",value:"标签"},{name:"textColor",desc:"文字颜色",readonly:!1,type:"color",value:"#000"},{name:"fontSize",desc:"字体大小",readonly:!1,type:"number",value:16},{name:"fontWeight",desc:"字体粗细",readonly:!1,type:"string",value:"normal",enum:[{value:"normal",desc:"正常"},{value:"bold",desc:"粗体"},{value:"bolder",desc:"加粗"},{value:"lighter",desc:"纤细"}]},{name:"fontStyle",desc:"字体样式",readonly:!1,type:"string",value:"normal",enum:[{value:"normal",desc:"正常"},{value:"italic",desc:"斜体"}]},{name:"width",desc:"宽度",readonly:!1,type:"number",value:0},{name:"height",desc:"高度",readonly:!1,type:"number",value:0},{name:"bkColor",desc:"背景颜色",readonly:!1,type:"color",value:"#0000ff"},{name:"bkShape",desc:"背景样式",readonly:!1,type:"string",value:"none",enum:[{value:"none",desc:"无"},{value:"rect",desc:"矩形"},{value:"ellipse",desc:"圆形"}]}]},t.prototype._createEntity=function(e){return new o(null,e)},t}(whiteboard.WBFactory);t.WBLabelFactory=i});unwrapExports(label);var label_1=label.WBLabel,label_2=label.WBLabelFactory,arrow=createCommonjsModule(function(e,t){var n,r=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(o){function e(e,t){void 0===t&&(t=null);var r=o.call(this,e||void 0)||this,n=t||{};return r._lineWidth=Number(n.lineWidth||1),r._arrowLen=Number(n.arrowLen||15),r._style=n.style||"single",r._color=n.color||"#000000",r._objectFrom=n.objectFrom||null,r._positionFrom={x:void 0===n.positionFromX?0:Number(n.positionFromX),y:void 0===n.positionFromY?0:Number(n.positionFromY)},r._objectTo=n.objectTo||null,r._positionTo={x:void 0===n.positionToX?0:Number(n.positionToX),y:void 0===n.positionToY?0:Number(n.positionToY)},r._segment=null,r._boundingShape=null,r.on(catk.EvtUpdate.type,function(e){r.update()}),r.on(catk.EvtGetBoundingShape.type,function(e){r._boundingShape||r.update(),r._boundingShape&&(e.shape=r._boundingShape)}),r.on(catk.EvtDraw.type,function(e){if(r._segment)if("none"===r._style)e.canvas.context.strokeStyle=r._color,e.canvas.context.lineWidth=r._lineWidth,e.canvas.context.beginPath(),e.canvas.context.moveTo(r._segment.start.x,r._segment.start.y),e.canvas.context.lineTo(r._segment.end.x,r._segment.end.y),e.canvas.context.stroke();else{var t="double"===r._style;r.drawArrow(e.canvas.context,r._segment.end.x,r._segment.end.y,r._segment.start.x,r._segment.start.y,30,r._arrowLen,r._lineWidth,r._color,t)}}),r.on(whiteboard.WBGetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":e.value=r._lineWidth;break;case"arrowLen":e.value=r._arrowLen;break;case"style":e.value=r._style;break;case"color":e.value=r._color;break;case"objectFrom":e.value=r._objectFrom||"";break;case"positionFromX":e.value=r._positionFrom?r._positionFrom.x:null;break;case"positionFromY":e.value=r._positionFrom?r._positionFrom.y:null;break;case"objectTo":e.value=r._objectTo||"";break;case"positionToX":e.value=r._positionTo?r._positionTo.x:null;break;case"positionToY":e.value=r._positionTo?r._positionTo.y:null}}),r.on(whiteboard.WBSetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":r._lineWidth=Number(e.value);break;case"arrowLen":r._arrowLen=Number(e.value);break;case"style":r._style=String(e.value);break;case"color":r._color=String(e.value);break;case"objectFrom":r._objectFrom=""===e.value?null:String(e.value);break;case"positionFromX":r._positionFrom||(r._positionFrom={x:0,y:0}),r._positionFrom.x=Number(e.value);break;case"positionFromY":r._positionFrom||(r._positionFrom={x:0,y:0}),r._positionFrom.y=Number(e.value);break;case"objectTo":r._objectTo=""===e.value?null:String(e.value);break;case"positionToX":r._positionTo||(r._positionTo={x:0,y:0}),r._positionTo.x=Number(e.value);break;case"positionToY":r._positionTo||(r._positionTo={x:0,y:0}),r._positionTo.y=Number(e.value)}}),r.on(whiteboard.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[r.entityType]=e.properties[r.entityType]||{desc:r.entityType,properties:[]},e.properties[r.entityType].properties.push({name:"lineWidth",desc:"线宽",readonly:!1,type:"number",value:r._lineWidth}),e.properties[r.entityType].properties.push({name:"arrowLen",desc:"箭头长度",readonly:!1,type:"number",value:r._arrowLen}),e.properties[r.entityType].properties.push({name:"style",desc:"箭头样式",readonly:!1,type:"string",value:r._style,enum:[{value:"none",desc:"无"},{value:"single",desc:"单向箭头"},{value:"double",desc:"双向箭头"}]}),e.properties[r.entityType].properties.push({name:"color",desc:"颜色",readonly:!1,type:"color",value:r._color}),e.properties[r.entityType].properties.push({name:"objectFrom",desc:"绑定出发节点",readonly:!1,type:"string",value:r._objectFrom||""}),e.properties[r.entityType].properties.push({name:"positionFromX",desc:"出发点X坐标",readonly:!1,type:"number",value:r._positionFrom?r._positionFrom.x:null}),e.properties[r.entityType].properties.push({name:"positionFromY",desc:"出发点Y坐标",readonly:!1,type:"number",value:r._positionFrom?r._positionFrom.y:null}),e.properties[r.entityType].properties.push({name:"objectTo",desc:"绑定到达节点",readonly:!1,type:"string",value:r._objectTo||""}),e.properties[r.entityType].properties.push({name:"positionToX",desc:"到达点X坐标",readonly:!1,type:"number",value:r._positionTo?r._positionTo.x:null}),e.properties[r.entityType].properties.push({name:"positionToY",desc:"到达点Y坐标",readonly:!1,type:"number",value:r._positionTo?r._positionTo.y:null})}),r}return r(e,o),e.prototype.getSegment=function(){if(!this._positionFrom||!this._positionTo)return null;var e,t,r=this.worldTransform,n=r.transformPoint(this._positionFrom),o=r.transformPoint(this._positionTo),i={start:{x:n.x,y:n.y},end:{x:o.x,y:o.y}},a=null,s=null,c=null,u=null;if(this._objectFrom){var l=new whiteboard.WBGetObjectEvent(this._objectFrom);catk.App.triggerEvent(null,l),(a=l.object||null)&&(s=a.worldTransform,i.start.x=s.e,i.start.y=s.f)}if(this._objectTo){l=new whiteboard.WBGetObjectEvent(this._objectTo);catk.App.triggerEvent(null,l),(c=l.object||null)&&(u=c.worldTransform,i.end.x=u.e,i.end.y=u.f)}a&&s&&((t=(e=a.boundingShape)?catk.IntersectionTestShapeSegment(e.getTransformedShape(s),i):null)&&0<t.length&&(i.start=t[0]));c&&u&&((t=(e=c.boundingShape)?catk.IntersectionTestShapeSegment(e.getTransformedShape(u),i):null)&&0<t.length&&(i.end=t[0]));var p=catk.Matrix2d.invert(r);return i.start=p.transformPoint(i.start),i.end=p.transformPoint(i.end),i},e.prototype.drawArrow=function(e,t,r,n,o,i,a,s,c,u){var l=180*Math.atan2(r-o,t-n)/Math.PI,p=(l+i)*Math.PI/180,h=(l-i)*Math.PI/180,f=a*Math.cos(p),d=a*Math.sin(p),m=a*Math.cos(h),y=a*Math.sin(h);e.beginPath();var g=t-f,v=r-d;e.moveTo(g,v),e.lineTo(t,r),g=t-m,v=r-y,e.lineTo(g,v),e.moveTo(t,r),e.lineTo(n,o),u&&(g=n+f,v=o+d,e.moveTo(g,v),e.lineTo(n,o),g=n+m,v=o+y,e.lineTo(g,v)),e.strokeStyle=c,e.lineWidth=s,e.stroke()},e.prototype.update=function(){if(this._segment=this.getSegment(),this._segment){var e=catk.GetVector(this._segment.start,this._segment.end),t=catk.VectorLength(e),r=Math.floor(this._lineWidth/2+3),n=r*e.y/t,o=-r*e.x/t;null===this._boundingShape?this._boundingShape=new catk.BoundingHull:this._boundingShape.clear(),this._boundingShape.addPoint({x:this._segment.start.x+n,y:this._segment.start.y+o}),this._boundingShape.addPoint({x:this._segment.start.x-n,y:this._segment.start.y-o}),this._boundingShape.addPoint({x:this._segment.end.x-n,y:this._segment.end.y-o}),this._boundingShape.addPoint({x:this._segment.end.x+n,y:this._segment.end.y+o})}},e}(catk.SceneObject);t.WBArrow=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCreationProperties=function(){return[{name:"lineWidth",desc:"线宽",readonly:!1,type:"number",value:3},{name:"arrowLen",desc:"箭头长度",readonly:!1,type:"number",value:15},{name:"style",desc:"箭头样式",readonly:!1,type:"string",value:"single",enum:[{value:"none",desc:"无"},{value:"single",desc:"单向箭头"},{value:"double",desc:"双向箭头"}]},{name:"color",desc:"颜色",readonly:!1,type:"color",value:"#000000"}]},t.prototype._createEntity=function(e){return new o(null,e)},t}(whiteboard.WBFactory);t.WBArrowFactory=i});unwrapExports(arrow);var arrow_1=arrow.WBArrow,arrow_2=arrow.WBArrowFactory,freedraw=createCommonjsModule(function(e,t){var n,r=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(n){function e(e,t){void 0===t&&(t=null);var o=n.call(this,e||void 0)||this;o._canvas=null,o._boundingShape=null,o._cp=[],o._lastMoveTime=0,o._action=!1;var r=t||{};return o._lineWidth=Number(r.lineWidth||1),o._color=r.color||"#000000",o._mode=r.mode||"draw",o._mousePosX=0,o._mousePosY=0,o._eraseSize=r.eraseSize||20,o._curveMode=r.curveMode||0,o.on(catk.EvtCanvasResize.type,function(e){e.view===o.view&&o._canvas&&(o._canvas.width=e.view.canvas.width,o._canvas.height=e.view.canvas.height,o._boundingShape&&(o._boundingShape.rect={x:0,y:0,w:o._canvas.width,h:o._canvas.height}))}),o.on(catk.EvtGetBoundingShape.type,function(e){null===o._boundingShape&&o.canvas&&(o._boundingShape=new catk.BoundingBox({x:0,y:0,w:o.canvas.width,h:o.canvas.height})),o._boundingShape&&(e.shape=o._boundingShape)}),o.on(catk.EvtHitTest.type,function(e){var t=o.canvas;if(t&&0<=e.x&&e.x<t.width&&0<=e.y&&e.y<t.height){var r=t.getContext("2d");if(r){var n=r.getImageData(e.x,e.y,1,1);n&&0<n.data[3]&&(e.result=!0)}}e.eat()}),o.on(catk.EvtDraw.type,function(e){if(o.canvas){var t=o.canvas.width,r=o.canvas.height;e.canvas.context.drawImage(o.canvas,-Math.round(t*o.anchorPoint.x)-.5,-Math.round(r*o.anchorPoint.y)-.5,t,r),"erase"===o._mode&&(e.canvas.context.strokeStyle="#000000",e.canvas.context.strokeRect(Math.round(o._mousePosX-o._eraseSize/2),Math.round(o._mousePosY-o._eraseSize/2),o._eraseSize,o._eraseSize))}}),o.on(catk.EvtMouseDown.type,function(e){var t=catk.Matrix2d.invert(o.worldTransform).transformPoint({x:e.x,y:e.y});if(o.canvas)if("draw"===o._mode)(r=o.canvas.getContext("2d"))&&(r.lineWidth=o._lineWidth,r.strokeStyle=o._color,r.lineCap="round",r.lineJoin="round",r.beginPath(),r.moveTo(t.x+.5,t.y+.5),o._cp.length=0,o._action=!0);else if("erase"===o._mode){var r;(r=o.canvas.getContext("2d"))&&(r.clearRect(t.x-o._eraseSize/2,t.y-o._eraseSize/2,o._eraseSize,o._eraseSize),o._action=!0)}}),o.on(catk.EvtMouseMove.type,function(e){if(o._mousePosX=e.x,o._mousePosY=e.y,o._action&&o.canvas){var t=catk.Matrix2d.invert(o.worldTransform).transformPoint({x:e.x,y:e.y});if("draw"===o._mode)(r=o.canvas.getContext("2d"))&&(0===o._curveMode?(r.lineTo(t.x+.5,t.y+.5),r.stroke()):1===o._curveMode?1===o._cp.length?(r.quadraticCurveTo(o._cp[0].x+.5,o._cp[0].y+.5,t.x+.5,t.y+.5),r.stroke(),o._cp.length=0):(o._cp.push({x:t.x,y:t.y}),o._lastMoveTime=Date.now()):2===o._curveMode&&(2===o._cp.length?(r.bezierCurveTo(o._cp[0].x+.5,o._cp[0].y+.5,o._cp[1].x+.5,o._cp[1].y+.5,t.x+.5,t.y+.5),r.stroke(),o._cp.length=0):(o._cp.push({x:t.x,y:t.y}),o._lastMoveTime=Date.now())));else if("erase"===o._mode){var r;(r=o.canvas.getContext("2d"))&&r.clearRect(t.x-o._eraseSize/2,t.y-o._eraseSize/2,o._eraseSize,o._eraseSize)}}}),o.on(catk.EvtFrame.type,function(e){"draw"===o._mode&&o._action&&(Date.now()>o._lastMoveTime+250&&o.finishDraw())}),o.on(catk.EvtMouseUp.type,function(e){"draw"===o._mode&&o._action&&o.finishDraw(),o._action=!1}),o.on(whiteboard.WBGetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":e.value=o._lineWidth;break;case"color":e.value=o._color;break;case"curveMode":e.value=o._curveMode;break;case"eraseSize":e.value=o._eraseSize}}),o.on(whiteboard.WBSetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":o._lineWidth=Number(e.value);break;case"color":o._color=String(e.value);break;case"curveMode":o._curveMode=Number(e.value);break;case"eraseSize":o._eraseSize=Number(e.value)}}),o.on(whiteboard.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[o.entityType]=e.properties[o.entityType]||{desc:o.entityType,properties:[]},e.properties[o.entityType].properties.push({name:"lineWidth",desc:"画笔宽度",readonly:!1,type:"number",value:o._lineWidth}),e.properties[o.entityType].properties.push({name:"color",desc:"画笔颜色",readonly:!1,type:"color",value:o._color}),e.properties[o.entityType].properties.push({name:"curveMode",desc:"平滑模式",readonly:!1,type:"number",value:o._curveMode,enum:[{value:0,desc:"无"},{value:1,desc:"二次样条"},{value:2,desc:"三次样条"}]}),e.properties[o.entityType].properties.push({name:"eraseSize",desc:"橡皮宽度",readonly:!1,type:"number",value:o._eraseSize})}),o}return r(e,n),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode!==e&&("draw"===this._mode&&this.finishDraw(),this._action=!1,this._mode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return null===this._canvas&&this.view&&(this._canvas=document.createElement("canvas"),this._canvas.style.backgroundColor="#00000000",this._canvas.width=this.view.canvas.width,this._canvas.height=this.view.canvas.height,this._boundingShape&&(this._boundingShape=new catk.BoundingBox({x:0,y:0,w:this._canvas.width,h:this._canvas.height}))),this._canvas},enumerable:!0,configurable:!0}),e.prototype.finishDraw=function(){if(this.canvas&&"draw"===this._mode&&0<this._cp.length){var e=this.canvas.getContext("2d");e&&(1===this._cp.length?e.lineTo(this._cp[0].x+.5,this._cp[0].y+.5):this._cp.length&&e.quadraticCurveTo(this._cp[0].x+.5,this._cp[0].y+.5,this._cp[1].x+.5,this._cp[1].y+.5),e.stroke(),this._cp.length=0)}},e}(catk.SceneObject);t.WBFreeDraw=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCreationProperties=function(){return[{name:"lineWidth",desc:"画笔宽度",readonly:!1,type:"number",value:3},{name:"color",desc:"颜色",readonly:!1,type:"color",value:"#000000"},{name:"curveMode",desc:"平滑模式",readonly:!1,type:"number",value:0,enum:[{value:0,desc:"无"},{value:1,desc:"二次样条"},{value:2,desc:"三次样条"}]},{name:"eraseSize",desc:"橡皮宽度",readonly:!1,type:"number",value:20}]},t.prototype._createEntity=function(e){return new o(null,e)},t}(whiteboard.WBFactory);t.WBFreeDrawFactory=i});unwrapExports(freedraw);var freedraw_1=freedraw.WBFreeDraw,freedraw_2=freedraw.WBFreeDrawFactory,factory=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.installFactories=function(e){e.addFactory(new label.WBLabelFactory("Label")),e.addFactory(new arrow.WBArrowFactory("Arrow")),e.addFactory(new freedraw.WBFreeDrawFactory("FreeDraw"))}});unwrapExports(factory);var factory_1=factory.installFactories,objects=createCommonjsModule(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(label),t(arrow),t(freedraw),t(factory)});unwrapExports(objects);var select=createCommonjsModule(function(e,t){var n,i=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(r){function n(e){var t=r.call(this,n.type)||this;return t.selectIndex=e,t}return i(n,r),n.type="@WBSelect",n}(catk.BaseEvent);t.WBSelectEvent=o;var a=function(e){function t(){return e.call(this,t.type)||this}return i(t,e),t.type="@WBDeselect",t}(catk.BaseEvent);t.WBDeselectEvent=a;var s=function(r){function n(e){var t=r.call(this,n.type)||this;return t.objects=e,t}return i(n,r),n.type="@WBObjectSelected",n}(catk.BaseEvent);t.WBObjectSelectedEvent=s;var c=function(r){function n(e){var t=r.call(this,n.type)||this;return t.objects=e,t}return i(n,r),n.type="@WBObjectMoved",n}(catk.BaseEvent);t.WBObjectMovedEvent=c;var u=function(n){function o(e,t){var r=n.call(this,o.type)||this;return r.object=e,r.objects=t,r}return i(o,n),o.type="@WBObjectDeselected",o}(catk.BaseEvent);t.WBObjectDeselectedEvent=u;var l=function(t){function r(e){var n=t.call(this,r.type)||this;return n.tool=e,n._selected=!1,n.on(catk.EvtDraw.type,function(e){if(n._selected){var t=n.object.boundingShape;if(t){var r=t.getBoundingbox();r&&(e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.strokeRect(r.x,r.y,r.w,r.h))}}}),n.on(o.type,function(e){n._selected=!0}),n.on(a.type,function(e){n._selected=!1}),n}return i(r,t),r.type="WBSelect",r}(catk.Component);t.WBSelectComponent=l;var r=function(r){function n(e){var t=r.call(this,n.toolname,e)||this;return t._selectedObjects=[],t._moving=!1,t._rangeSelecting=!1,t._mouseStartPosX=0,t._mouseStartPosY=0,t._mouseCurrentPosX=0,t._mouseCurrentPosY=0,t}return i(n,r),Object.defineProperty(n.prototype,"selectedObjects",{get:function(){return this._selectedObjects},enumerable:!0,configurable:!0}),n.prototype.activate=function(e){var o=this;r.prototype.activate.call(this,e),this._selectedObjects.length=0,this.on(catk.EvtKeyDown.type,function(e){1===o._selectedObjects.length&&o._selectedObjects[0].triggerEx(e)}),this.on(catk.EvtKeyUp.type,function(e){1===o._selectedObjects.length&&o._selectedObjects[0].triggerEx(e)}),this.on(catk.EvtKeyPress.type,function(e){1===o._selectedObjects.length&&o._selectedObjects[0].triggerEx(e)}),this.on(catk.EvtMouseDown.type,function(e){o._mouseStartPosX=e.x,o._mouseStartPosY=e.y;var t=o._wb.view;if(t){var r=t.hitObjects;1<r.length?(o.selectObject(r[0],e),o._moving=!0,o._rangeSelecting=!1):(o.deselectAll(),o._rangeSelecting=!0,o._moving=!1,o._mouseCurrentPosX=e.x,o._mouseCurrentPosY=e.y)}}),this.on(catk.EvtMouseMove.type,function(e){if(o._moving){var r=e.x-o._mouseStartPosX,n=e.y-o._mouseStartPosY;o._mouseStartPosX=e.x,o._mouseStartPosY=e.y,o._selectedObjects.forEach(function(e){var t=e.translation;e.translation={x:t.x+r,y:t.y+n}})}else if(o._rangeSelecting){var t=o._wb.view;t&&t.rootNode&&(o.rangeSelectR(t.rootNode,o._mouseStartPosX,o._mouseStartPosY,e.x-o._mouseStartPosX,e.y-o._mouseStartPosY),o._mouseCurrentPosX=e.x,o._mouseCurrentPosY=e.y)}}),this.on(catk.EvtMouseUp.type,function(e){o._moving&&o._selectedObjects&&0<o._selectedObjects.length&&catk.App.triggerEvent(null,new c(o._selectedObjects)),o._moving=!1,o._rangeSelecting=!1}),this.on(catk.EvtDraw.type,function(e){o._rangeSelecting&&(e.canvas.context.save(),e.canvas.context.setTransform(1,0,0,1,.5,.5),e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.setLineDash([6,3]),e.canvas.context.beginPath(),e.canvas.context.moveTo(o._mouseStartPosX,o._mouseStartPosY),e.canvas.context.lineTo(o._mouseCurrentPosX,o._mouseStartPosY),e.canvas.context.lineTo(o._mouseCurrentPosX,o._mouseCurrentPosY),e.canvas.context.moveTo(o._mouseStartPosX,o._mouseStartPosY),e.canvas.context.lineTo(o._mouseStartPosX,o._mouseCurrentPosY),e.canvas.context.lineTo(o._mouseCurrentPosX,o._mouseCurrentPosY),e.canvas.context.stroke(),e.canvas.context.restore())})},n.prototype.deactivate=function(){this.off(catk.EvtKeyDown.type),this.off(catk.EvtKeyUp.type),this.off(catk.EvtKeyPress.type),this.off(catk.EvtMouseDown.type),this.off(catk.EvtMouseMove.type),this.off(catk.EvtMouseUp.type),this.off(catk.EvtDraw.type),r.prototype.deactivate.call(this)},n.prototype.activateObject=function(e){this.deactivateObject(e),e.addComponent(new l(this))},n.prototype.deactivateObject=function(e){var t=e.getComponents(l.type);t&&0<t.length&&(this.deselectObject(e),e.removeComponentsByType(l.type))},n.prototype.executeCommand=function(e){if("GetSelected"===e.command)e.selectedObjects=this._selectedObjects;else if("DeleteSelected"===e.command)0<this._selectedObjects.length&&this._wb.executeCommand({command:"DeleteObjects",objects:this._selectedObjects.map(function(e){return e.entityName})});else if("AlignSelected"===e.command){var t=e.mode;0<this._selectedObjects.length&&this._wb.executeCommand({command:"AlignObjects"+t,objects:this._selectedObjects.map(function(e){return e.entityName})})}else if("ArrangeSelected"===e.command){t=e.mode;0<this._selectedObjects.length&&this._wb.executeCommand({command:"ArrangeObjects"+t,objects:this._selectedObjects.map(function(e){return e.entityName})})}},n.prototype.selectObject=function(e,t){this._selectedObjects.indexOf(e)<0&&(!t||(catk.EvtSysInfo.isMac()?t.metaDown:t.ctrlDown)||this.deselectAll(),this.selectedObjects.push(e),e.triggerEx(new o(this.selectedObjects.length)),catk.App.triggerEvent(null,new s(this._selectedObjects)))},n.prototype.deselectObject=function(e){var t=this._selectedObjects.indexOf(e);0<=t&&(e.triggerEx(new a),this.selectedObjects.splice(t,1),catk.App.triggerEvent(null,new u(e,this._selectedObjects)))},n.prototype.deselectAll=function(){for(;0<this.selectedObjects.length;)this.deselectObject(this.selectedObjects[this.selectedObjects.length-1])},n.prototype.rangeSelectR=function(e,o,i,a,s){var c=this;e.forEachChild(function(e){if(0===a||0===s)c.deselectObject(e);else{var t=e.boundingShape;if(t){var r=catk.Matrix2d.invert(e.worldTransform),n=[r.transformPoint({x:o,y:i}),r.transformPoint({x:o,y:i+s}),r.transformPoint({x:o+a,y:i+s}),r.transformPoint({x:o+a,y:i})];catk.IntersectionTestShapeHull(t,n)?c.selectObject(e,null):c.deselectObject(e)}c.rangeSelectR(e,o,i,a,s)}})},n.toolname="Select",n}(whiteboard.WBTool);t.WBSelectTool=r});unwrapExports(select);var select_1=select.WBSelectEvent,select_2=select.WBDeselectEvent,select_3=select.WBObjectSelectedEvent,select_4=select.WBObjectMovedEvent,select_5=select.WBObjectDeselectedEvent,select_6=select.WBSelectComponent,select_7=select.WBSelectTool,swap=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(t){function r(e){var n=t.call(this,r.type)||this;return n.tool=e,n.selected=!1,n.on(catk.EvtMouseDown.type,function(e){n.tool.currentObject?n.tool.currentObject.getComponent(r.type,0).selected=!1:n.selected=!0,n.tool.selectObject(n.object,e)}),n.on(catk.EvtDraw.type,function(e){if(n.selected){var t=n.object.boundingShape;if(t){var r=t.getBoundingbox();r&&(e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.strokeRect(r.x,r.y,r.w,r.h))}}}),n}return o(r,t),r.type="WBSwap",r}(catk.Component);t.WBSwapComponent=i;var r=function(r){function n(e){var t=r.call(this,n.toolname,e)||this;return t._curObject=null,t}return o(n,r),Object.defineProperty(n.prototype,"currentObject",{get:function(){return this._curObject},enumerable:!0,configurable:!0}),n.prototype.activate=function(e){r.prototype.activate.call(this,e),this._curObject=null},n.prototype.deactivate=function(){this._curObject&&(this._curObject.triggerEx(new select.WBDeselectEvent),this._curObject=null),r.prototype.deactivate.call(this)},n.prototype.activateObject=function(e){this.deactivateObject(e),e.addComponent(new i(this))},n.prototype.deactivateObject=function(e){e.removeComponentsByType(i.type)},n.prototype.selectObject=function(e,t){null==this._curObject?this._curObject=e:(this._curObject!==e&&this.swapObject(this._curObject,e,200),this._curObject=null)},n.prototype.swapObject=function(e,t,r){var n=e.translation,o=t.translation;(t.getComponents(catk.CoKeyframeAnimation.type)||[]).forEach(function(e){e.finish(),t.removeComponentsByType(catk.CoKeyframeAnimation.type)}),t.addComponent(new catk.CoKeyframeAnimation({delay:0,repeat:1,exclusive:!0,tracks:{translation:{cp:[{x:0,y:[o.x,o.y]},{x:r,y:[n.x,n.y]}],type:catk.SplineType.LINEAR}}})),e.addComponent(new catk.CoKeyframeAnimation({delay:0,repeat:1,exclusive:!0,tracks:{translation:{cp:[{x:0,y:[n.x,n.y]},{x:r,y:[o.x,o.y]}],type:catk.SplineType.LINEAR}}}))},n.toolname="Swap",n}(whiteboard.WBTool);t.WBSwapTool=r});unwrapExports(swap);var swap_1=swap.WBSwapComponent,swap_2=swap.WBSwapTool,create=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function n(e){var t=r.call(this,n.toolname,e)||this;return t.options={},t._factoryProperties=[],t._creationParams={},t}return o(n,r),n.prototype.activate=function(t){var n=this;t&&(this.options=t,void 0===this._creationParams[t.createType]&&(this._creationParams[t.createType]={},this._factoryProperties=this._wb.getFactory(t.createType).getCreationProperties(),this._factoryProperties&&this._factoryProperties.forEach(function(e){n._creationParams[t.createType][e.name]=e.value}))),this.on(catk.EvtMouseDown.type,function(e){var t={command:"CreateObject",type:n.options.createType,name:null};for(var r in n.options)"command"!==r&&"createType"!==r&&"type"!==r&&(t[r]=n.options[r]);t.x=e.x,t.y=e.y,t.params=n._creationParams[n.options.createType],n._wb.executeCommand(t)}),this.on(whiteboard.WBGetPropertyEvent.type,function(e){e.name in n._creationParams[n.options.createType]&&(e.value=n._creationParams[n.options.createType][e.name])}),this.on(whiteboard.WBSetPropertyEvent.type,function(e){e.name in n._creationParams[n.options.createType]&&(n._creationParams[n.options.createType][e.name]=e.value)}),this.on(whiteboard.WBGetPropertyListEvent.type,function(e){n._factoryProperties&&0<n._factoryProperties.length&&(e.properties=e.properties||{},e.properties[n.options.createType]=e.properties[n.options.createType]||{desc:n.options.createType,properties:[]},e.properties[n.options.createType].properties=n._factoryProperties)}),r.prototype.activate.call(this,t)},n.prototype.deactivate=function(){this.off(catk.EvtMouseDown.type),this.options={},r.prototype.deactivate.call(this)},n.toolname="Create",n}(whiteboard.WBTool);t.WBCreateTool=r});unwrapExports(create);var create_1=create.WBCreateTool,connect=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function n(e){var t=r.call(this,n.toolname,e)||this;return t._createParams={lineWidth:3,arrowLen:15,style:"single",color:"#000000",objectFrom:null,positionFromX:0,positionFromY:0,objectTo:null,positionToX:0,positionToY:0},t._moving=!1,t.on(whiteboard.WBGetPropertyEvent.type,function(e){e.name in t._createParams&&(e.value=t._createParams[e.name])}),t.on(whiteboard.WBSetPropertyEvent.type,function(e){e.name in t._createParams&&(t._createParams[e.name]=e.value)}),t.on(whiteboard.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[t.name]=e.properties[t.name]||{desc:"画笔工具",properties:[]},e.properties[t.name].properties.push({name:"lineWidth",desc:"线宽",readonly:!1,type:"number",value:t._createParams.lineWidth}),e.properties[t.name].properties.push({name:"arrowLen",desc:"箭头长度",readonly:!1,type:"number",value:t._createParams.arrowLen}),e.properties[t.name].properties.push({name:"style",desc:"箭头样式",readonly:!1,type:"string",value:t._createParams.style,enum:[{value:"none",desc:"无"},{value:"single",desc:"单向箭头"},{value:"double",desc:"双向箭头"}]}),e.properties[t.name].properties.push({name:"color",desc:"颜色",readonly:!1,type:"color",value:t._createParams.color})}),t}return o(n,r),n.prototype.activate=function(e){var o=this;r.prototype.activate.call(this,e),this._moving=!1,this.on(catk.EvtMouseDown.type,function(e){var t=o._wb.view;if(t){o._moving=!0,o._createParams.objectFrom=null,o._createParams.objectTo=null,o._createParams.positionToX=e.x,o._createParams.positionToY=e.y;var r=t.hitObjects;1<r.length&&"Arrow"!==r[0].entityType?o._createParams.objectFrom=r[0]:(o._createParams.positionFromX=e.x,o._createParams.positionFromY=e.y)}}),this.on(catk.EvtMouseMove.type,function(e){if(o._moving){var t=o._wb.view;if(t){var r=t.hitObjects;1<r.length&&r[0]!==o._createParams.objectFrom&&"Arrow"!==r[0].entityType?o._createParams.objectTo=r[0]:(o._createParams.objectTo=null,o._createParams.positionToX=e.x,o._createParams.positionToY=e.y)}}}),this.on(catk.EvtMouseUp.type,function(e){o._moving=!1;var t=0,r=0;o._createParams.objectFrom&&o._createParams.objectTo?(o._createParams.objectFrom=o._createParams.objectFrom.entityName,o._createParams.objectTo=o._createParams.objectTo.entityName):o._createParams.objectFrom?(o._createParams.objectFrom=o._createParams.objectFrom.entityName,t=o._createParams.positionToX,r=o._createParams.positionToY,o._createParams.positionToX=0,o._createParams.positionToY=0):(o._createParams.objectTo?(o._createParams.objectTo=o._createParams.objectTo.entityName,t=o._createParams.positionFromX,r=o._createParams.positionFromY):(t=o._createParams.positionFromX,r=o._createParams.positionFromY,o._createParams.positionToX-=t,o._createParams.positionToY-=r),o._createParams.positionFromX=0,o._createParams.positionFromY=0);var n={command:"CreateObject",type:"Arrow",name:null,x:t,y:r,params:o._createParams};o._wb.executeCommand(n)}),this.on(catk.EvtDraw.type,function(e){if(o._moving){if(e.canvas.context.save(),e.canvas.context.setTransform(1,0,0,1,.5,.5),e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.setLineDash([6,3]),e.canvas.context.beginPath(),o._createParams.objectFrom){var t=o._createParams.objectFrom.worldTransform;e.canvas.context.moveTo(t.e,t.f)}else e.canvas.context.moveTo(o._createParams.positionFromX,o._createParams.positionFromY);if(o._createParams.objectTo){t=o._createParams.objectTo.worldTransform;e.canvas.context.lineTo(t.e,t.f)}else e.canvas.context.lineTo(o._createParams.positionToX,o._createParams.positionToY);e.canvas.context.stroke(),e.canvas.context.restore()}})},n.prototype.deactivate=function(){this.off(catk.EvtMouseDown.type),this.off(catk.EvtMouseMove.type),this.off(catk.EvtMouseUp.type),r.prototype.deactivate.call(this)},n.prototype.activateObject=function(e){r.prototype.activateObject.call(this,e)},n.prototype.deactivateObject=function(e){r.prototype.deactivateObject.call(this,e)},n.prototype.executeCommand=function(e){},n.toolname="Connect",n}(whiteboard.WBTool);t.WBConnectTool=r});unwrapExports(connect);var connect_1=connect.WBConnectTool,handwriting=createCommonjsModule(function(e,t){var n,r=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(n){function t(e){var r=n.call(this,t.toolname,e)||this;return r._freedrawNode=null,r._mode="draw",r._paramsDraw={color:"#000",lineWidth:2,curveMode:0},r._paramsErase={eraseSize:20},r.on(whiteboard.WBGetPropertyEvent.type,function(e){var t=null;"draw"===r._mode?t=r._paramsDraw:"erase"===r._mode&&(t=r._paramsErase),t&&e.name in t&&(e.value=t[e.name])}),r.on(whiteboard.WBSetPropertyEvent.type,function(e){var t=null;"draw"===r._mode?t=r._paramsDraw:"erase"===r._mode&&(t=r._paramsErase),t&&e.name in t&&(t[e.name]=e.value,r.applyProperty(e.name,e.value))}),r.on(whiteboard.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},"draw"===r._mode?(e.properties[r.name]=e.properties[r.name]||{desc:"画笔工具",properties:[]},e.properties[r.name].properties.push({name:"color",desc:"画笔颜色",readonly:!1,type:"color",value:r._paramsDraw.color}),e.properties[r.name].properties.push({name:"lineWidth",desc:"画笔粗细",readonly:!1,type:"number",value:r._paramsDraw.lineWidth}),e.properties[r.name].properties.push({name:"curveMode",desc:"平滑模式",readonly:!1,type:"number",value:r._paramsDraw.curveMode,enum:[{value:0,desc:"无"},{value:1,desc:"二次样条"},{value:2,desc:"三次样条"}]})):"erase"===r._mode&&(e.properties[r.name]=e.properties[r.name]||{desc:"橡皮工具",properties:[]},e.properties[r.name].properties.push({name:"eraseSize",desc:"橡皮大小",readonly:!1,type:"number",value:r._paramsErase.eraseSize}))}),r}return r(t,n),t.prototype.activate=function(e){if(e&&(this._mode=e.mode||"draw"),this._freedrawNode=this.findFreedrawNode(),!this._freedrawNode){var t={command:"CreateObject",type:"FreeDraw",name:null,x:0,y:0};this._wb.executeCommand(t),this._freedrawNode=t.objectCreated}this._freedrawNode&&(this._freedrawNode.mode=this._mode,this._freedrawNode.setCapture(),this.applyProperties(this._paramsDraw),this.applyProperties(this._paramsErase),n.prototype.activate.call(this,e))},t.prototype.deactivate=function(){this._freedrawNode&&(this._freedrawNode.releaseCapture(),this._freedrawNode.mode="none",this._freedrawNode=null),n.prototype.deactivate.call(this)},t.prototype.activateObject=function(e){n.prototype.activateObject.call(this,e)},t.prototype.deactivateObject=function(e){n.prototype.deactivateObject.call(this,e)},t.prototype.applyProperty=function(e,t){this._freedrawNode&&this._freedrawNode.triggerEx(new whiteboard.WBSetPropertyEvent(e,t))},t.prototype.applyProperties=function(e){for(var t in e)this.applyProperty(t,e[t])},t.prototype.findFreedrawNode=function(e){var t=this._wb.view;if(t){var r=e||t.rootNode;if(r){if("FreeDraw"===r.entityType)return r;for(var n=0;n<r.numChildren;n++){var o=this.findFreedrawNode(r.childAt(n));if(o)return o}}}return null},t.toolname="HandWriting",t}(whiteboard.WBTool);t.WBHandWritingTool=o});unwrapExports(handwriting);var handwriting_1=handwriting.WBHandWritingTool,tool=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.installTools=function(e){e.addTool(new select.WBSelectTool(e)),e.addTool(new swap.WBSwapTool(e)),e.addTool(new create.WBCreateTool(e)),e.addTool(new connect.WBConnectTool(e)),e.addTool(new handwriting.WBHandWritingTool(e))}});unwrapExports(tool);var tool_1=tool.installTools,tools=createCommonjsModule(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(select),t(swap),t(create),t(connect),t(handwriting),t(tool)});unwrapExports(tools);var whiteboard$2=createCommonjsModule(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(editor$2),t(objects),t(tools),t(commands),t(whiteboard)});unwrapExports(whiteboard$2);var aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),i=0,n=2,a=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise(function(n,o){r[i]=function(e){if(a)if(a=!1,e)o(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){a&&(a=!1,o(e))}})}var base64_1=createCommonjsModule(function(e,t){var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;1<--t%4&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var u=new Array(64),c=new Array(123),n=0;n<64;)c[u[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;r.encode=function(e,t,r){for(var n,o=null,i=[],a=0,s=0;t<r;){var c=e[t++];switch(s){case 0:i[a++]=u[c>>2],n=(3&c)<<4,s=1;break;case 1:i[a++]=u[n|c>>4],n=(15&c)<<2,s=2;break;case 2:i[a++]=u[n|c>>6],i[a++]=u[63&c],s=0}8191<a&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),a=0)}return s&&(i[a++]=u[n],i[a++]=61,1===s&&(i[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,i.slice(0,a))),o.join("")):String.fromCharCode.apply(String,i.slice(0,a))};var l="invalid encoding";r.decode=function(e,t,r){for(var n,o=r,i=0,a=0;a<e.length;){var s=e.charCodeAt(a++);if(61===s&&1<i)break;if(void 0===(s=c[s]))throw Error(l);switch(i){case 0:n=s,i=1;break;case 1:t[r++]=n<<2|(48&s)>>4,n=s,i=2;break;case 2:t[r++]=(15&n)<<4|(60&s)>>2,n=s,i=3;break;case 3:t[r++]=(3&n)<<6|s,i=0}}if(1===i)throw Error(l);return r-o},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}),eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float_1=factory$2(factory$2);function factory$2(s){return"undefined"!=typeof Float32Array?function(){var n=new Float32Array([-0]),o=new Uint8Array(n.buffer),e=128===o[3];function t(e,t,r){n[0]=e,t[r]=o[0],t[r+1]=o[1],t[r+2]=o[2],t[r+3]=o[3]}function r(e,t,r){n[0]=e,t[r]=o[3],t[r+1]=o[2],t[r+2]=o[1],t[r+3]=o[0]}function i(e,t){return o[0]=e[t],o[1]=e[t+1],o[2]=e[t+2],o[3]=e[t+3],n[0]}function a(e,t){return o[3]=e[t],o[2]=e[t+1],o[1]=e[t+2],o[0]=e[t+3],n[0]}s.writeFloatLE=e?t:r,s.writeFloatBE=e?r:t,s.readFloatLE=e?i:a,s.readFloatBE=e?a:i}():function(){function e(e,t,r,n){var o=t<0?1:0;if(o&&(t=-t),0===t)e(0<1/t?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(34028234663852886e22<t)e((o<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var i=Math.floor(Math.log(t)/Math.LN2);e((o<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}}function t(e,t,r){var n=e(t,r),o=2*(n>>31)+1,i=n>>>23&255,a=8388607&n;return 255===i?a?NaN:o*(1/0):0===i?1401298464324817e-60*o*a:o*Math.pow(2,i-150)*(a+8388608)}s.writeFloatLE=e.bind(null,writeUintLE),s.writeFloatBE=e.bind(null,writeUintBE),s.readFloatLE=t.bind(null,readUintLE),s.readFloatBE=t.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var n=new Float64Array([-0]),o=new Uint8Array(n.buffer),e=128===o[7];function t(e,t,r){n[0]=e,t[r]=o[0],t[r+1]=o[1],t[r+2]=o[2],t[r+3]=o[3],t[r+4]=o[4],t[r+5]=o[5],t[r+6]=o[6],t[r+7]=o[7]}function r(e,t,r){n[0]=e,t[r]=o[7],t[r+1]=o[6],t[r+2]=o[5],t[r+3]=o[4],t[r+4]=o[3],t[r+5]=o[2],t[r+6]=o[1],t[r+7]=o[0]}function i(e,t){return o[0]=e[t],o[1]=e[t+1],o[2]=e[t+2],o[3]=e[t+3],o[4]=e[t+4],o[5]=e[t+5],o[6]=e[t+6],o[7]=e[t+7],n[0]}function a(e,t){return o[7]=e[t],o[6]=e[t+1],o[5]=e[t+2],o[4]=e[t+3],o[3]=e[t+4],o[2]=e[t+5],o[1]=e[t+6],o[0]=e[t+7],n[0]}s.writeDoubleLE=e?t:r,s.writeDoubleBE=e?r:t,s.readDoubleLE=e?i:a,s.readDoubleBE=e?a:i}():function(){function e(e,t,r,n,o,i){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,o,i+t),e(0<1/n?0:2147483648,o,i+r);else if(isNaN(n))e(0,o,i+t),e(2146959360,o,i+r);else if(17976931348623157e292<n)e(0,o,i+t),e((a<<31|2146435072)>>>0,o,i+r);else{var s;if(n<22250738585072014e-324)e((s=n/5e-324)>>>0,o,i+t),e((a<<31|s/4294967296)>>>0,o,i+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=n*Math.pow(2,-c))>>>0,o,i+t),e((a<<31|c+1023<<20|1048576*s&1048575)>>>0,o,i+r)}}}function t(e,t,r,n,o){var i=e(n,o+t),a=e(n,o+r),s=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+i;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}s.writeDoubleLE=e.bind(null,writeUintLE,0,4),s.writeDoubleBE=e.bind(null,writeUintBE,4,0),s.readDoubleLE=t.bind(null,readUintLE,0,4),s.readDoubleBE=t.bind(null,readUintBE,4,0)}(),s}function writeUintLE(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8_1=createCommonjsModule(function(e,t){var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,o=null,i=[],a=0;t<r;)n=e[t++],i[a++]=n<128?n:191<n&&n<224?(31&n)<<6|63&e[t++]:239<n&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[a++]=55296+(n>>10),56320+(1023&n)):(15&n)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),a=0);return o?(a&&o.push(String.fromCharCode.apply(String,i.slice(0,a))),o.join("")):String.fromCharCode.apply(String,i.slice(0,a))},r.write=function(e,t,r){for(var n,o,i=r,a=0;a<e.length;++a)n=e.charCodeAt(a),t[r++]=n<128?n:(t[r++]=n<2048?n>>6|192:(55296==(64512&n)&&56320==(64512&(o=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&o),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,n>>6&63|128),63&n|128);return r-i}}),pool_1=pool;function pool(r,n,e){var o=e||8192,i=o>>>1,a=null,s=o;return function(e){if(e<1||i<e)return r(e);o<s+e&&(a=r(o),s=0);var t=n.call(a,s,s+=e);return 7&s&&(s=1+(7|s)),t}}var longbits=LongBits;function LongBits(e,t){this.lo=e>>>0,this.hi=t>>>0}var zero=LongBits.zero=new LongBits(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits.zeroHash="\0\0\0\0\0\0\0\0";LongBits.fromNumber=function(e){if(0===e)return zero;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,4294967295<++r&&(r=0,4294967295<++n&&(n=0))),new LongBits(r,n)},LongBits.from=function(e){if("number"==typeof e)return LongBits.fromNumber(e);if(minimal.isString(e)){if(!minimal.Long)return LongBits.fromNumber(parseInt(e,10));e=minimal.Long.fromString(e)}return e.low||e.high?new LongBits(e.low>>>0,e.high>>>0):zero},LongBits.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},LongBits.prototype.toLong=function(e){return minimal.Long?new minimal.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var charCodeAt=String.prototype.charCodeAt;LongBits.fromHash=function(e){return e===zeroHash?zero:new LongBits((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10};var minimal=createCommonjsModule(function(e,t){var n=t;function o(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;++o)void 0!==e[n[o]]&&r||(e[n[o]]=t[n[o]]);return e}function r(e){function r(e,t){if(!(this instanceof r))return new r(e,t);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,r):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),t&&o(this,t)}return(r.prototype=Object.create(Error.prototype)).constructor=r,Object.defineProperty(r.prototype,"name",{get:function(){return e}}),r.prototype.toString=function(){return this.name+": "+this.message},r}n.asPromise=aspromise,n.base64=base64_1,n.EventEmitter=eventemitter,n.float=float_1,n.inquire=inquire_1,n.utf8=utf8_1,n.pool=pool_1,n.LongBits=longbits,n.global="undefined"!=typeof window&&window||void 0!==commonjsGlobal&&commonjsGlobal||"undefined"!=typeof self&&self||commonjsGlobal,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||0<(Array.isArray(r)?r.length:Object.keys(r).length))},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=o,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=r,n.ProtocolError=r("ProtocolError"),n.oneOfGetter=function(e){for(var r={},t=0;t<e.length;++t)r[e[t]]=1;return function(){for(var e=Object.keys(this),t=e.length-1;-1<t;--t)if(1===r[e[t]]&&void 0!==this[e[t]]&&null!==this[e[t]])return e[t]}},n.oneOfSetter=function(r){return function(e){for(var t=0;t<r.length;++t)r[t]!==e&&delete this[r[t]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var r=n.Buffer;r?(n._Buffer_from=r.from!==Uint8Array.from&&r.from||function(e,t){return new r(e,t)},n._Buffer_allocUnsafe=r.allocUnsafe||function(e){return new r(e)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),writer=Writer,BufferWriter,LongBits$1=minimal.LongBits,base64=minimal.base64,utf8=minimal.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;127<e;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer.create=minimal.Buffer?function(){return(Writer.create=function(){return new BufferWriter})()}:function(){return new Writer},Writer.alloc=function(e){return new minimal.Array(e)},minimal.Array!==Array&&(Writer.alloc=minimal.pool(Writer.alloc,minimal.Array.prototype.subarray)),Writer.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer.prototype.int64=Writer.prototype.uint64,Writer.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer.prototype.sfixed32=Writer.prototype.fixed32,Writer.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer.prototype.sfixed64=Writer.prototype.fixed64,Writer.prototype.float=function(e){return this._push(minimal.float.writeFloatLE,4,e)},Writer.prototype.double=function(e){return this._push(minimal.float.writeDoubleLE,8,e)};var writeBytes=minimal.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};Writer.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(minimal.isString(e)){var r=Writer.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer.prototype.string=function(e){var t=utf8.length(e);return t?this.uint32(t)._push(utf8.write,t,e):this._push(writeByte,1,0)},Writer.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer._configure=function(e){BufferWriter=e};var writer_buffer=BufferWriter$1;(BufferWriter$1.prototype=Object.create(writer.prototype)).constructor=BufferWriter$1;var Buffer=minimal.Buffer;function BufferWriter$1(){writer.call(this)}BufferWriter$1.alloc=function(e){return(BufferWriter$1.alloc=minimal._Buffer_allocUnsafe)(e)};var writeBytesBuffer=Buffer&&Buffer.prototype instanceof Uint8Array&&"set"===Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]};function writeStringBuffer(e,t,r){e.length<40?minimal.utf8.write(e,t,r):t.utf8Write(e,r)}BufferWriter$1.prototype.bytes=function(e){minimal.isString(e)&&(e=minimal._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(writeBytesBuffer,t,e),this},BufferWriter$1.prototype.string=function(e){var t=Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this};var reader=Reader,BufferReader,LongBits$2=minimal.LongBits,utf8$1=minimal.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader(e);throw Error("illegal buffer")},OQ;function readLongVarint(){var e=new LongBits$2(0,0),t=0;if(!(4<this.len-this.pos)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,4<this.len-this.pos){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits$2(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader.create=minimal.Buffer?function(e){return(Reader.create=function(e){return minimal.Buffer.isBuffer(e)?new BufferReader(e):create_array(e)})(e)}:create_array,Reader.prototype._slice=minimal.Array.prototype.subarray||minimal.Array.prototype.slice,Reader.prototype.uint32=(OQ=4294967295,function(){if(OQ=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return OQ;if(OQ=(OQ|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return OQ;if(OQ=(OQ|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return OQ;if(OQ=(OQ|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return OQ;if(OQ=(OQ|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return OQ;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return OQ}),Reader.prototype.int32=function(){return 0|this.uint32()},Reader.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader.prototype.bool=function(){return 0!==this.uint32()},Reader.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader.prototype.string=function(){var e=this.bytes();return utf8$1.read(e,0,e.length)},Reader.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader._configure=function(e){BufferReader=e;var t=minimal.Long?"toLong":"toNumber";minimal.merge(Reader.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader$1;function BufferReader$1(e){reader.call(this,e)}(BufferReader$1.prototype=Object.create(reader.prototype)).constructor=BufferReader$1,minimal.Buffer&&(BufferReader$1.prototype._slice=minimal.Buffer.prototype.slice),BufferReader$1.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))};var service=Service;function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");minimal.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(minimal.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(r,t,n,o,i){if(!o)throw TypeError("request must be specified");var a=this;if(!i)return minimal.asPromise(e,a,r,t,n,o);if(a.rpcImpl)try{return a.rpcImpl(r,t[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(e,t){if(e)return a.emit("error",e,r),i(e);if(null!==t){if(!(t instanceof n))try{t=n[a.responseDelimited?"decodeDelimited":"decode"](t)}catch(e){return a.emit("error",e,r),i(e)}return a.emit("data",t,r),i(null,t)}a.end(!0)})}catch(e){return a.emit("error",e,r),void setTimeout(function(){i(e)},0)}else setTimeout(function(){i(Error("already ended"))},0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var rpc_1=createCommonjsModule(function(e,t){t.Service=service}),roots={},indexMinimal=createCommonjsModule(function(e,t){var r=t;function n(){r.Reader._configure(r.BufferReader),r.util._configure()}r.build="minimal",r.Writer=writer,r.BufferWriter=writer_buffer,r.Reader=reader,r.BufferReader=reader_buffer,r.util=minimal,r.rpc=rpc_1,r.roots=roots,r.configure=n,r.Writer._configure(r.BufferWriter),n()}),minimal$1=indexMinimal,$Reader=minimal$1.Reader,$Writer=minimal$1.Writer,$util=minimal$1.util,$root=minimal$1.roots.default||(minimal$1.roots.default={}),SR,ZS;$root.room=(SR={},SR.JoinRoomMessage=function(){function t(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return t.prototype.account="",t.prototype.userId=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=$Writer.create()),null!=e.account&&e.hasOwnProperty("account")&&t.uint32(10).string(e.account),null!=e.userId&&e.hasOwnProperty("userId")&&t.uint32(16).uint32(e.userId),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.room.JoinRoomMessage;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.account=e.string();break;case 2:n.userId=e.uint32();break;default:e.skipType(7&o)}}return n},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.account&&e.hasOwnProperty("account")&&!$util.isString(e.account)?"account: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!$util.isInteger(e.userId)?"userId: integer expected":null},t.fromObject=function(e){if(e instanceof $root.room.JoinRoomMessage)return e;var t=new $root.room.JoinRoomMessage;return null!=e.account&&(t.account=String(e.account)),null!=e.userId&&(t.userId=e.userId>>>0),t},t.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.account="",r.userId=0),null!=e.account&&e.hasOwnProperty("account")&&(r.account=e.account),null!=e.userId&&e.hasOwnProperty("userId")&&(r.userId=e.userId),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal$1.util.toJSONOptions)},t}(),SR.LeaveRoomMessage=function(){function t(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return t.prototype.account="",t.prototype.userId=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=$Writer.create()),null!=e.account&&e.hasOwnProperty("account")&&t.uint32(10).string(e.account),null!=e.userId&&e.hasOwnProperty("userId")&&t.uint32(16).uint32(e.userId),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.room.LeaveRoomMessage;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.account=e.string();break;case 2:n.userId=e.uint32();break;default:e.skipType(7&o)}}return n},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.account&&e.hasOwnProperty("account")&&!$util.isString(e.account)?"account: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!$util.isInteger(e.userId)?"userId: integer expected":null},t.fromObject=function(e){if(e instanceof $root.room.LeaveRoomMessage)return e;var t=new $root.room.LeaveRoomMessage;return null!=e.account&&(t.account=String(e.account)),null!=e.userId&&(t.userId=e.userId>>>0),t},t.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.account="",r.userId=0),null!=e.account&&e.hasOwnProperty("account")&&(r.account=e.account),null!=e.userId&&e.hasOwnProperty("userId")&&(r.userId=e.userId),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal$1.util.toJSONOptions)},t}(),SR),$root.whiteboard=(ZS={},ZS.CommandMessage=function(){function t(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return t.prototype.command="",t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=$Writer.create()),null!=e.command&&e.hasOwnProperty("command")&&t.uint32(10).string(e.command),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.whiteboard.CommandMessage;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.command=e.string();break;default:e.skipType(7&o)}}return n},t.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.command&&e.hasOwnProperty("command")&&!$util.isString(e.command)?"command: string expected":null},t.fromObject=function(e){if(e instanceof $root.whiteboard.CommandMessage)return e;var t=new $root.whiteboard.CommandMessage;return null!=e.command&&(t.command=String(e.command)),t},t.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.command=""),null!=e.command&&e.hasOwnProperty("command")&&(r.command=e.command),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,minimal$1.util.toJSONOptions)},t}(),ZS);var protocols=$root,protolist=createCommonjsModule(function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.MsgType||(t.MsgType={}))[r.room_JoinRoomMessage=1e4]="room_JoinRoomMessage",r[r.room_LeaveRoomMessage=10001]="room_LeaveRoomMessage",r[r.whiteboard_CommandMessage=10002]="whiteboard_CommandMessage";var n={1e4:protocols.room.JoinRoomMessage,10001:protocols.room.LeaveRoomMessage,10002:protocols.whiteboard.CommandMessage};t.msgMap=n});unwrapExports(protolist);var protolist_1=protolist.MsgType,protolist_2=protolist.msgMap,protoutils=createCommonjsModule(function(e,t){function i(e,t){var r=e[t]<<24;return r+=e[t+1]<<16,r+=e[t+2]<<8,r+=e[t+3]}function o(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function n(e){this._buffer=e||null}return n.create=function(e,t){var r=new n;return r.encode(e,t),r},Object.defineProperty(n.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),n.prototype.getMsgData=function(){if(!this._buffer||this._buffer.byteLength<8)return null;var e=i(this._buffer,0);if(this._buffer.byteLength<e+4)return null;var t=i(this._buffer,4),r={type:t};if(8<this._buffer.byteLength){var n=protolist.msgMap[t],o=n.decode(this._buffer.subarray(8,e+4));o&&(r.data=n.toObject(o))}return r},n.prototype.encode=function(e,t){var r=protolist.msgMap[e].encode(t).finish();this._buffer=new Uint8Array(8+r.length),o(this._buffer,0,r.length+4),o(this._buffer,4,e),this._buffer.set(r,8)},n}();t.Packet=r;var n=function(){function e(){this.BUFFER_INCR_SIZE=1024,this._buffer=new Uint8Array(this.BUFFER_INCR_SIZE),this._offset=0,this._length=0,this._messages=[]}return e.prototype.put=function(e){if(this._buffer.byteLength-this._offset-this._length>=e.byteLength)this._buffer.set(e,this._offset+this._length);else if(this._buffer.byteLength-this._length>=e.byteLength)this._buffer.copyWithin(0,this._offset,this._offset+this._length),this._offset=0,this._buffer.set(e,this._length);else{for(var t=this._buffer.byteLength;t-this._length<e.byteLength;)t+=this.BUFFER_INCR_SIZE;var r=new Uint8Array(t);r.set(this._buffer.subarray(this._offset,this._offset+this._length),0),r.set(e,this._length),this._buffer=r,this._offset=0}for(this._length+=e.byteLength;;){var n=this._get();if(!n)break;this._messages.push(n)}},e.prototype.getMessage=function(){return this._messages.shift()||null},e.prototype._get=function(){if(this._length<4)return null;var e=i(this._buffer,this._offset);if(!e)return null;if(e+=4,this._length<e)return null;var t=this._buffer.subarray(this._offset,this._offset+e);return this._offset+=e,this._length-=e,new r(t).getMsgData()},e}();t.MessageAssembler=n});unwrapExports(protoutils);var protoutils_1=protoutils.Packet,protoutils_2=protoutils.MessageAssembler,cmdserver=createCommonjsModule(function(e,t){var n,o=commonjsGlobal&&commonjsGlobal.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function e(e){var t=r.call(this)||this;return t._started=!1,t._wb=e,t}return o(e,r),Object.defineProperty(e.prototype,"whiteboard",{get:function(){return this._wb},enumerable:!0,configurable:!0}),e.prototype.start=function(){!this._started&&this._start()&&(this._started=!0)},e.prototype.stop=function(){this._started&&this._stop()&&(this._started=!1)},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e.prototype.sendBoardMessage=function(e){},e.prototype.executeCommand=function(e){this._executeCommand(e)},e}(catk.EventObserver),i=function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype._executeCommand=function(e){this._wb.executeCommand(e)},e.prototype._start=function(){return!0},e.prototype._stop=function(){return!0},e}(t.CommandServer=r);t.LocalCommandServer=i;var a=function(n){function e(e,t){var r=n.call(this,e)||this;return r._uri=t,r._socket=null,r._assembler=new protoutils.MessageAssembler,r}return o(e,n),e.prototype._executeCommand=function(e){if(this._wb.executeCommand(e),this._socket&&this._socket.connected){var t=protoutils.Packet.create(protolist.MsgType.whiteboard_CommandMessage,{command:JSON.stringify(e)});this._socket.binary(!0).emit("message",t.buffer)}},e.prototype._start=function(){var o=this;return this._socket=socket(this._uri,{transports:["websocket"],reconnection:!1}),this._socket.on("connect",function(){o.onConnect()}),this._socket.on("message",function(e){var t=new Uint8Array(e);for(o._assembler.put(t);;){var r=o._assembler.getMessage();if(!r)break;if(r.type===protolist.MsgType.whiteboard_CommandMessage){var n=JSON.parse(r.data.command);o._wb.executeCommand(n)}else catk.App.triggerEvent(null,new whiteboard.EvtSocketMessage(r.type,r.data))}}),this._socket.on("disconnect",function(){o.onDisconnect()}),!0},e.prototype._stop=function(){return this._socket&&this._socket.close(),!0},e.prototype.onConnect=function(){console.log("connected")},e.prototype.onEvent=function(e){console.log("event")},e.prototype.onDisconnect=function(){console.log("disconnect")},e}(r);t.SocketCommandServer=a});unwrapExports(cmdserver);var cmdserver_1=cmdserver.CommandServer,cmdserver_2=cmdserver.LocalCommandServer,cmdserver_3=cmdserver.SocketCommandServer,create_whiteboard=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.init=function(){var e=new whiteboard$2.WhiteBoard(document.querySelector("#playground-canvas"),!0),t=new cmdserver.LocalCommandServer(e);whiteboard$2.installTools(e),whiteboard$2.installFactories(e);var r=document.querySelector("#tool-toolbox"),n=document.querySelector("#op-toolbox"),o=document.querySelector("#object-propgrid"),i=document.querySelector("#tool-propgrid"),a=new whiteboard$2.WBEditor(t,whiteboard$2.WBDefaultToolSet,r,n,o,i);e.on(whiteboard$2.WBObjectSelectedEvent.type,function(e){1===e.objects.length?a.objectPropertyGrid.loadObjectProperties(e.objects[0]):a.objectPropertyGrid.loadPageProperties()}),e.on(whiteboard$2.WBObjectDeselectedEvent.type,function(e){1===e.objects.length?a.objectPropertyGrid.loadObjectProperties(e.objects[0]):a.objectPropertyGrid.loadPageProperties()}),e.on(whiteboard$2.WBObjectMovedEvent.type,function(e){a.objectPropertyGrid.reloadObjectProperties()}),e.on(whiteboard$2.WBToolActivateEvent.type,function(e){a.toolPropertyGrid.loadToolProperties(e.tool),e.tool.name===whiteboard$2.WBSelectTool.toolname&&a.objectPropertyGrid.loadPageProperties()}),e.on(whiteboard$2.WBToolDeactivateEvent.type,function(e){a.toolPropertyGrid.clear(),e.tool.name===whiteboard$2.WBSelectTool.toolname&&a.objectPropertyGrid.loadPageProperties()}),catk.App.run()}}),create_whiteboard$1=unwrapExports(create_whiteboard),create_whiteboard_1=create_whiteboard.init;exports.default=create_whiteboard$1,exports.init=create_whiteboard_1,Object.defineProperty(exports,"__esModule",{value:!0})});
