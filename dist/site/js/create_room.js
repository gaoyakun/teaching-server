!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("socket.io-client")):"function"==typeof define&&define.amd?define(["exports","socket.io-client"],t):t(e.create_room={},e.io)}(this,function(e,l){"use strict";l=l&&l.hasOwnProperty("default")?l.default:l;var Q="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var c=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function i(){}return i.parse=function(e){var t={command:""},n={str:i.trimLeft(e),token:""};for(i.lexical(n),t.command=n.token;i.lexical(n),""!==n.token;){var o=n.token.split("=");if(1===o.length)t[o[0]]=!0;else{var r=o[1];1<r.length&&"["===r.charAt(0)&&"]"===r.charAt(r.length-1)&&(r=r.substr(1,r.length-2).split(",")),t[o[0]]=r}}return t},i.trimLeft=function(e){for(var t=0;t<e.length&&0<=" \n\r\t\f\v            ​\u2028\u2029　".indexOf(e.charAt(t));)t++;return e.substring(t,e.length-t)},i.trimRight=function(e){for(var t=e.length-1;0<=t&&0<=" \n\r\t\f\v            ​\u2028\u2029　".indexOf(e.charAt(t));)t--;return e.substring(0,t+1)},i.trim=function(e){return this.trimRight(this.trimLeft(e))},i.lexical=function(e){for(var t=" \n\r\t\f\v            ​\u2028\u2029　",n=0;n<e.str.length&&0<=t.indexOf(e.str.charAt(n));)n++;for(e.str=e.str.substr(n,e.str.length-n),n=0;n<e.str.length&&t.indexOf(e.str.charAt(n))<0;)n++;e.token=e.str.substr(0,n),e.str=e.str.substr(n,e.str.length-n)},i}();t.WBCommandParser=n});t(c);c.WBCommandParser;var o=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function s(e,t,n){this._container=e,this._wb=t,this._tools=[],this._curTool=null,this._direction=n,this._strokeColor="#000000",this._fillColor="#ffffff",this.create(this._container)}return s.prototype.create=function(e){(this._container=e).style.display="flex",e.style.flexDirection=this._direction,e.style.flexWrap="wrap",e.style.justifyContent="flex-start",e.style.alignItems="flex-start",e.style.alignContent="flex-start"},s.prototype.loadTools=function(e){var a=this;e.forEach(function(e){a._tools.push(e);var t=parseInt(e.fontSize||"60",10)+10;if("$StrokeColor"===e.activeCommand){var n=document.createElement("input");n.type="color",n.value=a._strokeColor,n.style.width=t+"px",n.style.height=t+"px",n.style.margin="2px",n.onchange=function(){a._strokeColor=n.value},a._container.appendChild(n)}else if("$FillColor"===e.activeCommand){var o=document.createElement("input");o.type="color",o.value=a._fillColor,o.style.width=t+"px",o.style.height=t+"px",o.style.margin="2px",o.onchange=function(){a._fillColor=o.value},a._container.appendChild(o)}else{var r=document.createElement("div");r.classList.add("flex-h","flex-align-x-center","flex-align-y-center"),e.elementId="toolbutton-"+s.uniqueId++,r.classList.add("toolbutton"),r.id=e.elementId,r.style.width=t+"px",r.style.height=t+"px",r.setAttribute("toolIndex",String(a._tools.length-1));var i=document.createElement("i");i.style.fontSize=e.fontSize||"60px",i.style.color="#fff",i.style.lineHeight=e.fontSize||"60px",e.iconClass&&e.iconClass.split(" ").forEach(function(e){i.classList.add(e)}),r.appendChild(i),a._container.appendChild(r),r.addEventListener("click",function(){var e=Number(r.getAttribute("toolIndex")),t=a._tools[e];if(t!==a._curTool&&a._curTool){var n=document.querySelector("#"+a._curTool.elementId);n&&n.classList.remove("active"),a._curTool.deactiveCommand&&a._wb.executeCommand(c.WBCommandParser.parse(a._curTool.deactiveCommand)),a._curTool=null}if(t){var o=document.querySelector("#"+t.elementId);o&&o.classList.add("active"),a._wb.executeCommand(c.WBCommandParser.parse(t.activeCommand)),a._curTool=t}})}})},s.prototype.unloadTools=function(){for(;this._container.hasChildNodes();)this._container.removeChild(this._container.firstChild);this._tools=[]},s.uniqueId=1,s}();t.WBEditorToolbox=n});t(o);o.WBEditorToolbox;var v=n(function(e,t){function n(e){return e.x*e.x+e.y*e.y}function o(e){return Math.sqrt(n(e))}function r(e,t){return{x:t.x-e.x,y:t.y-e.y}}Object.defineProperty(t,"__esModule",{value:!0}),t.GetTopLeft=function(e){return{x:e.x,y:e.y}},t.GetTopRight=function(e){return{x:e.x+e.w,y:e.y}},t.GetBottomLeft=function(e){return{x:e.x,y:e.y+e.h}},t.GetBottomRight=function(e){return{x:e.x+e.w,y:e.y+e.h}},t.Normalize=function(e){var t=o(e);1e-4<t&&(e.x/=t,e.y/=t)},t.VectorLengthSq=n,t.VectorLength=o,t.DistanceSq=function(e,t){return n(r(e,t))},t.Distance=function(e,t){return o(r(e,t))},t.DotProduct=function(e,t){return e.x*t.x+e.y*t.y},t.CrossProduct=function(e,t){return e.x*t.y-e.y*t.x},t.GetVector=r,t.ClampPoint=function(e,t,n){return{x:Math.max(t.x,Math.min(n.x,e.x)),y:Math.max(t.y,Math.min(n.y,e.y))}}});t(v);v.GetTopLeft,v.GetTopRight,v.GetBottomLeft,v.GetBottomRight,v.Normalize,v.VectorLengthSq,v.VectorLength,v.DistanceSq,v.Distance,v.DotProduct,v.CrossProduct,v.GetVector,v.ClampPoint;var i=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.type=e};t.BoundingShape=n});t(i);i.BoundingShape;var m=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function o(e){var t=n.call(this,o.type)||this;return t._points=e||[],t._boundingbox=null,t._dirtyFlag=0<t._points.length,t}return r(o,n),o.prototype.addPoint=function(e){this._points.push(e),this._dirtyFlag=!0},Object.defineProperty(o.prototype,"length",{get:function(){return this._points.length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"boundingbox",{get:function(){return this._checkDirty(),this._boundingbox},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"points",{get:function(){return this._checkDirty(),this._points},enumerable:!0,configurable:!0}),o.prototype.getPoint=function(e){return this._checkDirty(),this._points[e]},o.prototype.removePoint=function(e){this._points.splice(e,1),0===this._points.length?(this._boundingbox=null,this._dirtyFlag=!1):this._dirtyFlag=!0},o.prototype.clear=function(){this._points.length=0,this._boundingbox=null,this._dirtyFlag=!1},o.prototype.getBoundingbox=function(){return this.boundingbox},o.prototype.getTransformedShape=function(t){return new o(t?this._points.map(function(e){return t.transformPoint(e)}):this._points)},o.prototype._checkDirty=function(){this._dirtyFlag&&(this._dirtyFlag=!1,this._adjustPoints(),this._computeBoundingbox())},o.prototype._adjustPoints=function(){var e=this._points.length;if(!(e<3)){for(var t=[this._points[0],this._points[1]],n=2;n<e;n++){for(var o=t.length-1;0<o;){var r=v.GetVector(t[0],t[o]),i=v.GetVector(t[0],this._points[n]),a=v.CrossProduct(r,i);if(a<0){t.splice(o+1,0,this._points[n]);break}if(0===a&&v.VectorLengthSq(i)>v.VectorLengthSq(r)){t.splice(o+1,0,this._points[n]);break}o--}0===o&&t.splice(1,0,this._points[n])}this._points=t}},o.prototype._computeBoundingbox=function(){if(0<this._points.length){var o=this._points[0].x,r=this._points[0].y,i=o,a=r;this._points.forEach(function(e){var t=e.x,n=e.y;t<o?o=t:i<t&&(i=t),n<r?r=n:a<n&&(a=n)}),this._boundingbox={x:o,y:r,w:i-o+1,h:a-r+1}}else this._boundingbox=null},o.type="Hull",o}(i.BoundingShape);t.BoundingHull=n});t(m);m.BoundingHull;var g=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function i(e){var t=n.call(this,i.type)||this;return t.rect=e||null,t}return r(i,n),i.prototype.getBoundingbox=function(){return this.rect},i.prototype.getTransformedShape=function(e){if(null===this.rect)return null;if(e){var t={x:this.rect.x,y:this.rect.y},n={x:this.rect.x,y:this.rect.y+this.rect.h-1},o={x:this.rect.x+this.rect.w-1,y:this.rect.y+this.rect.h-1},r={x:this.rect.x+this.rect.w-1,y:this.rect.y};return new m.BoundingHull([e.transformPoint(t),e.transformPoint(n),e.transformPoint(o),e.transformPoint(r)])}return new i(this.rect)},i.type="Box",i}(i.BoundingShape);t.BoundingBox=n});t(g);g.BoundingBox;var _=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function o(e){var t=n.call(this,o.type)||this;return t._segment=e||null,t._dirty=!!e,t._boundingbox=null,t}return r(o,n),Object.defineProperty(o.prototype,"start",{get:function(){return this._segment?this._segment.start:null},set:function(e){e&&(this._segment?this._segment.start=e:this._segment={start:e,end:e},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"end",{get:function(){return this._segment?this._segment.end:null},set:function(e){e&&(this._segment?this._segment.end=e:this._segment={start:e,end:e},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"segment",{get:function(){return this._segment?{start:this.start,end:this.end}:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"boundingbox",{get:function(){return this._checkDirty(),this._boundingbox},enumerable:!0,configurable:!0}),o.prototype.getBoundingbox=function(){return this.boundingbox},o.prototype.getTransformedShape=function(e){return e&&this._segment?new o({start:e.transformPoint(this._segment.start),end:e.transformPoint(this._segment.end)}):this._segment?new o(this._segment):null},o.prototype._checkDirty=function(){if(this._segment&&this._dirty){this._dirty=!1;var e=this._segment.start.x,t=this._segment.start.y,n=this._segment.end.x,o=this._segment.end.y;if(n<e){var r=e;e=n,n=r}if(o<t){r=t;t=o,o=r}this._boundingbox={x:e,y:t,w:n-e+1,h:o-t+1}}},o.type="Segment",o}(i.BoundingShape);t.BoundingSegment=n});t(_);_.BoundingSegment;var b=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function s(e){var t=n.call(this,s.type)||this;return t._sphere=e||null,t._dirty=!!t._sphere,t._boundingbox=null,t}return r(s,n),Object.defineProperty(s.prototype,"center",{get:function(){return this._sphere?this._sphere.center:null},set:function(e){e&&(this._sphere?this._sphere.center=e:this._sphere={center:e,radius:1},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"radius",{get:function(){return this._sphere?this._sphere.radius:null},set:function(e){null!==e&&(this._sphere?this._sphere.radius=e:this._sphere={center:{x:0,y:0},radius:e},this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sphere",{get:function(){return this._sphere?{center:this._sphere.center,radius:this._sphere.radius}:null},set:function(e){this._sphere=e,this._dirty=!!e,this._boundingbox=null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"boundingbox",{get:function(){return this._checkDirty(),this._boundingbox},enumerable:!0,configurable:!0}),s.prototype.getBoundingbox=function(){return this.boundingbox},s.prototype.getTransformedShape=function(e){if(e&&this._sphere){for(var t=.125*Math.PI,n=2*t,o=this._sphere.radius/Math.cos(t),r=new m.BoundingHull,i=t;i<2*Math.PI;i+=n){var a=e.transformPoint({x:o*Math.cos(i),y:o*Math.sin(i)});a.x=Math.round(a.x),a.y=Math.round(a.y),r.addPoint(a)}return r}return this._sphere?new s(this._sphere):null},s.prototype._checkDirty=function(){this._sphere&&this._dirty&&(this._dirty=!1,this._boundingbox={x:this._sphere.center.x-this._sphere.radius+1,y:this._sphere.center.y-this._sphere.radius+1,w:2*this._sphere.radius-1,h:2*this._sphere.radius-1})},s.type="sphere",s}(i.BoundingShape);t.BoundingSphere=n});t(b);b.BoundingSphere;var $=n(function(e,t){function n(e,t){return!!e&&!!t&&e.x<=t.x+t.w&&e.x+e.w>=t.x&&e.y<=t.y+t.h&&e.y+e.h>=t.y}function o(e,t){return!!e&&!!t&&t.x>=e.x&&t.x<=e.x+e.w&&t.y>=e.y&&t.y<=e.y+e.h}function r(e,t){return!!e&&!!t&&h([v.GetTopLeft(e),v.GetBottomLeft(e),v.GetBottomRight(e),v.GetTopRight(e)],t)}function i(e,t){return e&&t?p([v.GetTopLeft(e),v.GetBottomLeft(e),v.GetBottomRight(e),v.GetTopRight(e)],t):null}function a(e,t){if(!e||!t)return!1;var n=v.ClampPoint(t.center,{x:e.x,y:e.y},{x:e.x+e.w-1,y:e.y+e.h-1}),o=v.GetVector(n,t.center);return v.DotProduct(o,o)<t.radius*t.radius}function s(e,t){if(!e||!t)return!1;for(var n=e.radius*e.radius,o=0;o<t.length;o++){var r=e.center.x-t[o].x,i=e.center.y-t[o].y;if(r*r+i*i<n)return!0}for(o=0;o<t.length;o++){var a=u(e,{start:t[o],end:t[(o+1)%t.length]});if(null!==a&&0<a.length)return!0}return c(t,e.center)}function c(e,t){for(var n=0;n<e.length;n++){var o=v.GetVector(t,e[n]),r=v.GetVector(t,e[(n+1)%e.length]);if(0<v.CrossProduct(o,r))return!1}return!0}function l(e,t){if(!e||!t)return!1;var n=e.center.x-t.center.x,o=e.center.y-t.center.y,r=e.radius+t.radius;return n*n+o*o<r*r}function u(e,t){if(!e||!t)return null;var n=v.GetVector(t.start,t.end),o=v.GetVector(e.center,t.start),r=v.DotProduct(n,n),i=2*v.DotProduct(o,n),a=i*i-4*r*(v.DotProduct(o,o)-e.radius*e.radius);if(a<0)return null;var s=(-i-(a=Math.sqrt(a)))/(2*r),c=(-i+a)/(2*r);if(c<s){var l=s;s=c,c=l}var u=[];return 0<=s&&s<=1&&u.push({x:t.start.x+s*n.x,y:t.start.y+s*n.y}),0<=c&&c<=1&&u.push({x:t.start.x+c*n.x,y:t.start.y+c*n.y}),u}function p(e,n){if(!e||!n)return null;if(c(e,n.start)&&c(e,n.end))return[];for(var t=[],o=0;o<e.length;o++){var r=y({start:e[o],end:e[(o+1)%e.length]},n);r&&t.push(r)}return 1<t.length&&t.sort(function(e,t){return v.DistanceSq(e,n.start)-v.DistanceSq(t,n.start)}),0<t.length?t:null}function h(e,t){for(var l=[e,t],n=0;n<2;n++)for(var u=l[n],o=function(e){var t=u[(e+1)%u.length].x-u[e].x,n=u[(e+1)%u.length].y-u[e].y,o=Math.sqrt(t*t+n*n);if(o<1)return"continue";for(var r=-n/o,i=t/o,a=[{min:9999999,max:-9999999},{min:9999999,max:-9999999}],s=function(n){l[n].forEach(function(e){var t=e.x*r+e.y*i;t<a[n].min&&(a[n].min=t),t>a[n].max&&(a[n].max=t)})},c=0;c<2;c++)s(c);return a[0].min>a[1].max||a[0].max<a[1].min?{value:!1}:void 0},r=0;r<u.length;r++){var i=o(r);if("object"==typeof i)return i.value}return!0}function d(e,t){if(!e||!t)return!1;var n=e.center.x-t.x,o=e.center.y-t.y;return n*n+o*o<e.radius*e.radius}function f(e,t){if(!e||!t)return!1;var n=e.start.x,o=e.start.y,r=e.end.x,i=e.end.y;if(r<n){var a=n;n=r,r=a}if(i<o){a=o;o=i,i=a}if(t.x<n||t.x>r||t.y<o||t.y>i)return!1;if(r!==n){var s=Math.round(o+(i-o)*(t.x-n)/(r-n))-t.y;return-1<=s&&s<=1}if(i===o)return t.x===n&&t.y===o;var c=Math.round(n+(r-n)*(t.y-o)/(i-o))-t.x;return-1<=c&&c<=1}function y(e,t){function n(e,t){return 0<=e&&0<=t||e<=0&&t<=0}if(!e||!t)return null;var o,r,i,a,s,c=e.start.x,l=e.start.y,u=e.end.x,p=e.end.y,h=t.start.x,d=t.start.y,f=t.end.x,y=t.end.y,v=u-c,m=h-f;if(v<0?(o=u,r=c):(r=u,o=c),0<m){if(r<f||h<o)return null}else if(r<h||f<o)return null;var g=p-l,_=d-y;if(g<0?(i=p,a=l):(a=p,i=l),0<_){if(a<y||d<i)return null}else if(a<d||y<i)return null;var b=c-h,w=l-d,x=g*m-v*_;if(0===x)return null;var P=_*b-m*w;if(0<x){if(P<0||x<P)return null}else if(0<P||P<x)return null;var j=v*w-g*b;if(0<x){if(j<0||x<j)return null}else if(0<j||j<x)return null;return{x:c+(((s=P*v)+(n(s,x)?x/2:-x/2))/x>>0),y:l+(((s=P*g)+(n(s,x)?x/2:-x/2))/x>>0)}}Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectionTestShapeSegment=function(e,t){if(!e||!t)return null;if(e.getBoundingbox())switch(e.type){case g.BoundingBox.type:return i(e.rect,t);case m.BoundingHull.type:return p(e.points,t);case _.BoundingSegment.type:var n=y(e.segment,t);return n?[n]:[];case b.BoundingSphere.type:return u(e.sphere,t)}return null},t.IntersectionTestShapeBox=function(e,t){if(!e.getBoundingbox())return!1;switch(e.type){case g.BoundingBox.type:return n(e.rect,t);case m.BoundingHull.type:return r(t,e.points);case _.BoundingSegment.type:return null!=i(t,e.segment);case b.BoundingSphere.type:return a(t,e.sphere);default:return!1}},t.IntersectionTestShapeHull=function(e,t){if(!e.getBoundingbox())return!1;switch(e.type){case g.BoundingBox.type:return r(e.rect,t);case m.BoundingHull.type:return h(e.points,t);case _.BoundingSegment.type:return null!=p(t,e.segment);case b.BoundingSphere.type:return s(e.sphere,t);default:return!1}},t.IntersectionTestShapePoint=function(e,t){if(!o(e.getBoundingbox(),t))return!1;switch(e.type){case g.BoundingBox.type:return!0;case m.BoundingHull.type:return c(e.points,t);case _.BoundingSegment.type:return f(e.segment,t);case b.BoundingSphere.type:return d(e.sphere,t);default:return!1}},t.IntersectionTestShapeShape=function(e,t){if(!n(e.getBoundingbox(),t.getBoundingbox()))return!1;switch(e.type){case g.BoundingBox.type:switch(t.type){case g.BoundingBox.type:return!0;case m.BoundingHull.type:return r(e.rect,t.points);case _.BoundingSegment.type:return null!=i(e.rect,t.segment);case b.BoundingSphere.type:return a(e.rect,t.sphere);default:return!1}case m.BoundingHull.type:switch(t.type){case g.BoundingBox.type:return r(t.rect,e.points);case m.BoundingHull.type:return h(e.points,t.points);case _.BoundingSegment.type:return null!=p(e.points,t.segment);case b.BoundingSphere.type:return s(t.sphere,e.points);default:return!1}case _.BoundingSegment.type:switch(t.type){case g.BoundingBox.type:return null!=i(t.rect,e.segment);case m.BoundingHull.type:return null!=p(t.points,e.segment);case _.BoundingSegment.type:return null!=y(t.segment,e.segment);case b.BoundingSphere.type:return null!=u(t.sphere,e.segment);default:return!1}case b.BoundingSphere.type:switch(t.type){case g.BoundingBox.type:return a(t.rect,e.sphere);case m.BoundingHull.type:return s(e.sphere,t.points);case _.BoundingSegment.type:return null!=u(e.sphere,t.segment);case b.BoundingSphere.type:return l(e.sphere,t.sphere);default:return!1}default:return!1}},t.IntersectionTestBoxBox=n,t.IntersectionTestBoxPoint=o,t.IntersectionTestBoxHull=r,t.IntersectionTestBoxSegment=i,t.IntersectionTestBoxSphere=a,t.IntersectionTestSphereHull=s,t.IntersectionTestHullPoint=c,t.IntersectionTestSphereSphere=l,t.IntersectionTestSphereSegment=u,t.IntersectionTestHullSegment=p,t.IntersectionTestHullHull=h,t.IntersectionTestSpherePoint=d,t.IntersectionTestSegmentPoint=f,t.IntersectionTestSegmentSegment=y});t($);$.IntersectionTestShapeSegment,$.IntersectionTestShapeBox,$.IntersectionTestShapeHull,$.IntersectionTestShapePoint,$.IntersectionTestShapeShape,$.IntersectionTestBoxBox,$.IntersectionTestBoxPoint,$.IntersectionTestBoxHull,$.IntersectionTestBoxSegment,$.IntersectionTestBoxSphere,$.IntersectionTestSphereHull,$.IntersectionTestHullPoint,$.IntersectionTestSphereSphere,$.IntersectionTestSphereSegment,$.IntersectionTestHullSegment,$.IntersectionTestHullHull,$.IntersectionTestSpherePoint,$.IntersectionTestSegmentPoint,$.IntersectionTestSegmentSegment;var u=n(function(e,t){var o,c,n,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),(n=c=t.SplineType||(t.SplineType={}))[n.STEP=1]="STEP",n[n.LINEAR=2]="LINEAR",n[n.POLY=3]="POLY";var i=function(){function e(e,t){void 0===t&&(t=!1),this.cp=e,this.clamp=t}return e.prototype.eval=function(e){return 0},e.prototype.evalFirst=function(){return 0<this.cp.length?this.cp[0].y:0},e.prototype.evalLast=function(){return 0<this.cp.length?this.cp[this.cp.length-1].y:0},e}(),l=function(o){function e(e,t){void 0===t&&(t=!1);var n=o.call(this,e,t)||this;return n.h=new Array(e.length-1),n.compute(),n}return r(e,o),e.prototype.compute=function(){for(var e=0;e<this.cp.length-1;++e)this.h[e]=this.cp[e+1].x-this.cp[e].x},e.prototype.getSegment=function(e){var t;for(t=0;t<this.cp.length-1&&!(e<this.cp[t+1].x);t++);return t},e.prototype.eval=function(e){if(this.clamp){if(e<0)return this.cp[0].y;if(e>this.cp[this.cp.length-1].x)return this.cp[this.cp.length-1].y}var t=this.getSegment(e);return this.cp[t].y},e}(t.CurveEvaluter=i);t.StepEvaluter=l;var u=function(o){function e(e,t){void 0===t&&(t=!1);var n=o.call(this,e,t)||this;return n.h=new Array(e.length-1),n.cp=e,n.compute(),n}return r(e,o),e.prototype.compute=function(){for(var e=0;e<this.cp.length-1;++e)this.h[e]=this.cp[e+1].x-this.cp[e].x},e.prototype.getSegment=function(e){var t;for(t=0;t<this.cp.length-1&&!(e<this.cp[t+1].x);t++);return t===this.cp.length-1&&t--,t},e.prototype.eval=function(e){if(this.clamp){if(e<0)return this.cp[0].y;if(e>this.cp[this.cp.length-1].x)return this.cp[this.cp.length-1].y}var t=this.getSegment(e),n=e-this.cp[t].x;return this.cp[t].y+(this.cp[t+1].y-this.cp[t].y)*n/this.h[t]},e}(i);t.CoLinearEvaluter=u;var p=function(o){function e(e,t){void 0===t&&(t=!1);var n=o.call(this,e,t)||this;return n.a=new Array(e.length),n.h=new Array(e.length),n.cp=e,n.compute(),n}return r(e,o),e.prototype.solveTridiag=function(e,t,n){for(var o=this.cp.length-2,r=2;r<=o;r++)e[r]/=t[r-1],t[r]-=e[r]*n[r-1],this.a[r]-=this.a[r-1]*e[r];this.a[o]/=t[o];for(r=o-1;1<=r;--r)this.a[r]=(this.a[r]-this.a[r+1]*n[r])/t[r]},e.prototype.compute=function(){var e=this.cp.length,t=new Array(e-1),n=new Array(e-1),o=new Array(e-1);this.a[0]=0,this.a[e-1]=0;for(var r=1;r<e;++r)this.h[r]=this.cp[r].x-this.cp[r-1].x;for(r=1;r<e-1;++r)n[r]=(this.h[r]+this.h[r+1])/3,o[r]=this.h[r+1]/6,t[r]=this.h[r]/6,this.a[r]=(this.cp[r+1].y-this.cp[r].y)/this.h[r+1]-(this.cp[r].y-this.cp[r-1].y)/this.h[r];this.solveTridiag(t,n,o)},e.prototype.getSegment=function(e){var t;for(t=0;t<this.cp.length-1&&!(e<this.cp[t+1].x);t++);return t===this.cp.length-1&&t--,t},e.prototype.eval=function(e){if(this.clamp){if(e<0)return this.cp[0].y;if(e>this.cp[this.cp.length-1].x)return this.cp[this.cp.length-1].y}var t=this.getSegment(e)+1,n=e-this.cp[t-1].x,o=this.h[t]-n;return((-this.a[t-1]/6*(o+this.h[t])*n+this.cp[t-1].y)*o+(-this.a[t]/6*(n+this.h[t])*o+this.cp[t].y)*n)/this.h[t]},e}(i);t.PolynomialsEvaluter=p;var a=function(){function e(e,t,n){void 0===n&&(n=!1),this._evalutors=[],this._array=!1,0<t.length&&("number"==typeof t[0].y?this.initNonArray(e,t,n):this.initArray(e,t,n))}return e.prototype.eval=function(t){if(0<this._evalutors.length){if(this._array){var n=[];return this._evalutors.forEach(function(e){n.push(e.eval(t))}),n}return this._evalutors[0].eval(t)}return 0},e.prototype.evalFirst=function(){if(0<this._evalutors.length){if(this._array){var t=[];return this._evalutors.forEach(function(e){t.push(e.evalFirst())}),t}return this._evalutors[0].evalFirst()}return 0},e.prototype.evalLast=function(){if(0<this._evalutors.length){if(this._array){var t=[];return this._evalutors.forEach(function(e){t.push(e.evalLast())}),t}return this._evalutors[0].evalLast()}return 0},e.prototype.initArray=function(e,t,n){var o=t[0].y.length;if(0<o){for(var r=0;r<o;r++){for(var i=[],a=0;a<t.length;a++){var s=t[a].y.length>r?t[a].y[r]:0;i.push({x:t[a].x,y:s})}switch(e){case c.STEP:this._evalutors.push(new l(i,n));break;case c.LINEAR:this._evalutors.push(new u(i,n));break;case c.POLY:default:this._evalutors.push(new p(i,n))}}this._array=!0}},e.prototype.initNonArray=function(e,t,n){switch(e){case c.STEP:this._evalutors.push(new l(t,n));break;case c.LINEAR:this._evalutors.push(new u(t,n));break;case c.POLY:default:this._evalutors.push(new p(t,n))}this._array=!1},e}();t.Spline=a});t(u);u.SplineType,u.CurveEvaluter,u.StepEvaluter,u.CoLinearEvaluter,u.PolynomialsEvaluter,u.Spline;var r=n(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.KeyCode||(t.KeyCode={}))[n.kBackspace=8]="kBackspace",n[n.kTab=9]="kTab",n[n.kClear=12]="kClear",n[n.kEnter=13]="kEnter",n[n.kShift=16]="kShift",n[n.kControl=17]="kControl",n[n.kAlt=18]="kAlt",n[n.kPause=19]="kPause",n[n.kCapsLock=20]="kCapsLock",n[n.kEscape=27]="kEscape",n[n.kSpace=32]="kSpace",n[n.kPageUp=33]="kPageUp",n[n.kPageDown=34]="kPageDown",n[n.kEnd=35]="kEnd",n[n.kHome=36]="kHome",n[n.kLeft=37]="kLeft",n[n.kUp=38]="kUp",n[n.kRight=39]="kRight",n[n.kDown=40]="kDown",n[n.kSelect=41]="kSelect",n[n.kPrint=42]="kPrint",n[n.kExecute=43]="kExecute",n[n.kInsert=45]="kInsert",n[n.kDelete=46]="kDelete",n[n.kHelp=47]="kHelp",n[n.k0=48]="k0",n[n.k1=49]="k1",n[n.k2=50]="k2",n[n.k3=51]="k3",n[n.k4=52]="k4",n[n.k5=53]="k5",n[n.k6=54]="k6",n[n.k7=55]="k7",n[n.k8=56]="k8",n[n.k9=57]="k9",n[n.kA=65]="kA",n[n.kB=66]="kB",n[n.kC=67]="kC",n[n.kD=68]="kD",n[n.kE=69]="kE",n[n.kF=70]="kF",n[n.kG=71]="kG",n[n.kH=72]="kH",n[n.kI=73]="kI",n[n.kJ=74]="kJ",n[n.kK=75]="kK",n[n.kL=76]="kL",n[n.kM=77]="kM",n[n.kN=78]="kN",n[n.kO=79]="kO",n[n.kP=80]="kP",n[n.kQ=81]="kQ",n[n.kR=82]="kR",n[n.kS=83]="kS",n[n.kT=84]="kT",n[n.kU=85]="kU",n[n.kV=86]="kV",n[n.kW=87]="kW",n[n.kX=88]="kX",n[n.kY=89]="kY",n[n.kZ=90]="kZ",n[n.kLeftMeta=91]="kLeftMeta",n[n.kRightMeta=92]="kRightMeta",n[n.kMenu=93]="kMenu",n[n.kKP0=96]="kKP0",n[n.kKP1=97]="kKP1",n[n.kKP2=98]="kKP2",n[n.kKP3=99]="kKP3",n[n.kKP4=100]="kKP4",n[n.kKP5=101]="kKP5",n[n.kKP6=102]="kKP6",n[n.kKP7=103]="kKP7",n[n.kKP8=104]="kKP8",n[n.kKP9=105]="kKP9",n[n.kKPMul=106]="kKPMul",n[n.kKPAdd=107]="kKPAdd",n[n.kKPSep=108]="kKPSep",n[n.kKPSub=109]="kKPSub",n[n.kKPDec=110]="kKPDec",n[n.kKPDiv=111]="kKPDiv",n[n.kF1=112]="kF1",n[n.kF2=113]="kF2",n[n.kF3=114]="kF3",n[n.kF4=115]="kF4",n[n.kF5=116]="kF5",n[n.kF6=117]="kF6",n[n.kF7=118]="kF7",n[n.kF8=119]="kF8",n[n.kF9=120]="kF9",n[n.kF10=121]="kF10",n[n.kF11=122]="kF11",n[n.kF12=123]="kF12",n[n.kNumLock=144]="kNumLock",n[n.kScrollLock=145]="kScrollLock",n[n.kAdd=187]="kAdd",n[n.kComma=188]="kComma",n[n.kMinus=189]="kMinus",n[n.kPeriod=190]="kPeriod",n[n.kApostrophe=192]="kApostrophe",n[n.kLeftBrace=219]="kLeftBrace",n[n.kRightBrace=221]="kRightBrace",n[n.kBackSlash=220]="kBackSlash",n[n.kQuot=222]="kQuot",n[n.kSemicolon=186]="kSemicolon",n[n.kSlash=191]="kSlash"});t(r);r.KeyCode;var Z=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function o(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}return o.getIdentity=function(){return new o},o.getTranslate=function(e,t){return(new o).makeTranslate(e,t)},o.getScale=function(e,t){return(new o).makeScale(e,t)},o.getRotate=function(e){return(new o).makeRotate(e)},o.transform=function(e,t){return(new o).copyFrom(e).transform(t)},o.translate=function(e,t,n){return(new o).copyFrom(e).translate(t,n)},o.scale=function(e,t,n){return(new o).copyFrom(e).scale(t,n)},o.rotate=function(e,t){return(new o).copyFrom(e).rotate(t)},o.invert=function(e){return(new o).copyFrom(e).invert()},o.prototype.set=function(e,t,n,o,r,i){return this.a=e,this.b=t,this.c=n,this.d=o,this.e=r,this.f=i,this},o.prototype.makeIdentity=function(){return this.set(1,0,0,1,0,0)},o.prototype.makeTranslate=function(e,t){return this.set(1,0,0,1,e,t)},o.prototype.makeScale=function(e,t){return this.set(e,0,0,t,0,0)},o.prototype.makeRotate=function(e){var t=Math.sin(e),n=Math.cos(e);return this.set(n,t,-t,n,0,0)},o.prototype.copyFrom=function(e){return this.set(e.a,e.b,e.c,e.d,e.e,e.f)},o.prototype.transform=function(e){return this.set(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.e+this.c*e.f+this.e,this.b*e.e+this.d*e.f+this.f)},o.prototype.transformPoint=function(e){return{x:Math.round(this.a*e.x+this.c*e.y+this.e),y:Math.round(this.b*e.x+this.d*e.y+this.f)}},o.prototype.translate=function(e,t){return this.transform(o.getTranslate(e,t))},o.prototype.scale=function(e,t){return this.transform(o.getScale(e,t))},o.prototype.rotate=function(e){return this.transform(o.getRotate(e))},o.prototype.invert=function(){var e=this.a,t=this.b,n=this.c,o=this.d,r=this.e,i=this.f,a=1*o-0*i,s=-1*n+0*r,c=i*n-o*r,l=e*a+t*s+0*c;return l&&(l=1/l,this.a=a*l,this.b=(-1*t+0*i)*l,this.c=s*l,this.d=(1*e-0*r)*l,this.e=c*l,this.f=(-i*e+t*r)*l),this},o.prototype.getTranslationPart=function(){return{x:this.e,y:this.f}},o.prototype.setTranslationPart=function(e){this.e=e.x,this.f=e.y},o.prototype.getScalePart=function(){return{x:Math.sqrt(this.a*this.a+this.b*this.b),y:Math.sqrt(this.c*this.c+this.d*this.d)}},o.prototype.setScalePart=function(e){var t=this.getScalePart(),n=e.x/t.x;this.a*=n,this.b*=n;var o=e.y/t.y;this.c*=o,this.d*=o},o.prototype.getRotationPart=function(){var e=Math.sqrt(this.a*this.a+this.b*this.b);if(0===e)return 0;var t=Math.max(Math.min(this.a/e,1),-1),n=Math.max(Math.min(this.b/e,1),-1),o=Math.acos(t);return 0<=n?o:2*Math.PI-o},o.prototype.setRotationPart=function(e){var t=this.getScalePart(),n=Math.sin(e),o=Math.cos(e);this.a=t.x*o,this.b=t.x*n,this.c=-t.y*n,this.d=t.y*o},o}();t.Matrix2d=n});t(Z);Z.Matrix2d;var p=n(function(e,t){var o,s,n,h=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),(n=s=t.EventListenerOrder||(t.EventListenerOrder={}))[n.FIRST=1]="FIRST",n[n.LAST=2]="LAST";var r=function(){function e(e){this.type=e,this.eaten=!1}return e.prototype.eat=function(){this.eaten=!0},e}(),i=function(n){function o(e){var t=n.call(this,o.type)||this;return t.object=e,t.allow=!0,t}return h(o,n),o.type="@componentBeforeAttach",o}(t.BaseEvent=r);t.EvtComponentBeforeAttach=i;var a=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@componentAttached",t}(r);t.EvtComponentAttached=a;var c=function(t){function n(){var e=t.call(this,n.type)||this;return e.allow=!0,e}return h(n,t),n.type="@componentBeforeDetach",n}(r);t.EvtComponentBeforeDetach=c;var l=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@componentDetached",t}(r);t.EvtComponentDetached=l;var u=function(r){function i(e,t,n){var o=r.call(this,i.type)||this;return o.deltaTime=e,o.elapsedTime=t,o.frameStamp=n,o}return h(i,r),i.type="@update",i}(r);t.EvtUpdate=u;var p=function(o){function r(e,t){var n=o.call(this,r.type)||this;return n.canvasWidth=e,n.canvasHeight=t,n.result={},n}return h(r,o),r.prototype.addObject=function(e,t,n){var o=this.result[t]||[];o.push({object:e,z:t,transform:n}),this.result[t]=o},r.type="@cull",r}(r);t.EvtCull=p;var d=function(r){function i(e,t,n){var o=r.call(this,i.type)||this;return o.canvas=e,o.z=t,o.transform=n,o}return h(i,r),i.type="@draw",i}(r);t.EvtDraw=d;var f=function(o){function r(e,t){var n=o.call(this,r.type)||this;return n.x=e,n.y=t,n.result=!1,n}return h(r,o),r.type="@hittest",r}(r);t.EvtHitTest=f;var y=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@getboundingshape",t}(r);t.EvtGetBoundingShape=y;var v=function(r){function i(e,t,n){var o=r.call(this,i.type)||this;return o.deltaTime=e,o.elapsedTime=t,o.frameStamp=n,o}return h(i,r),i.type="@frame",i}(r);t.EvtFrame=v;var m=function(n){function o(e){var t=n.call(this,o.type)||this;return t.focus=e,t}return h(o,n),o.type="@focus",o}(r);t.EvtFocus=m;var g=function(c){function e(e,t,n,o,r,i,a){var s=c.call(this,e)||this;return s.key=t,s.keyCode=n,s.shiftDown=o,s.altDown=r,s.ctrlDown=i,s.metaDown=a,s}return h(e,c),e}(r),_=function(a){function s(e,t,n,o,r,i){return a.call(this,s.type,e,t,n,o,r,i)||this}return h(s,a),s.type="@keydown",s}(t.EvtKeyboard=g);t.EvtKeyDown=_;var b=function(a){function s(e,t,n,o,r,i){return a.call(this,s.type,e,t,n,o,r,i)||this}return h(s,a),s.type="@keyup",s}(g);t.EvtKeyUp=b;var w=function(a){function s(e,t,n,o,r,i){return a.call(this,s.type,e,t,n,o,r,i)||this}return h(s,a),s.type="@keypress",s}(g);t.EvtKeyPress=w;var x=function(l){function e(e,t,n,o,r,i,a,s){var c=l.call(this,e)||this;return c.x=t,c.y=n,c.button=o,c.shiftDown=r,c.altDown=i,c.ctrlDown=a,c.metaDown=s,c.bubble=!0,c}return h(e,l),e.prototype.cancelBubble=function(){this.bubble=!1},e}(r),P=function(s){function c(e,t,n,o,r,i,a){return s.call(this,c.type,e,t,n,o,r,i,a)||this}return h(c,s),c.type="@mousedown",c}(t.EvtMouse=x);t.EvtMouseDown=P;var j=function(s){function c(e,t,n,o,r,i,a){return s.call(this,c.type,e,t,n,o,r,i,a)||this}return h(c,s),c.type="@mouseup",c}(x);t.EvtMouseUp=j;var T=function(s){function c(e,t,n,o,r,i,a){return s.call(this,c.type,e,t,n,o,r,i,a)||this}return h(c,s),c.type="@mousemove",c}(x);t.EvtMouseMove=T;var k=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@mouseenter",t}(r);t.EvtMouseEnter=k;var S=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@mouseleave",t}(r);t.EvtMouseLeave=S;var O=function(s){function c(e,t,n,o,r,i,a){return s.call(this,c.type,e,t,n,o,r,i,a)||this}return h(c,s),c.type="@click",c}(x);t.EvtClick=O;var E=function(s){function c(e,t,n,o,r,i,a){return s.call(this,c.type,e,t,n,o,r,i,a)||this}return h(c,s),c.type="@dblclick",c}(x);t.EvtDblClick=E;var C=function(c){function l(e,t,n,o,r,i,a){var s=c.call(this,l.type,e,t,n,o,r,i,a)||this;return s.data=null,s}return h(l,c),l.type="@dragbegin",l}(x);t.EvtDragBegin=C;var B=function(l){function u(e,t,n,o,r,i,a,s){var c=l.call(this,u.type,e,t,n,o,r,i,a)||this;return c.data=s,c}return h(u,l),u.type="@dragend",u}(x);t.EvtDragEnd=B;var M=function(l){function u(e,t,n,o,r,i,a,s){var c=l.call(this,u.type,e,t,n,o,r,i,a)||this;return c.data=s,c}return h(u,l),u.type="@dragging",u}(x);t.EvtDragging=M;var W=function(u){function p(e,t,n,o,r,i,a,s,c){var l=u.call(this,p.type,e,t,n,o,r,i,a)||this;return l.object=s,l.data=c,l}return h(p,u),p.type="@dragover",p}(x);t.EvtDragOver=W;var D=function(u){function p(e,t,n,o,r,i,a,s,c){var l=u.call(this,p.type,e,t,n,o,r,i,a)||this;return l.object=s,l.data=c,l}return h(p,u),p.type="@dragdrop",p}(x);t.EvtDragDrop=D;var A=function(e){function t(){return e.call(this,t.type)||this}return h(t,e),t.type="@resize",t}(r);t.EvtResize=A;var F=function(n){function o(e){var t=n.call(this,o.type)||this;return t.view=e,t}return h(o,n),o.type="@canvasresize",o}(r);t.EvtCanvasResize=F;var I=function(n){function o(e){var t=n.call(this,o.type)||this;return t.propName=e,t.propValue=void 0,t}return h(o,n),o.type="@getprop",o}(r);t.EvtGetProp=I;var L=function(o){function r(e,t){var n=o.call(this,r.type)||this;return n.propName=e,n.propValue=t,n}return h(r,o),r.type="@setprop",r}(r);t.EvtSetProp=L;var N=function(r){function i(e,t,n){var o=r.call(this,i.type)||this;return o.view=e,o.oldPage=t,o.newPage=n,o}return h(i,r),i.type="@scenviewpagewillchange",i}(r);t.EvtSceneViewPageWillChange=N;var z=function(r){function i(e,t,n){var o=r.call(this,i.type)||this;return o.view=e,o.oldPage=t,o.newPage=n,o}return h(i,r),i.type="@sceneviewpagechanged",i}(r);t.EvtSceneViewPageChanged=z;var R=function(){function e(){}return e.isWindows=function(){return this._isWindows},e.isMac=function(){return this._isMac},e.isUnix=function(){return this._isX11&&!this._isWindows&&!this._isMac},e.isLinux=function(){return this._isLinux},e.isAndroid=function(){return this._isLinux&&this._isAndroid},e._isWindows="Win32"===navigator.platform||"Windows"===navigator.platform,e._isMac="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,e._isX11="X11"===navigator.platform,e._isLinux=0<=String(navigator.platform).indexOf("Linux"),e._isAndroid=0<=(navigator.userAgent.toLowerCase().match(/android/i)||[]).indexOf("android"),e}();t.EvtSysInfo=R;var V=function(){function e(){}return e.prototype.on=function(e,t,n){G.addEventListener(e,this,t,n||s.FIRST)},e.prototype.off=function(e,t){G.removeEventListener(e,this,t)},e.prototype.trigger=function(e){G.triggerEvent(this,e)},e.prototype.triggerEx=function(e){this.trigger(e)},e.prototype.post=function(e){G.postEvent(this,e)},e}();t.EventObserver=V;var G=function(){function n(){}return n.postEvent=function(e,t){this.eventQueue.push({evt:t,target:e})},n.triggerEvent=function(e,t){this.processEvent(t,e)},n.processPendingEvents=function(){var t=this,e=this.eventQueue;this.eventQueue=[],e.forEach(function(e){t.processEvent(e.evt,e.target)})},n.addEventListener=function(e,t,n,o){for(var r=this.eventListeners[e]||[],i=0;i<r.length;i++)if(r[i].bindObject===t){if(o===s.FIRST)r[i].handlers={handler:n,next:r[i].handlers};else{var a=r[i].handlers;if(a){for(;a.next;)a=a.next;a.next={handler:n,next:null}}}return}r.push({bindObject:t,handlers:{handler:n,next:null}}),this.eventListeners[e]=r},n.removeEventListener=function(e,t,n){for(var o=this.eventListeners[e]||[],r=0;r<o.length;r++)if(o[r].bindObject===t){if(!n){o.splice(r,1);break}for(var i=o[r].handlers,a=null;i&&i.handler!==n;)i=(a=i).next;i&&(a?a.next=i.next:o[r].handlers=i.next),o[r].handlers||o.splice(r,1)}},n.run=function(){this.running||(this.running=!0,this.lastFrameTime=0,this.firstFrameTime=0,this.elapsedTime=0,this.deltaTime=0,this.frameStamp=0,this.init(),requestAnimationFrame(function e(t){n.running&&(0===n.lastFrameTime&&(n.lastFrameTime=t,n.firstFrameTime=t),n.deltaTime=t-n.lastFrameTime,n.elapsedTime=t-n.firstFrameTime,n.lastFrameTime=t,n.frameStamp++,n.processPendingEvents(),n.triggerEvent(null,new v(n.deltaTime,n.elapsedTime,n.frameStamp)),n.running&&requestAnimationFrame(e))}))},n.addView=function(e){return!(!e||!e.canvas||this.findView(e.canvas.canvas))&&(this.views.push(e),this.focusView||this.setFocusView(e),!0)},n.addCanvas=function(e,t){if(this.findView(e))return null;var n=new X(e,void 0!==t&&t);return this.addView(n)?n:null},n.setFocusView=function(e){this.focusView!==e&&(this.focusView&&this.focusView.trigger(new m(!1)),this.focusView=e,this.focusView&&this.focusView.trigger(new m(!0)))},n.findView=function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].canvas.canvas===e)return this.views[t];return null},n.removeView=function(e){for(var t=0;t<this.views.length;t++)this.views[t].canvas.canvas===e&&this.views.splice(t,1)},n.setCapture=function(e){this.capturedView=e},n.init=function(){this.initEventListeners()},n.processEvent=function(e,t){var n=this.eventListeners[e.type];if(n)for(var o=0;o<n.length;o++){var r=n[o];if(!t||r.bindObject===t){for(var i=r.handlers;i&&(i.handler.call(r.bindObject,e),!e.eaten);)i=i.next;if(t)break}}},n.hitView=function(e,t){if(null!==this.capturedView)return this.capturedView;for(var n=0;n<this.views.length;n++){var o=this.views[n],r=o.canvas.viewport_rect;if(e>=r.x&&e<r.x+r.w&&t>=r.y&&t<r.y+r.h)return o}return null},n.resizeHandler=function(){var t=new A;this.views.forEach(function(e){e.triggerEx(t)})},n.mouseDownHandler=function(e){this.clickTick=Date.now();var t=this.hitView(e.clientX,e.clientY);null!==t&&t.handleMouseDown(e)},n.mouseUpHandler=function(e){var t=this.hitView(e.clientX,e.clientY);if(null!==t){var n=Date.now();n<this.clickTick+this.clickTime?n<this.dblClickTick+this.dblclickTime?(t.handleDblClick(e),this.dblClickTick=0):(t.handleClick(e),this.dblClickTick=n):this.dblClickTick=0,t.handleMouseUp(e),this.clickTick=0}else this.clickTick=0,this.dblClickTick=0},n.mouseMoveHandler=function(e){var t=this.hitView(e.clientX,e.clientY);if(t!==this.hoverView&&(this.hoverView&&(this.hoverView.triggerEx(new S),this.hoverView=null),null!==t&&(this.hoverView=t).triggerEx(new k)),null!==t){var n=t.canvas.viewport_rect;t.updateHitObjects(e.clientX-n.x,e.clientY-n.y),t.handleMouseMove(e)}},n.keyDownHandler=function(e){this.focusView&&this.focusView.trigger(new _(e.key,e.keyCode,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey))},n.keyUpHandler=function(e){this.focusView&&this.focusView.trigger(new b(e.key,e.keyCode,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey))},n.keyPressHandler=function(e){this.focusView&&this.focusView.trigger(new w(e.key,e.keyCode,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey))},n.initEventListeners=function(){window.addEventListener("resize",this.resizeHandler.bind(this)),window.addEventListener(window.onpointerdown?"pointerdown":"mousedown",this.mouseDownHandler.bind(this)),window.addEventListener(window.onpointerup?"pointerup":"mouseup",this.mouseUpHandler.bind(this)),window.addEventListener(window.onpointermove?"pointermove":"mousemove",this.mouseMoveHandler.bind(this)),window.addEventListener("keydown",this.keyDownHandler.bind(this)),window.addEventListener("keyup",this.keyUpHandler.bind(this)),window.addEventListener("keypress",this.keyPressHandler.bind(this))},n.elapsedTime=0,n.deltaTime=0,n.eventQueue=[],n.eventListeners={},n.running=!1,n.lastFrameTime=0,n.firstFrameTime=0,n.frameStamp=0,n.capturedView=null,n.hoverView=null,n.focusView=null,n.views=[],n.clickTick=0,n.dblClickTick=0,n.clickTime=400,n.dblclickTime=400,n}();t.App=G;var K=function(n){function e(e){var t=n.call(this)||this;return t.type=e,t.object=null,t}return h(e,n),e.prototype.toString=function(){return"<Component: "+this.type+">"},e}(V);t.Component=K;var H=function(n){function e(){var e=n.call(this)||this;return e.components={},e}return h(e,n),e.prototype.toString=function(){return"<BaseObject>"},e.prototype.addComponent=function(e){if(null===e.object){var t=this.components[e.type]||[];if(t.indexOf(e)<0){var n=new i(this);e.trigger(n),n.object=null,n.allow&&(t.push(e),e.object=this,e.trigger(new a))}this.components[e.type]=t}return this},e.prototype.removeComponent=function(e){if(e.object===this){var t=this.components[e.type].indexOf(e);this.removeComponentByIndex(e.type,t)}return this},e.prototype.removeComponentByIndex=function(e,t){var n=this.components[e];if(n&&0<=t&&t<n.length){var o=new c;n[t].trigger(o),o.allow&&(n[t].trigger(new l),n[t].object=null,n.splice(t,1))}return this},e.prototype.removeComponentsByType=function(e){for(var t=this.components[e];t&&0<t.length;)this.removeComponentByIndex(e,t.length-1);return this},e.prototype.removeAllComponents=function(){var t=this;return Object.keys(this.components).forEach(function(e){t.removeComponentsByType(e)}),this},e.prototype.getComponent=function(e,t){void 0===t&&(t=0);var n=this.components[e];return void 0===n||t<0||n.length<=t?null:n[t]},e.prototype.getComponents=function(e){return this.components[e]},e.prototype.triggerEx=function(t){for(var e in n.prototype.trigger.call(this,t),this.components)this.components.hasOwnProperty(e)&&this.components[e].forEach(function(e){e.trigger(t)})},e.prototype.post=function(e){G.postEvent(this,e)},e}(V),Y=function(t){function e(e){var o=t.call(this)||this;return o._view=null,o._parent=null,o._z=0,o._visible=!0,o._children=[],o._localTransform=new Z.Matrix2d,o._worldTranslation=null,o._worldRotation=null,o._worldScale=null,o._anchorPoint={x:0,y:0},e&&e.addChild(o),o.on(p.type,function(e){e.addObject(o,o.z,o.worldTransform)}),o.on(f.type,function(e){var t=o.boundingShape;e.result=!!t&&$.IntersectionTestShapePoint(t,{x:e.x,y:e.y})}),o.on(I.type,function(e){switch(e.propName){case"z":e.propValue=o.z,e.eat();break;case"visible":e.propValue=o.visible,e.eat();break;case"transform":e.propValue=o.localTransform,e.eat();break;case"translation":var t=o.translation;e.propValue=[t.x,t.y],e.eat();break;case"scale":var n=o.scale;e.propValue=[n.x,n.y],e.eat();break;case"rotation":e.propValue=o.rotation,e.eat();break;case"anchorPoint":e.propValue=o.anchorPoint,e.eat()}}),o.on(L.type,function(e){switch(e.propName){case"z":o.z=e.propValue,e.eat();break;case"visible":o.visible=e.propValue,e.eat();break;case"transform":o.localTransform=e.propValue,e.eat();break;case"translation":var t=e.propValue;o.translation={x:Math.round(t[0]),y:Math.round(t[1])};break;case"scale":var n=e.propValue;o.scale={x:n[0],y:n[1]};break;case"rotation":o.rotation=e.propValue;break;case"anchorPoint":o.anchorPoint=e.propValue}}),o}return h(e,t),Object.defineProperty(e.prototype,"boundingShape",{get:function(){var e=new y;return this.triggerEx(e),e.shape||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this.setZ(e)},enumerable:!0,configurable:!0}),e.prototype.setZ=function(e){this._z=e},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){this.setVisible(e)},enumerable:!0,configurable:!0}),e.prototype.setVisible=function(e){this._visible=e},Object.defineProperty(e.prototype,"localTransform",{get:function(){return this._localTransform},set:function(e){this.setLocalTransform(e)},enumerable:!0,configurable:!0}),e.prototype.setLocalTransform=function(e){this._localTransform=e},Object.defineProperty(e.prototype,"translation",{get:function(){return this.localTransform.getTranslationPart()},set:function(e){this.setTranslation(e)},enumerable:!0,configurable:!0}),e.prototype.setTranslation=function(e){this.localTransform.setTranslationPart(e)},Object.defineProperty(e.prototype,"scale",{get:function(){return this.localTransform.getScalePart()},set:function(e){this.setScale(e)},enumerable:!0,configurable:!0}),e.prototype.setScale=function(e){this.localTransform.setScalePart(e)},Object.defineProperty(e.prototype,"rotation",{get:function(){return this.localTransform.getRotationPart()},set:function(e){this.setRotation(e)},enumerable:!0,configurable:!0}),e.prototype.setRotation=function(e){this.localTransform.setRotationPart(e)},Object.defineProperty(e.prototype,"worldTransform",{get:function(){var e=this.parent?Z.Matrix2d.transform(this.parent.worldTransform,this.localTransform):this.localTransform;return null!==this._worldTranslation&&e.setTranslationPart(this._worldTranslation),null!==this._worldRotation&&e.setRotationPart(this._worldRotation),null!==this._worldScale&&e.setScalePart(this._worldScale),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldTranslation",{get:function(){return this._worldTranslation},set:function(e){this.setWorldTranslation(e)},enumerable:!0,configurable:!0}),e.prototype.setWorldTranslation=function(e){this._worldTranslation=null===e?null:{x:Math.round(e.x),y:Math.round(e.y)}},Object.defineProperty(e.prototype,"worldRotation",{get:function(){return this._worldRotation},set:function(e){this.setWorldRotation(e)},enumerable:!0,configurable:!0}),e.prototype.setWorldRotation=function(e){this._worldRotation=e},Object.defineProperty(e.prototype,"worldScale",{get:function(){return this._worldScale},set:function(e){this.setWorldScale(e)},enumerable:!0,configurable:!0}),e.prototype.setWorldScale=function(e){this._worldScale=e},Object.defineProperty(e.prototype,"anchorPoint",{get:function(){return this._anchorPoint},set:function(e){this.setAnchorPoint(e)},enumerable:!0,configurable:!0}),e.prototype.setAnchorPoint=function(e){this._anchorPoint=e},Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),e.prototype.collapseTransform=function(){var e=this.worldTransform;this.worldTranslation=null,this.worldRotation=null,this.worldScale=null,this.parent?this.localTransform=Z.Matrix2d.invert(this.parent.worldTransform).transform(e):this.localTransform=e,this.localTransform.e=Math.round(this.localTransform.e),this.localTransform.f=Math.round(this.localTransform.f)},e.prototype.getLocalPoint=function(e,t){return Z.Matrix2d.invert(this.worldTransform).transformPoint({x:e,y:t})},e.prototype.childAt=function(e){return this._children[e]},e.prototype.forEachChild=function(e){this._children.forEach(e)},e.prototype.addChild=function(e){null===e._parent&&(e._parent=this,e._view=this._view,this._children.push(e))},e.prototype.removeChild=function(e){if(e._parent===this){var t=this._children.indexOf(e);this.removeChildAt(t)}},e.prototype.removeChildAt=function(e){if(0<=e&&e<this._children.length){var t=this._children[e];this._children.splice(e,1),t._parent=null,t._view=null}},e.prototype.removeChildren=function(){for(;0<this._children.length;)this.removeChildAt(0)},e.prototype.unrefChildren=function(){for(;0<this._children.length;)this._children[0].unrefChildren(),this.removeChildAt(0)},e.prototype.remove=function(){this._parent&&this._parent.removeChild(this)},e.prototype.triggerRecursive=function(n){t.prototype.trigger.call(this,n),this.forEachChild(function(e,t){e.triggerRecursive(n)})},e.prototype.triggerRecursiveEx=function(n){t.prototype.triggerEx.call(this,n),this.forEachChild(function(e,t){e.triggerRecursiveEx(n)})},e.prototype.setCapture=function(){this._view&&this._view.setCaptureObject(this)},e.prototype.releaseCapture=function(){this._view&&this._view.captureObject===this&&this._view.setCaptureObject(null)},e.prototype.toString=function(){return"<SceneObject>"},e}(t.BaseObject=H);t.SceneObject=Y;var X=function(o){function e(e,t){void 0===t&&(t=!1);var i=o.call(this)||this;i._canvas=new q(i,e,t),i._captureObject=null,i._hitObjects=[],i._currentPage=null,i._pages={};var n=new Y;return(n.view=i).addPage({name:"page1",rootNode:n,bkImageUrl:null,bkImageRepeat:null,bkImageSize:null,bkImageAttachment:null,bkColor:"#ffffff"}),i.selectPage("page1"),i.on(v.type,function(e){var t=new u(e.deltaTime,e.elapsedTime,e.frameStamp);i.rootNode&&i.rootNode.triggerRecursiveEx(t),i.canvas.clear(),i.triggerEx(new d(i.canvas,0,new Z.Matrix2d)),i.canvas.flip()}),i.on(d.type,function(e){if(i.rootNode){var t=new p(e.canvas.width,e.canvas.height);for(var n in i.rootNode.triggerRecursiveEx(t),t.result)for(var o=t.result[n],r=0;r<o.length;r++)e.canvas.context.save(),e.canvas.applyTransform(o[r].transform),e.canvas.context.translate(.5,.5),o[r].object.triggerEx(new d(e.canvas,o[r].z,o[r].transform)),e.canvas.context.restore()}}),i}return h(e,o),e.prototype.forEachPage=function(e){if(e)for(var t in this._pages)e({name:t,rootNode:this._pages[t].rootNode,bkImageUrl:this._pages[t].bkImageUrl,bkImageRepeat:this._pages[t].bkImageRepeat,bkImageAttachment:this._pages[t].bkImageAttachment,bkImageSize:this._pages[t].bkImageSize,bkColor:this._pages[t].bkColor})},e.prototype.addPage=function(e){var t={name:null,rootNode:null,bkImageUrl:null,bkImageRepeat:"repeat",bkImageAttachment:"scroll",bkImageSize:"auto",bkColor:"#ffffff"},n=e||t,o=n.name||this.genPageName();return o in this._pages?null:(this._pages[o]={name:o,rootNode:n.rootNode,bkImageUrl:n.bkImageUrl,bkImageRepeat:n.bkImageRepeat||t.bkImageRepeat,bkImageAttachment:n.bkImageAttachment||t.bkImageAttachment,bkImageSize:n.bkImageSize||t.bkImageSize,bkColor:n.bkColor||t.bkColor},o)},e.prototype.removePage=function(e){if(e in this._pages){if(e===this._currentPage){var t=!1;for(var n in this._pages)n!==e&&(this.selectPage(n),t=!0);if(!t)return!1}var o=this._pages[e].rootNode;return o&&(o.unrefChildren(),o.view=null,this._pages[e].rootNode=null),delete this._pages[e],!0}return!1},e.prototype.selectPage=function(e){var t=this._currentPage;e in this._pages&&e!==t&&(G.triggerEvent(null,new N(this,t,e)),this._currentPage=e,this._captureObject=null,this._hitObjects.length=0,this.applyPage(this._pages[this._currentPage]),G.triggerEvent(null,new z(this,t,e)))},e.prototype.renamePage=function(e,t){if(e in this._pages&&t&&t!==e&&!(t in this._pages)){var n=this._pages[e];delete this._pages[e],n.name=t,this._pages[t]=n,e===this._currentPage&&(this._currentPage=t)}},Object.defineProperty(e.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImage",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageUrl:null},set:function(e){this._currentPage&&e!==this._pages[this._currentPage].bkImageUrl&&(this._pages[this._currentPage].bkImageUrl=e,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImageRepeat",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageRepeat:null},set:function(e){var t=e||"repeat";this._currentPage&&t!==this._pages[this._currentPage].bkImageRepeat&&(this._pages[this._currentPage].bkImageRepeat=t,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImageAttachment",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageAttachment:null},set:function(e){var t=e||"scroll";this._currentPage&&t!==this._pages[this._currentPage].bkImageAttachment&&(this._pages[this._currentPage].bkImageAttachment=t,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageImageSize",{get:function(){return this._currentPage?this._pages[this._currentPage].bkImageSize:null},set:function(e){var t=e||"auto";this._currentPage&&t!==this._pages[this._currentPage].bkImageSize&&(this._pages[this._currentPage].bkImageSize=t,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageColor",{get:function(){return this._currentPage?this._pages[this._currentPage].bkColor:null},set:function(e){this._currentPage&&e!==this._pages[this._currentPage].bkColor&&(this._pages[this._currentPage].bkColor=e,this.applyPage(this._pages[this._currentPage]))},enumerable:!0,configurable:!0}),e.prototype.updateHitObjects=function(e,t){for(var n=this.hitTest(e,t),o=0;o<this._hitObjects.length;)n.indexOf(this._hitObjects[o])<0?(this._hitObjects[o].trigger(new S),this._hitObjects.splice(o,1)):o++;for(o=0;o<n.length;o++)this._hitObjects.indexOf(n[o])<0&&n[o].trigger(new k);this._hitObjects=n,this.rootNode&&this._hitObjects.push(this.rootNode)},Object.defineProperty(e.prototype,"rootNode",{get:function(){if(this._currentPage){var e=this._pages[this._currentPage].rootNode;return e||(((e=new Y).view=this)._pages[this._currentPage].rootNode=e),e}return null},set:function(e){this._currentPage&&this._pages[this._currentPage].rootNode!==e&&(this._pages[this._currentPage].rootNode=e,this._hitObjects.length=0,this._captureObject=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureObject",{get:function(){return this._captureObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitObjects",{get:function(){return this._hitObjects},enumerable:!0,configurable:!0}),e.prototype.setCaptureObject=function(e){this._captureObject=e},e.prototype.handleMouseDown=function(e){var t=this.canvas.viewport_rect,n=new P(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey);if(this.isValidObject(this._captureObject))this._captureObject.triggerEx(n);else{for(var o=0;o<this._hitObjects.length;o++){var r=this._hitObjects[o];if(this.isValidObject(r)&&(r.triggerEx(n),!n.bubble))break}n.bubble&&this.triggerEx(n)}},e.prototype.handleMouseUp=function(e){var t=this.canvas.viewport_rect,n=new j(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey);if(this.isValidObject(this._captureObject))this._captureObject.triggerEx(n);else{for(var o=0;o<this._hitObjects.length;o++){var r=this._hitObjects[o];if(this.isValidObject(r)&&(r.triggerEx(n),!n.bubble))break}n.bubble&&this.triggerEx(n)}},e.prototype.handleMouseMove=function(e){var t=this.canvas.viewport_rect,n=new T(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey);if(this.isValidObject(this._captureObject))this._captureObject.triggerEx(n);else{for(var o=0;o<this._hitObjects.length;o++){var r=this._hitObjects[o];if(this.isValidObject(r)&&(r.triggerEx(n),!n.bubble))break}n.bubble&&this.triggerEx(n)}},e.prototype.handleClick=function(e){for(var t=this.canvas.viewport_rect,n=new O(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey),o=0;o<this._hitObjects.length;o++){var r=this._hitObjects[o];if(this.isValidObject(r)&&(r.triggerEx(n),!n.bubble))break}n.bubble&&this.triggerEx(n)},e.prototype.handleDblClick=function(e){for(var t=this.canvas.viewport_rect,n=new E(e.clientX-t.x,e.clientY-t.y,e.button,e.shiftKey,e.altKey,e.ctrlKey,e.metaKey),o=0;o<this._hitObjects.length;o++){var r=this._hitObjects[o];if(this.isValidObject(r)&&(r.triggerEx(n),!n.bubble))break}n.bubble&&this.triggerEx(n)},e.prototype.setFocus=function(){G.setFocusView(this)},e.prototype.hitTest=function(i,a){var e=[];return this.rootNode&&(!function n(e,o){var t=Z.Matrix2d.invert(e.worldTransform).transformPoint({x:i,y:a}),r=new f(t.x,t.y);e.triggerEx(r),r.result&&o.push(e),e.forEachChild(function(e,t){n(e,o)})}(this.rootNode,e),e.sort(function(e,t){return t.z-e.z})),e},e.prototype.isValidObject=function(e){return e&&e.view===this},e.prototype.genPageName=function(){for(var e=1;;){var t="page"+e++;if(!(t in this._pages))return t}},e.prototype.applyPage=function(e){var t=e.bkColor||"",n=e.bkImageUrl&&"url("+e.bkImageUrl+")"||"",o=e.bkImageRepeat||"repeat",r=e.bkImageAttachment||"scroll",i=e.bkImageSize||"auto";this._canvas.canvas.style.background=t+" "+n+" "+o+" "+r+" 0% 0% / "+i},e}(H);function U(o,r){var e=parseInt(window.getComputedStyle(o).zIndex||"0",10);isNaN(e)&&(e=0),e--;var t=document.createElement("div");t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.overflow="hidden",t.style.zIndex=String(e),t.style.visibility="hidden";var n=document.createElement("div");n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.width="10000000px",n.style.height="10000000px",t.appendChild(n);var i=document.createElement("div");i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.right="0px",i.style.bottom="0px",i.style.overflow="hidden",i.style.zIndex=String(e),i.style.visibility="hidden";var a=document.createElement("div");function s(){t.scrollLeft=1e7,t.scrollTop=1e7,i.scrollLeft=1e7,i.scrollTop=1e7}a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.width="200%",a.style.height="200%",i.appendChild(a),o.appendChild(t),o.appendChild(i),s();var c=o.getBoundingClientRect(),l=c.width,u=c.height,p=function(){var e=o.getBoundingClientRect(),t=e.width,n=e.height;t===l&&n===u||(l=t,u=n,r()),s()};t.addEventListener("scroll",p),i.addEventListener("scroll",p)}t.SceneView=X,t.ResizeSensor=U;var q=function(r){function e(e,t,n){void 0===n&&(n=!1);var o=r.call(this)||this;return o._view=e,o._canvas=t,o._buffer=null,o._screenCtx=null,o._offscreenCtx=null,o._width=0,o._height=0,o._canvas&&(o.adjustCanvasSize(o._canvas),o._canvas.parentElement&&U(o._canvas.parentElement,function(){o.adjustCanvasSize(o._canvas)})),o._mouseOver=!1,o._doubleBuffer=n,o}return h(e,r),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._doubleBuffer?this._offscreenCtx:this._screenCtx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport_rect",{get:function(){var e=this._canvas.getBoundingClientRect();return{x:e.left-document.documentElement.clientLeft,y:e.top-document.documentElement.clientTop,w:e.right-e.left,h:e.bottom-e.top}},enumerable:!0,configurable:!0}),e.prototype.clear=function(e){var t=e?e.x:0,n=e?e.y:0,o=e?e.w:this._width,r=e?e.h:this._height;this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(t,n,o,r),this._doubleBuffer&&this._screenCtx&&this._screenCtx.clearRect(t,n,o,r)},e.prototype.applyTransform=function(e){this.context.setTransform(e.a,e.b,e.c,e.d,Math.round(e.e),Math.round(e.f))},e.prototype.flip=function(){this._doubleBuffer&&this._screenCtx&&this._buffer&&this._screenCtx.drawImage(this._buffer,0,0)},e.prototype.adjustCanvasSize=function(e){if(e.parentElement){var t=window.getComputedStyle(e.parentElement);this._width=e.parentElement.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight),this._height=e.parentElement.clientHeight-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom),this._canvas.width=this._width,this._canvas.height=this._height,this._screenCtx=this._canvas.getContext("2d"),this._buffer=document.createElement("canvas"),this._buffer.width=this._width,this._buffer.height=this._height,this._offscreenCtx=this._buffer.getContext("2d"),G.triggerEvent(null,new F(this._view))}},e}(H);t.Canvas=q});t(p);p.EventListenerOrder,p.BaseEvent,p.EvtComponentBeforeAttach,p.EvtComponentAttached,p.EvtComponentBeforeDetach,p.EvtComponentDetached,p.EvtUpdate,p.EvtCull,p.EvtDraw,p.EvtHitTest,p.EvtGetBoundingShape,p.EvtFrame,p.EvtFocus,p.EvtKeyboard,p.EvtKeyDown,p.EvtKeyUp,p.EvtKeyPress,p.EvtMouse,p.EvtMouseDown,p.EvtMouseUp,p.EvtMouseMove,p.EvtMouseEnter,p.EvtMouseLeave,p.EvtClick,p.EvtDblClick,p.EvtDragBegin,p.EvtDragEnd,p.EvtDragging,p.EvtDragOver,p.EvtDragDrop,p.EvtResize,p.EvtCanvasResize,p.EvtGetProp,p.EvtSetProp,p.EvtSceneViewPageWillChange,p.EvtSceneViewPageChanged,p.EvtSysInfo,p.EventObserver,p.App,p.Component,p.BaseObject,p.SceneObject,p.SceneView,p.ResizeSensor,p.Canvas;var a=n(function(e,t){var o,n=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(s){function c(e){var i=s.call(this,c.type)||this;i._tracks={},i._duration=0,i._startTime=0,i._round=0;var t=e||{};if(i._delay=void 0===t.delay?0:t.delay,i._repeat=void 0===t.repeat?0:t.repeat,i._autoRemove=void 0===t.autoRemove||t.autoRemove,i._exclusive=!!t.exclusive,t.tracks)for(var n in t.tracks)if(t.tracks.hasOwnProperty(n)){var o=t.tracks[n],r=void 0===o.type?u.SplineType.POLY:o.type,a=void 0===o.clamp||o.clamp;i.setTrack(n,r,a,o.cp)}return i.on(p.EvtComponentBeforeAttach.type,function(e){e.object&&i._exclusive&&e.object.removeComponentsByType(i.type)}),i.on(p.EvtUpdate.type,function(e){var t=e.elapsedTime;if(0===i._startTime&&(i._startTime=t),!(i._startTime+i._delay>t)){var n=t-i._startTime-i._delay;for(var o in i._tracks)i._tracks.hasOwnProperty(o)&&(i._tracks[o].value=i._tracks[o].evalutor.eval(n));if(i.object)for(var r in i._tracks)i._tracks.hasOwnProperty(r)&&i.object.triggerEx(new p.EvtSetProp(r,i._tracks[r].value));n>=i._duration&&(i._round++,0===i._repeat||i._round<i._repeat?i._startTime=t+n-i._duration:i._autoRemove&&i.object&&i.object.removeComponent(i))}}),i}return n(c,s),Object.defineProperty(c.prototype,"repeat",{get:function(){return this._repeat},set:function(e){this._repeat=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"autoRemove",{get:function(){return this._autoRemove},set:function(e){this._autoRemove=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"delay",{get:function(){return this._delay},set:function(e){this._delay=e},enumerable:!0,configurable:!0}),c.prototype.setTrack=function(e,t,n,o){0<o.length&&(o[o.length-1].x>this._duration&&(this._duration=o[o.length-1].x),this._tracks[e]={evalutor:new u.Spline(t,o,n),value:null})},c.prototype.finish=function(){for(var e in this._tracks)this._tracks[e].value=this._tracks[e].evalutor.evalLast();if(this.object)for(var t in this._tracks)this.object.triggerEx(new p.EvtSetProp(t,this._tracks[t].value));this._round++,0===this._repeat||this._round<this._repeat?this._startTime=p.App.elapsedTime:this._autoRemove&&this.object&&this.object.removeComponent(this)},c.type="KeyframeAnimation",c}(p.Component);t.CoKeyframeAnimation=r;var i=function(e){function t(){var a=e.call(this,t.type)||this;return a._dragging=!1,a._draggingData=null,a.on(p.EvtMouseDown.type,function(e){var t=a.object;t.setCapture(),a._dragging=!0;var n=new p.EvtDragBegin(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown);t.triggerEx(n),a._draggingData=n.data,e.cancelBubble()}),a.on(p.EvtMouseUp.type,function(e){var t=a.object;if(t.releaseCapture(),t.view&&a._dragging){var n=new p.EvtDragEnd(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,a._draggingData);t.triggerEx(n),a._dragging=!1,t.view.updateHitObjects(e.x,e.y);for(var o=new p.EvtDragDrop(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,t,a._draggingData),r=0;r<t.view.hitObjects.length;r++){var i=t.view.hitObjects[r];if(i!==t&&i.z<=t.z&&(i.triggerEx(o),!o.bubble))break}o.bubble&&t.view.triggerEx(o),a._draggingData=null,e.cancelBubble()}}),a.on(p.EvtMouseMove.type,function(e){if(a.object&&a._dragging){var t=new p.EvtDragging(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,a._draggingData);a.object.triggerEx(t);var n=a.object;if(n.view){n.view.updateHitObjects(e.x,e.y);for(var o=new p.EvtDragOver(e.x,e.y,e.button,e.shiftDown,e.altDown,e.ctrlDown,e.metaDown,n,a._draggingData),r=0;r<n.view.hitObjects.length;r++){var i=n.view.hitObjects[r];if(i!==n&&i.z<=n.z&&(i.triggerEx(o),!o.bubble))break}o.bubble&&n.view.triggerEx(o),e.cancelBubble()}}}),a}return n(t,e),t.type="Draggable",t}(p.Component);t.CoDraggable=i;var a=function(e){function t(){return e.call(this,t.type)||this}return n(t,e),t.type="Droppable",t}(p.Component);t.CoDroppable=a;var s=function(r){function i(e,t,n){void 0===e&&(e=null),void 0===t&&(t=0),void 0===n&&(n=0);var o=r.call(this,i.type)||this;return o._image=new Image,e&&(o._image.src=e),o._width=t?o._image.width=t:o._image.complete?o._image.width:0,o._height=n?o._image.height=n:o._image.complete?o._image.height:0,o._image.complete?o._loaded=!0:(o._loaded=!1,o._image.onload=function(){0===o._width&&(o._width=o._image.width),0===o._height&&(o._height=o._image.height),o._loaded=!0}),o.on(p.EvtCull.type,function(e){if(o._loaded){var t=o.object;e.addObject(o,t.z,t.worldTransform)}}),o.on(p.EvtGetBoundingShape.type,function(e){o.object&&o._loaded&&(e.shape=new g.BoundingBox({x:-o._width*o.object.anchorPoint.x,y:-o._height*o.object.anchorPoint.y,w:o._width,h:o._height}))}),o.on(p.EvtDraw.type,function(e){o.object&&o._loaded&&e.canvas.context.drawImage(o._image,-Math.round(o._width*o.object.anchorPoint.x)-.5,-Math.round(o._height*o.object.anchorPoint.y)-.5,o._width,o._height)}),o.on(p.EvtGetProp.type,function(e){switch(e.propName){case"width":e.propValue=o._width,e.eat();break;case"height":e.propValue=o._height,e.eat()}}),o.on(p.EvtSetProp.type,function(e){switch(e.propName){case"width":o._width=e.propValue,o._image.width=o._width,e.eat();break;case"height":o._height=e.propValue,o._image.height=o._height,e.eat()}}),o}return n(i,r),i.type="Image",i}(p.Component);t.CoImage=s});t(a);a.CoKeyframeAnimation,a.CoDraggable,a.CoDroppable,a.CoImage;var s=n(function(e,t){function w(e,t,n,o,r,i,a,s){var c=4*(r*t+o);e[c]=i,e[c+1]=a,e[c+2]=s,e[c+3]=255}Object.defineProperty(t,"__esModule",{value:!0});var v=null;function h(e){for(var t={r:255,g:255,b:255,a:255},n=[],o=0,r=(e.toLowerCase(),"0".charCodeAt(0)),i="9".charCodeAt(0),a="a".charCodeAt(0),s="f".charCodeAt(0),c=1;c<e.length;c++){var l=e.charCodeAt(c),u=0;r<=l&&l<=i?u=l-r:a<=l&&l<=s&&(u=10+l-a),c%2==1?o=u:n.push(16*o+u)}return 0<n.length&&(t.r=n[0]),1<n.length&&(t.g=n[1]),2<n.length&&(t.b=n[2]),3<n.length&&(t.a=n[3]),t}t.DrawLine=function(e,t,n,o,r,i){var a=h(i),s=o<t?o:t,c=r<n?r:n,l=o<t?t:o,u=r<n?n:r,p=e.getImageData(s,c,l-s+1,u-c+1);!function(e,t,n,o,r,i,a,s,c,l){var u,p=Math.abs(i-o),h=Math.abs(a-r),d=0;p<h&&(d=1,u=o,o=r,r=u,u=i,i=a,a=u,u=p,p=h,h=u);var f=o<i?1:-1,y=r<a?1:-1,v=o,m=r,g=2*h,_=2*(h-p),b=2*h-p;if(1===d)for(;v!==i;)b<0?b+=g:(m+=y,b+=_),w(e,t,0,m,v,s,c,l),v+=f;else for(;v!==i;)b<0?b+=g:(m+=y,b+=_),w(e,t,0,v,m,s,c,l),v+=f}(p.data,p.width,p.height,t-s,n-c,o-s,r-c,a.r,a.g,a.b),e.putImageData(p,s,c)},t.FillCircle=function(e,t,n,o,r){var i=h(r),a=e.getImageData(t-o,n-o,2*o+1,2*o+1);!function(e,s,t,c,l,u,p,h,d){function n(e,t){var n=v,o=e-c,r=t-l,i=1-Math.sqrt((o*o+r*r)/(u*u)),a=4*(t*s+e);n[a]=p*i,n[a+1]=h*i,n[a+2]=d*i,n[a+3]=255*i}(null===v||v.length<e.length)&&(v=new Uint8ClampedArray(e.length));var o,r=0,i=u,a=3,f=2-u-u,y=1-u;for(n(r+c,i+l),n(r+c,-i+l),o=-u+c;o<=u+c;o++)n(o,l);for(;r<i;){for(y<0?(y+=a,a+=2,r++):(y+=a+f,a+=2,f+=2,r++,i--),o=-r+c;o<=r+c;o++)n(o,-i+l),n(o,i+l);for(o=-i+c;o<=i+c;o++)n(o,-r+l),n(o,r+l)}!function(e,t){for(var n=0;n<e.length/4;n++){var o=1-t[4*n+3]/255;e[4*n]=e[4*n]*o+t[4*n],e[4*n+1]=e[4*n+1]*o+t[4*n+1],e[4*n+2]=e[4*n+2]*o+t[4*n+2],e[4*n+3]<t[4*n+3]&&(e[4*n+3]=t[4*n+3])}}(e,v)}(a.data,a.width,a.height,o,o,o,i.r,i.g,i.b),e.putImageData(a,t-o,n-o)}});t(s);s.DrawLine,s.FillCircle;var h=n(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(v),t(i),t(g),t(m),t(_),t(b),t($),t(u),t(r),t(Z),t(p),t(a),t(s)});t(h);var d=n(function(e,t){var o,i=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){var o=e.call(this,t.type)||this;return o.on(u.type,function(e){e.tool.activateObject(o.object)}),o.on(a.type,function(e){e.tool.deactivateObject(o.object)}),o.on(b.type,function(e){var t=o.object;switch(e.name){case"localx":(n=t.translation).x=Number(e.value),t.translation=n;break;case"localy":(n=t.translation).y=Number(e.value),t.translation=n;break;case"anchorx":(n=t.anchorPoint).x=Number(e.value),t.anchorPoint=n;break;case"anchory":var n;(n=t.anchorPoint).y=Number(e.value),t.anchorPoint=n;break;case"entityName":t.entityName=e.value}}),o.on(w.type,function(e){var t=o.object;switch(e.name){case"localx":e.value=t.translation.x;break;case"localy":e.value=t.translation.y;break;case"anchorx":e.value=t.anchorPoint.x;break;case"anchory":e.value=t.anchorPoint.y;break;case"entityName":e.value=t.entityName;break;case"entityType":e.value=t.entityType}}),o.on(s.type,function(e){e.properties=e.properties||{},e.properties.general=e.properties.general||{desc:"通用",properties:[]},e.properties.general.properties.push({name:"entityType",desc:"类型",readonly:!0,type:"string",value:o.object?o.object.entityType:null}),e.properties.general.properties.push({name:"entityName",desc:"名称",readonly:!1,type:"string",value:o.object?o.object.entityName:null}),e.properties.general.properties.push({name:"localx",desc:"位置X",readonly:!1,type:"number",value:o.object?o.object.translation.x:null}),e.properties.general.properties.push({name:"localy",desc:"位置Y",readonly:!1,type:"number",value:o.object?o.object.translation.y:null}),e.properties.general.properties.push({name:"anchorx",desc:"锚点X",readonly:!1,type:"number",value:o.object?o.object.anchorPoint.x:null}),e.properties.general.properties.push({name:"anchory",desc:"锚点Y",readonly:!1,type:"number",value:o.object?o.object.anchorPoint.y:null})}),o}return i(t,e),t.type="WBComponent",t}(h.Component);t.WBComponent=r;var n=function(){function e(e){this.name=e}return e.prototype.createEntity=function(e,t,n){var o=this._createEntity(n);return null===o?null:(o.addComponent(new r),o.translation={x:e,y:t},o)},e.prototype.getCreationProperties=function(){return[]},e}();t.WBFactory=n;var u=function(n){function o(e){var t=n.call(this,o.type)||this;return t.tool=e,t}return i(o,n),o.type="@WBToolActivate",o}(h.BaseEvent);t.WBToolActivateEvent=u;var a=function(n){function o(e){var t=n.call(this,o.type)||this;return t.tool=e,t}return i(o,n),o.type="@WBToolDeactivate",o}(h.BaseEvent);t.WBToolDeactivateEvent=a;var s=function(e){function t(){return e.call(this,t.type)||this}return i(t,e),t.type="@WBGetObjectPropertyList",t}(h.BaseEvent);t.WBGetPropertyListEvent=s;var b=function(o){function r(e,t){var n=o.call(this,r.type)||this;return n.name=e,n.value=t,n}return i(r,o),r.type="@WBSetObjectPropertyEvent",r}(h.BaseEvent);t.WBSetPropertyEvent=b;var w=function(n){function o(e){var t=n.call(this,o.type)||this;return t.name=e,t}return i(o,n),o.type="@WBGetObjectPropertyEvent",o}(h.BaseEvent);t.WBGetPropertyEvent=w;var c=function(n){function o(e){var t=n.call(this,o.type)||this;return t.name=e,t}return i(o,n),o.type="@WBGetObject",o}(h.BaseEvent);t.WBGetObjectEvent=c;var l=function(r){function e(e,t,n){var o=r.call(this)||this;return o.name=e,o.desc=n||e,o._wb=t,o.on(w.type,function(e){switch(e.name){case"desc":e.value=o.desc}}),o.on(s.type,function(e){e.properties=e.properties||{}}),o}return i(e,r),e.prototype.activate=function(e){h.App.triggerEvent(null,new u(this))},e.prototype.deactivate=function(){h.App.triggerEvent(null,new a(this))},e.prototype.activateObject=function(e){},e.prototype.deactivateObject=function(e){},e.prototype.executeCommand=function(e){},e}(h.EventObserver);t.WBTool=l;var p=function(o){function e(e,t){void 0===t&&(t=!1);var n=o.call(this)||this;return n.view=null,n.view=h.App.addCanvas(e,t),n._factories={},n._tools={},n._currentTool="",n._entities={},n.on(c.type,function(e){e.object=n.findEntity(e.name)}),n.on(h.EvtSceneViewPageWillChange.type,function(e){var t=n._tools[n._currentTool];t&&t.deactivate()}),n.on(h.EvtSceneViewPageChanged.type,function(e){var t=n._tools[n._currentTool];t&&t.activate()}),n.view&&(n.view.on(h.EvtKeyDown.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtKeyUp.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtKeyPress.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtMouseDown.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtMouseUp.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtMouseMove.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtClick.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtDblClick.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)}),n.view.on(h.EvtDraw.type,function(e){""!==n._currentTool&&n._tools[n._currentTool].trigger(e)},h.EventListenerOrder.LAST)),n}return i(e,o),e.prototype.addTool=function(e){this._tools[e.name]=e},e.prototype.addFactory=function(e){this._factories[e.name]=e},e.prototype.getFactory=function(e){return this._factories[e]||null},e.prototype.createEntity=function(e,t,n,o,r,i){var a=null;if(null===t)for(var s=1;t=""+e.toLowerCase()+s++,null!==this.findEntity(t););else if(null!==(a=this.findEntity(t)))return n?null:a;var c=this._factories[e];if(c&&(a=c.createEntity(o,r,i))&&(a.entityName=t,a.entityType=e,this.view&&this.view.rootNode&&this.view.rootNode.addChild(a),this._entities[t]=a,""!==this._currentTool)){var l=this._tools[this._currentTool];l&&a.triggerEx(new u(l))}return a},e.prototype.deleteEntity=function(e){var t=this.findEntity(e);t&&(t.remove(),delete this._entities[e])},e.prototype.findEntity=function(e){return this._entities[e]||null},e.prototype.encodeCommand=function(e){var t=e.command;for(var n in e)"command"!==n&&(t+=" "+n+"="+e[n]);return t},e.prototype.executeCommand=function(e){var t=this;if(console.log("CMD: "+this.encodeCommand(e)),"UseTool"===e.command){if(this._currentTool!==e.name){if(""!==this._currentTool)this._tools[this._currentTool].deactivate();if(this._currentTool="",e.name){var n=this._tools[e.name];n&&(this._currentTool=e.name,n.activate(e.args||{}))}}}else if("CreateObject"===e.command){var o=e.type,r=e.name||null,i=!!e.failOnExists,a=e.params||{},s=this.createEntity(o,r,i,e.x,e.y,a);e.objectCreated=s}else if("DeleteObject"===e.command)this.deleteEntity(e.name);else if("DeleteObjects"===e.command)e.objects&&e.objects.forEach(function(e){t.deleteEntity(e)});else if("AlignObjectsLeft"===e.command){if(e.objects&&1<e.objects.length){for(var c=(g=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.e,l=1;l<g.length;l++){(p=g[l].worldTransform.e)<c&&(c=p)}g.forEach(function(e){e.worldTranslation={x:c,y:e.worldTransform.f},e.collapseTransform()})}}else if("AlignObjectsRight"===e.command){if(e.objects&&1<e.objects.length){var u=(g=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.e;for(l=1;l<g.length;l++){var p=g[l].worldTransform.e;u<p&&(u=p)}g.forEach(function(e){e.worldTranslation={x:u,y:e.worldTransform.f},e.collapseTransform()})}}else if("AlignObjectsTop"===e.command){if(e.objects&&1<e.objects.length){var h=(g=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.f;for(l=1;l<g.length;l++){(f=g[l].worldTransform.f)<h&&(h=f)}g.forEach(function(e){e.worldTranslation={x:e.worldTransform.e,y:h},e.collapseTransform()})}}else if("AlignObjectsBottom"===e.command){if(e.objects&&1<e.objects.length){var d=(g=e.objects.map(function(e){return t.findEntity(e)}))[0].worldTransform.f;for(l=1;l<g.length;l++){var f=g[l].worldTransform.f;d<f&&(d=f)}g.forEach(function(e){e.worldTranslation={x:e.worldTransform.e,y:d},e.collapseTransform()})}}else if("AlignObjectsHorizontal"===e.command){if(e.objects&&1<e.objects.length){var y=this.findEntity(e.objects[0]);if(y)for(f=y.worldTransform.f,l=1;l<e.objects.length;l++){(s=this.findEntity(e.objects[l]))&&(s.worldTranslation={x:s.worldTransform.e,y:f},s.collapseTransform())}}}else if("ArrangeObjectsHorizontal"===e.command){if(e.objects&&2<e.objects.length){(g=e.objects.map(function(e){return t.findEntity(e)})).sort(function(e,t){return e.worldTransform.e-t.worldTransform.e});var v=g[0].worldTransform.e,m=(g[g.length-1].worldTransform.e-v)/(g.length-1);for(l=1;l<g.length-1;l++)g[l].worldTranslation={x:v+l*m,y:g[l].worldTransform.f},g[l].collapseTransform()}}else if("ArrangeObjectsVertical"===e.command){if(e.objects&&2<e.objects.length){var g;(g=e.objects.map(function(e){return t.findEntity(e)})).sort(function(e,t){return e.worldTransform.f-t.worldTransform.f});for(v=g[0].worldTransform.f,m=(g[g.length-1].worldTransform.f-v)/(g.length-1),l=1;l<g.length-1;l++)g[l].worldTranslation={x:g[l].worldTransform.e,y:v+l*m},g[l].collapseTransform()}}else if("SetObjectProperty"===e.command){if(s=this.findEntity(e.objectName)){var _=new b(e.propName,e.propValue);s.triggerEx(_),s.entityName!==e.objectName&&(this.findEntity(s.entityName)?s.entityName=e.objectName:(delete this._entities[e.objectName],this._entities[s.entityName]=s))}}else if("GetObjectProperty"===e.command){if(s=this.findEntity(e.objectName)){_=new w(e.propName);s.triggerEx(_),e.propValue=_.value}}else"AddPage"===e.command?this.view&&this.view.addPage():"RenamePage"===e.command?this.view&&this.view.currentPage&&this.view.renamePage(this.view.currentPage,e.newName):this._currentTool&&this._tools[this._currentTool].executeCommand(e)},e}(h.EventObserver);t.WhiteBoard=p});t(d);d.WBComponent,d.WBFactory,d.WBToolActivateEvent,d.WBToolDeactivateEvent,d.WBGetPropertyListEvent,d.WBSetPropertyEvent,d.WBGetPropertyEvent,d.WBGetObjectEvent,d.WBTool,d.WhiteBoard;var f=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function r(e,t){this._editor=e,this._container=t,this._tools=[],this._curTool=null}return r.prototype.unload=function(){for(;this._container.hasChildNodes();)this._container.removeChild(this._container.firstChild);this._tools=[]},r.prototype.loadToolPalette=function(n){var i=this,e=function(e){var t=o.getOpTool(n,e),r=o.createToolButton(t);r&&r.addEventListener("click",function(){var e=Number(r.getAttribute("toolIndex")),t=i._tools[e];if(t!==i._curTool&&i._curTool){var n=document.querySelector("#"+i._curTool.elementId);n&&n.classList.remove("active"),i._editor.executeCommand({command:"UseTool"}),i._curTool=null}if(t){var o=document.querySelector("#"+t.elementId);o&&o.classList.add("active"),i._editor.executeCommand(t.command),i._curTool=t}})},o=this;for(var t in n)e(t)},r.prototype.loadOpPalette=function(o){var r=this,e=function(e){var t=i.getOpTool(o,e),n=i.createToolButton(t);n&&n.addEventListener("click",function(){var e=Number(n.getAttribute("toolIndex")),t=r._tools[e];r._editor.executeCommand(t.command)})},i=this;for(var t in o)e(t)},r.prototype.getOpTool=function(e,t){var n={command:{command:t},iconClass:e[t].iconClass},o=e[t].command;o&&(n.command.command=o);var r=e[t].args;if(r)for(var i in r)n.command[i]=r[i];return n},r.prototype.createToolButton=function(e){this._tools.push(e);var t=this._editor.toolFontSize+6,n=null;if("function"==typeof e.iconClass)(n=e.iconClass(this._editor))&&n.classList.add("toolbutton");else{(n=document.createElement("div")).classList.add("flex-h","flex-align-x-center","flex-align-y-center"),n.classList.add("toolbutton");var o=document.createElement("i");o.style.fontSize=this._editor.toolFontSize+"px",o.style.color="#fff",e.iconClass.split(" ").forEach(function(e){o.classList.add(e)}),n.appendChild(o)}return n&&(e.elementId="toolbutton-"+r.uniqueId++,n.setAttribute("id",e.elementId),n.style.width=t+"px",n.style.height=t+"px",n.setAttribute("toolIndex",String(this._tools.length-1)),this._container.appendChild(n)),n},r.uniqueId=1,r}();t.WBToolPalette=a;var s=function(){function e(e,t,n){this._editor=e,this._container=t,this._tableId=n,this._object=null;var o=document.createElement("table");o.style.border="solid 1px #95B8E7",o.style.borderSpacing="0px",o.style.margin="0px",o.style.fontSize="12px",o.style.fontFamily="verdana",o.style.width="100%",o.style.tableLayout="fixed",o.style.backgroundColor="#fff",o.setAttribute("id",this._tableId);var r=document.createElement("tbody");o.appendChild(r),this._container.appendChild(o)}return e.prototype.addGroup=function(e){var t=this.createRow();t.style.backgroundColor="#E0ECFF",t.style.fontWeight="bold",this.createGroupCell(t,e)},e.prototype.addButton=function(e,t){var n=this.createRow(),o=this.createCell(n);o.style.padding="5px",o.style.textAlign="center",o.setAttribute("colspan","2");var r=document.createElement("button");r.innerText=e,r.style.width="100%",r.style.padding="5px",r.onclick=function(){t&&t()},o.appendChild(r)},e.prototype.addTextAttribute=function(e,t,n,o,r){var i=this.createRow();this.createPropCell(i).innerText=e;var a=document.createElement("input");a.type="text",t&&(a.value=t),a.style.width="100%",a.style.boxSizing="border-box",a.readOnly=n,a.disabled=n,o&&(r?a.onchange=a.onblur=function(){a.value=String(o(a.value))}:a.oninput=function(){a.value=String(o(a.value))}),this.createPropCell(i).appendChild(a)},e.prototype.addToggleAttribute=function(e,t,n,o){var r=this.createRow();this.createPropCell(r).innerText=e;var i=document.createElement("input");i.type="checkbox",i.checked=t,i.readOnly=n,i.disabled=n,o&&(i.onchange=function(){i.checked=Boolean(o(i.checked))}),this.createPropCell(r).appendChild(i)},e.prototype.addNumberAttribute=function(e,t,n,o){var r=this.createRow();this.createPropCell(r).innerText=e;var i=document.createElement("input");i.type="number",i.value=String(t),i.readOnly=n,i.disabled=n,i.style.width="100%",i.style.boxSizing="border-box",o&&(i.oninput=function(){i.value=String(o(Number(i.value)))}),this.createPropCell(r).appendChild(i)},e.prototype.addChoiceAttribute=function(e,t,n,o,r){var i=this.createRow();this.createPropCell(i).innerText=e;var a=document.createElement("select");t.forEach(function(e){var t=document.createElement("option");t.value=String(e.value),t.innerText=String(e.desc),a.add(t)}),n&&(a.value=String(n)),a.disabled=o,a.style.width="100%",a.style.boxSizing="border-box",r&&(a.onchange=function(){a.value=String(r(a.value))}),this.createPropCell(i).appendChild(a)},e.prototype.addColorAttribute=function(e,t,n,o){var r=this.createRow();this.createPropCell(r).innerText=e;var i=document.createElement("input");i.type="color",i.value=t,i.readOnly=n,i.disabled=n,i.style.width="100%",i.style.boxSizing="border-box",o&&(i.onchange=function(){i.value=String(o(i.value))}),this.createPropCell(r).appendChild(i)},e.prototype.getToolProperty=function(e){if(this._object){var t=new d.WBGetPropertyEvent(e);return this._object.triggerEx(t),t.value}},e.prototype.setToolProperty=function(e,t){if(this._object){var n=new d.WBSetPropertyEvent(e,t);this._object.triggerEx(n)}},e.prototype.addToolProperty=function(e){var t=this,n=e.name,o=e.type,r=e.readonly;if(e.enum)this.addChoiceAttribute(e.desc,e.enum,this.getToolProperty(n),r,function(e){switch(o){case"string":return t.setToolProperty(n,e),t.getToolProperty(n);case"number":return t.setToolProperty(n,Number(e)),t.getToolProperty(n);case"boolean":return t.setToolProperty(n,Boolean(e)),t.getObjectProperty(n);case"color":return t.setToolProperty(n,e),t.getToolProperty(n)}});else switch(o){case"string":this.addTextAttribute(e.desc,this.getToolProperty(n),r,function(e){return t.setToolProperty(n,e),t.getToolProperty(n)});break;case"number":this.addNumberAttribute(e.desc,this.getToolProperty(n),r,function(e){return t.setToolProperty(n,e),t.getToolProperty(n)});break;case"boolean":this.addToggleAttribute(e.desc,this.getToolProperty(n),r,function(e){return t.setToolProperty(n,e),t.getToolProperty(n)});break;case"color":this.addColorAttribute(e.desc,this.getToolProperty(n),r,function(e){return t.setToolProperty(n,e),t.getToolProperty(n)})}},e.prototype.getObjectProperty=function(e){if(this._object){var t={command:"GetObjectProperty",objectName:this._object.entityName,propName:e};return this._editor.whiteboard.executeCommand(t),t.propValue}},e.prototype.setObjectProperty=function(e,t){this._object&&this._editor.whiteboard.executeCommand({command:"SetObjectProperty",objectName:this._object.entityName,propName:e,propValue:t})},e.prototype.addObjectProperty=function(e){var t=this,n=e.name,o=e.type,r=e.readonly;if(e.enum)this.addChoiceAttribute(e.desc,e.enum,this.getObjectProperty(n),r,function(e){switch(o){case"string":return t.setObjectProperty(n,e),t.getObjectProperty(n);case"number":return t.setObjectProperty(n,Number(e)),t.getObjectProperty(n);case"boolean":return t.setObjectProperty(n,Boolean(e)),t.getObjectProperty(n);case"color":return t.setObjectProperty(n,e),t.getObjectProperty(n)}});else switch(o){case"string":this.addTextAttribute(e.desc,this.getObjectProperty(n),r,function(e){return t.setObjectProperty(n,e),t.getObjectProperty(n)});break;case"number":this.addNumberAttribute(e.desc,this.getObjectProperty(n),r,function(e){return t.setObjectProperty(n,e),t.getObjectProperty(n)});break;case"boolean":this.addToggleAttribute(e.desc,this.getObjectProperty(n),r,function(e){return t.setObjectProperty(n,e),t.getObjectProperty(n)});break;case"color":this.addColorAttribute(e.desc,this.getObjectProperty(n),r,function(e){return t.setObjectProperty(n,e),t.getObjectProperty(n)})}},e.prototype.clear=function(){for(var e=document.querySelectorAll("table#"+this._tableId+" input"),t=0;t<e.length;t++)e[t].onchange=null;var n=document.querySelectorAll("table#"+this._tableId+" select");for(t=0;t<n.length;t++)n[t].onchange=null;for(var o=document.querySelector("table#"+this._tableId+" tbody");o&&o.hasChildNodes();)o.removeChild(o.firstChild);this._object=null},e.prototype.reloadToolProperties=function(){var e=this._object;this.clear(),e&&this.loadToolProperties(e)},e.prototype.loadToolProperties=function(e){var t=this;if(this._object!==e&&(this.clear(),this._object=e,this._object)){var n=new d.WBGetPropertyListEvent;if(this._object.triggerEx(n),n.properties)for(var o in n.properties){var r=n.properties[o];this.addGroup(r.desc),r.properties.forEach(function(e){t.addToolProperty(e)})}}},e.prototype.reloadObjectProperties=function(){var e=this._object;this.clear(),e&&this.loadObjectProperties(e)},e.prototype.loadObjectProperties=function(e){var t=this;if(this._object!==e&&(this.clear(),this._object=e,this._object)){var n=new d.WBGetPropertyListEvent;if(this._object.triggerEx(n),n.properties)for(var o in n.properties){var r=n.properties[o];this.addGroup(r.desc),r.properties.forEach(function(e){t.addObjectProperty(e)})}}},e.prototype.loadPageProperties=function(){var t=this;this.clear();var n=[],o=this._editor.whiteboard.view;o&&(o.forEachPage(function(e){n.push({value:e.name,desc:e.name})}),this.addChoiceAttribute("页面列表",n,o.currentPage,!1,function(e){return o.selectPage(e),t.loadPageProperties(),o.currentPage}),this.addTextAttribute("页面名称",o.currentPage,!1,function(e){if(e!==o.currentPage)return t._editor.whiteboard.executeCommand({command:"RenamePage",newName:e}),t.loadPageProperties(),o.currentPage},!0),this.addTextAttribute("页面背景图像",o.pageImage,!1,function(e){return o.pageImage=""===e?null:e,e},!0),this.addChoiceAttribute("页面背景重复",[{value:"repeat",desc:"重复"},{value:"repeat-x",desc:"横向重复"},{value:"repeat-y",desc:"纵向重复"},{value:"no-repeat",desc:"不重复"}],o.pageImageRepeat,!1,function(e){return o.pageImageRepeat=e}),this.addToggleAttribute("页面背景固定","fixed"===o.pageImageAttachment,!1,function(e){return o.pageImageAttachment=e?"fixed":"scroll",e}),this.addTextAttribute("页面背景大小",o.pageImageSize,!1,function(e){return o.pageImageSize=e}),this.addColorAttribute("页面背景颜色",o.pageColor||"",!1,function(e){return o.pageColor=""===e?null:e,e}),this.addButton("新建页面",function(){t._editor.whiteboard.executeCommand({command:"AddPage"}),t.loadPageProperties()}),this.addButton("删除页面",function(){t._editor.whiteboard.executeCommand({command:"DeletePage"}),t.loadPageProperties()}))},e.prototype.createRow=function(){var e=document.querySelector("#"+this._tableId+" tbody"),t=document.createElement("tr");return e&&t&&e.appendChild(t),t},e.prototype.createCell=function(e){var t=document.createElement("td");return t.style.color="#000",t.style.fontWeight="bold",t.style.overflow="hidden",t.style.whiteSpace="nowrap",t.style.textOverflow="ellipsis",t.style.height="24px",e.appendChild(t),t},e.prototype.createGroupCell=function(e,t){var n=this.createCell(e);return n.style.paddingLeft="5px",n.setAttribute("colspan","2"),n.innerText=t,n},e.prototype.createPropCell=function(e){var t=this.createCell(e);return t.style.paddingLeft="5px",t.style.border="dotted 1px #ccc",t.style.color="#000",t},e}();t.WBPropertyGrid=s;var n=function(){function e(e,t,n,o,r,i){this._strokeColor="#00000000",this._fillColor="red",this._toolFontSize=14,this._wb=e,this._toolset=t,this._toolPalette=new a(this,n),this._toolPalette.loadToolPalette(t.tools),this._opPalette=new a(this,o),this._opPalette.loadOpPalette(t.operations),this._objectPropGrid=new s(this,r,"wb-object"),this._toolPropGrid=new s(this,i,"wb-tool"),this._objectPropGrid.loadPageProperties()}return Object.defineProperty(e.prototype,"toolSet",{get:function(){return this._toolset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opPalette",{get:function(){return this._opPalette},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolPalette",{get:function(){return this._toolPalette},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectPropertyGrid",{get:function(){return this._objectPropGrid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolPropertyGrid",{get:function(){return this._toolPropGrid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"whiteboard",{get:function(){return this._wb},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokeColor",{get:function(){return this._strokeColor},set:function(e){this._strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},set:function(e){this._fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolFontSize",{get:function(){return this._toolFontSize},set:function(e){this._toolFontSize=e},enumerable:!0,configurable:!0}),e.prototype.executeCommand=function(e){if("function"==typeof e.command)e.command(this);else if(0<e.command.length&&"$"!==e.command.charAt(0)){var t={};for(var n in e){var o=e[n];t[n]="function"==typeof o?o(this):o}this._wb.executeCommand(t)}},e}();t.WBEditor=n});t(f);f.WBToolPalette,f.WBPropertyGrid,f.WBEditor;var y=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WBDefaultToolSet={tools:{CreateLabel:{iconClass:"fas fa-font fa-fw",command:"UseTool",args:{name:"Create",args:{createType:"Label",text:"标签",textColor:"#000000"}}},Select:{iconClass:"fas fa-mouse-pointer fa-fw",command:"UseTool",args:{name:"Select"}},Swap:{iconClass:"fas fa-exchange-alt fa-fw",command:"UseTool",args:{name:"Swap"}},Connect:{iconClass:"fas fa-arrow-right fa-fw",command:"UseTool",args:{name:"Connect"}},Write:{iconClass:"fas fa-pen fa-fw",command:function(e){e.whiteboard.executeCommand({command:"UseTool",name:"HandWriting",args:{mode:"draw"}})}},Erase:{iconClass:"fas fa-eraser fa-fw",command:function(e){e.whiteboard.executeCommand({command:"UseTool",name:"HandWriting",args:{mode:"erase"}})}}},operations:{Delete:{iconClass:"fas fa-trash-alt fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&0<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"DeleteObjects",objects:t.selectedObjects.map(function(e){return e.entityName})})}},Clone:{iconClass:"fas fa-clone fa-fw"},AlignLeft:{iconClass:"fas fa-align-left fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&0<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"AlignObjectsLeft",objects:t.selectedObjects.map(function(e){return e.entityName})})}},AlignRight:{iconClass:"fas fa-align-right fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&0<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"AlignObjectsRight",objects:t.selectedObjects.map(function(e){return e.entityName})})}},AlignTop:{iconClass:"fas fa-align-right fa-rotate-270 fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&1<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"AlignObjectsTop",objects:t.selectedObjects.map(function(e){return e.entityName})})}},AlignBottom:{iconClass:"fas fa-align-right fa-rotate-90 fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&1<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"AlignObjectsBottom",objects:t.selectedObjects.map(function(e){return e.entityName})})}},ArrangeH:{iconClass:"fas fa-arrows-alt-h fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&2<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"ArrangeObjectsHorizontal",objects:t.selectedObjects.map(function(e){return e.entityName})})}},ArrangeV:{iconClass:"fas fa-arrows-alt-v fa-fw",command:function(e){var t={command:"GetSelected"};e.whiteboard.executeCommand(t),t.selectedObjects&&2<t.selectedObjects.length&&e.whiteboard.executeCommand({command:"ArrangeObjectsVertical",objects:t.selectedObjects.map(function(e){return e.entityName})})}},$StrokeColor:{iconClass:function(e){var t=document.createElement("input");return t.type="color",t.value=e.strokeColor,t.style.padding="0px",t.onchange=function(){e.strokeColor=t.value},t}},$FillColor:{iconClass:function(e){var t=document.createElement("input");return t.type="color",t.value=e.fillColor,t.style.padding="0px",t.onchange=function(){e.fillColor=t.value},t}}}}});t(y);y.WBDefaultToolSet;var w=n(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(o),t(f),t(y)});t(w);var x=n(function(e,t){var o,n=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(o){function e(e,t){void 0===t&&(t=null);var s=o.call(this,e||void 0)||this,n=t||{};return s._width=Number(n.width||0),s._height=Number(n.height||0),s._fontSize=Number(n.fontSize||16),s._fontStyle=n.fontStyle||"normal",s._fontVariant=n.fontVariant||"normal",s._fontWeight=n.fontWeight||"normal",s._fontFamily=n.fontFamily||"PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Source Han Sans CN,sans-serif",s._font="",s._text=n.text?s.parseText(n.text):"",s._measure=null,s._minwidth=10,s._textcolor=n.textColor||"#000",s._bkColor=n.bkColor||"#f00",s._bkShape=n.bkShape||"rect",s._boundingShape=null,s.anchorPoint={x:.5,y:.5},s.on(h.EvtUpdate.type,function(e){s.update()}),s.on(h.EvtGetBoundingShape.type,function(e){s._boundingShape&&(e.shape=s._boundingShape)}),s.on(h.EvtDraw.type,function(e){if(s._measure){var t=s._measure.width;t<s._minwidth&&(t=s._minwidth);var n=s._fontSize,o=Math.max(s._width,t),r=Math.max(s._height,n);switch(s._bkShape){case"rect":e.canvas.context.fillStyle=s._bkColor,e.canvas.context.fillRect(-o*s.anchorPoint.x,-r*s.anchorPoint.y,o,r);break;case"ellipse":e.canvas.context.fillStyle=s._bkColor,e.canvas.context.beginPath(),e.canvas.context.ellipse(-o*s.anchorPoint.x+o/2,-r*s.anchorPoint.y+r/2,o/2,r/2,0,0,2*Math.PI),e.canvas.context.closePath(),e.canvas.context.fill()}var i=(o-t)/2-o*s.anchorPoint.x,a=(r-n)/2-r*s.anchorPoint.y;e.canvas.context.fillStyle=s._textcolor,e.canvas.context.font=s._font,e.canvas.context.fillText(s._text,i,a,t)}}),s.on(d.WBGetPropertyEvent.type,function(e){switch(e.name){case"text":e.value=s.text;break;case"textColor":e.value=s._textcolor;break;case"fontSize":e.value=s.fontSize;break;case"fontWeight":e.value=s.fontWeight;break;case"fontStyle":e.value=s.fontStyle;break;case"width":e.value=s._width;break;case"height":e.value=s._height;break;case"bkColor":e.value=s.bkColor;break;case"bkShape":e.value=s.bkShape}}),s.on(d.WBSetPropertyEvent.type,function(e){switch(e.name){case"text":s.text=e.value;break;case"textColor":s._textcolor=e.value;break;case"fontSize":s.fontSize=Number(e.value);break;case"fontWeight":s.fontWeight=String(e.value);break;case"fontStyle":s.fontStyle=String(e.value);break;case"width":s.width=Number(e.value);break;case"height":s.height=Number(e.value);break;case"bkColor":s.bkColor=String(e.value);break;case"bkShape":s.bkShape=String(e.value)}}),s.on(d.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[s.entityType]=e.properties[s.entityType]||{desc:s.entityType,properties:[]},e.properties[s.entityType].properties.push({name:"text",desc:"文字内容",readonly:!1,type:"string",value:s.text}),e.properties[s.entityType].properties.push({name:"textColor",desc:"文字颜色",readonly:!1,type:"color",value:s._textcolor}),e.properties[s.entityType].properties.push({name:"fontSize",desc:"字体大小",readonly:!1,type:"number",value:s.fontSize}),e.properties[s.entityType].properties.push({name:"fontWeight",desc:"字体粗细",readonly:!1,type:"string",value:s._fontWeight,enum:[{value:"normal",desc:"正常"},{value:"bold",desc:"粗体"},{value:"bolder",desc:"加粗"},{value:"lighter",desc:"纤细"}]}),e.properties[s.entityType].properties.push({name:"fontStyle",desc:"字体样式",readonly:!1,type:"string",value:s._fontStyle,enum:[{value:"normal",desc:"正常"},{value:"italic",desc:"斜体"}]}),e.properties[s.entityType].properties.push({name:"width",desc:"宽度",readonly:!1,type:"number",value:s.width}),e.properties[s.entityType].properties.push({name:"height",desc:"高度",readonly:!1,type:"number",value:s.height}),e.properties[s.entityType].properties.push({name:"bkColor",desc:"背景颜色",readonly:!1,type:"color",value:s.bkColor}),e.properties[s.entityType].properties.push({name:"bkShape",desc:"背景样式",readonly:!1,type:"string",value:s.bkShape,enum:[{value:"none",desc:"无"},{value:"rect",desc:"矩形"},{value:"ellipse",desc:"圆形"}]})}),s}return n(e,o),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){var t=this.parseText(e);t!==this._text&&(this._text=t,this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),e.prototype.setAnchorPoint=function(e){o.prototype.setAnchorPoint.call(this,e),this._boundingShape=null},Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e!==this._fontSize&&(this._fontSize=e,this._font="",this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){e!==this._fontWeight&&(this._fontWeight=e,this._font="",this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){e!==this._fontStyle&&(this._fontStyle=e,this._font="",this._measure=null,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(e){e!==this._height&&(this._height=e,this._boundingShape=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bkColor",{get:function(){return this._bkColor},set:function(e){this._bkColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bkShape",{get:function(){return this._bkShape},set:function(e){this._bkShape=e},enumerable:!0,configurable:!0}),e.prototype.parseText=function(e){var t=/\{\{[^\{\}]*\}\}/g,n=e.split(t);if(1===n.length)return e;for(;;){var o=t.exec(e);if(null===o)break;var r=String(new Function("return "+o[0].slice(2,o[0].length-2))());n.splice(1,0,r)}return n.join("")},e.prototype.update=function(){if(""===this._font&&(this._font=this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+this._fontSize+"px "+this._fontFamily,this._boundingShape=null),this.view&&null===this._measure&&(this.view.canvas.context.textAlign="left",this.view.canvas.context.textBaseline="hanging",this.view.canvas.context.font=this._font,this._measure=this.view.canvas.context.measureText(this._text),this._boundingShape=null),this._measure&&!this._boundingShape){var e=Math.max(this._measure.width,this._minwidth),t=this._fontSize,n=Math.max(e,this._width),o=Math.max(t,this._height);this._boundingShape=new h.BoundingBox({x:-n*this.anchorPoint.x,y:-o*this.anchorPoint.y,w:n,h:o})}},e}(h.SceneObject);t.WBLabel=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getCreationProperties=function(){return[{name:"text",desc:"文字内容",readonly:!1,type:"string",value:"标签"},{name:"textColor",desc:"文字颜色",readonly:!1,type:"color",value:"#000"},{name:"fontSize",desc:"字体大小",readonly:!1,type:"number",value:16},{name:"fontWeight",desc:"字体粗细",readonly:!1,type:"string",value:"normal",enum:[{value:"normal",desc:"正常"},{value:"bold",desc:"粗体"},{value:"bolder",desc:"加粗"},{value:"lighter",desc:"纤细"}]},{name:"fontStyle",desc:"字体样式",readonly:!1,type:"string",value:"normal",enum:[{value:"normal",desc:"正常"},{value:"italic",desc:"斜体"}]},{name:"width",desc:"宽度",readonly:!1,type:"number",value:0},{name:"height",desc:"高度",readonly:!1,type:"number",value:0},{name:"bkColor",desc:"背景颜色",readonly:!1,type:"color",value:"#0000ff"},{name:"bkShape",desc:"背景样式",readonly:!1,type:"string",value:"none",enum:[{value:"none",desc:"无"},{value:"rect",desc:"矩形"},{value:"ellipse",desc:"圆形"}]}]},t.prototype._createEntity=function(e){return new r(null,e)},t}(d.WBFactory);t.WBLabelFactory=i});t(x);x.WBLabel,x.WBLabelFactory;var P=n(function(e,t){var o,n=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function e(e,t){void 0===t&&(t=null);var n=r.call(this,e||void 0)||this,o=t||{};return n._lineWidth=Number(o.lineWidth||1),n._arrowLen=Number(o.arrowLen||15),n._style=o.style||"single",n._color=o.color||"#000000",n._objectFrom=o.objectFrom||null,n._positionFrom={x:void 0===o.positionFromX?0:Number(o.positionFromX),y:void 0===o.positionFromY?0:Number(o.positionFromY)},n._objectTo=o.objectTo||null,n._positionTo={x:void 0===o.positionToX?0:Number(o.positionToX),y:void 0===o.positionToY?0:Number(o.positionToY)},n._segment=null,n._boundingShape=null,n.on(h.EvtUpdate.type,function(e){n.update()}),n.on(h.EvtGetBoundingShape.type,function(e){n._boundingShape||n.update(),n._boundingShape&&(e.shape=n._boundingShape)}),n.on(h.EvtDraw.type,function(e){if(n._segment)if("none"===n._style)e.canvas.context.strokeStyle=n._color,e.canvas.context.lineWidth=n._lineWidth,e.canvas.context.beginPath(),e.canvas.context.moveTo(n._segment.start.x,n._segment.start.y),e.canvas.context.lineTo(n._segment.end.x,n._segment.end.y),e.canvas.context.stroke();else{var t="double"===n._style;n.drawArrow(e.canvas.context,n._segment.end.x,n._segment.end.y,n._segment.start.x,n._segment.start.y,30,n._arrowLen,n._lineWidth,n._color,t)}}),n.on(d.WBGetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":e.value=n._lineWidth;break;case"arrowLen":e.value=n._arrowLen;break;case"style":e.value=n._style;break;case"color":e.value=n._color;break;case"objectFrom":e.value=n._objectFrom||"";break;case"positionFromX":e.value=n._positionFrom?n._positionFrom.x:null;break;case"positionFromY":e.value=n._positionFrom?n._positionFrom.y:null;break;case"objectTo":e.value=n._objectTo||"";break;case"positionToX":e.value=n._positionTo?n._positionTo.x:null;break;case"positionToY":e.value=n._positionTo?n._positionTo.y:null}}),n.on(d.WBSetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":n._lineWidth=Number(e.value);break;case"arrowLen":n._arrowLen=Number(e.value);break;case"style":n._style=String(e.value);break;case"color":n._color=String(e.value);break;case"objectFrom":n._objectFrom=""===e.value?null:String(e.value);break;case"positionFromX":n._positionFrom||(n._positionFrom={x:0,y:0}),n._positionFrom.x=Number(e.value);break;case"positionFromY":n._positionFrom||(n._positionFrom={x:0,y:0}),n._positionFrom.y=Number(e.value);break;case"objectTo":n._objectTo=""===e.value?null:String(e.value);break;case"positionToX":n._positionTo||(n._positionTo={x:0,y:0}),n._positionTo.x=Number(e.value);break;case"positionToY":n._positionTo||(n._positionTo={x:0,y:0}),n._positionTo.y=Number(e.value)}}),n.on(d.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[n.entityType]=e.properties[n.entityType]||{desc:n.entityType,properties:[]},e.properties[n.entityType].properties.push({name:"lineWidth",desc:"线宽",readonly:!1,type:"number",value:n._lineWidth}),e.properties[n.entityType].properties.push({name:"arrowLen",desc:"箭头长度",readonly:!1,type:"number",value:n._arrowLen}),e.properties[n.entityType].properties.push({name:"style",desc:"箭头样式",readonly:!1,type:"string",value:n._style,enum:[{value:"none",desc:"无"},{value:"single",desc:"单向箭头"},{value:"double",desc:"双向箭头"}]}),e.properties[n.entityType].properties.push({name:"color",desc:"颜色",readonly:!1,type:"color",value:n._color}),e.properties[n.entityType].properties.push({name:"objectFrom",desc:"绑定出发节点",readonly:!1,type:"string",value:n._objectFrom||""}),e.properties[n.entityType].properties.push({name:"positionFromX",desc:"出发点X坐标",readonly:!1,type:"number",value:n._positionFrom?n._positionFrom.x:null}),e.properties[n.entityType].properties.push({name:"positionFromY",desc:"出发点Y坐标",readonly:!1,type:"number",value:n._positionFrom?n._positionFrom.y:null}),e.properties[n.entityType].properties.push({name:"objectTo",desc:"绑定到达节点",readonly:!1,type:"string",value:n._objectTo||""}),e.properties[n.entityType].properties.push({name:"positionToX",desc:"到达点X坐标",readonly:!1,type:"number",value:n._positionTo?n._positionTo.x:null}),e.properties[n.entityType].properties.push({name:"positionToY",desc:"到达点Y坐标",readonly:!1,type:"number",value:n._positionTo?n._positionTo.y:null})}),n}return n(e,r),e.prototype.getSegment=function(){if(!this._positionFrom||!this._positionTo)return null;var e,t,n=this.worldTransform,o=n.transformPoint(this._positionFrom),r=n.transformPoint(this._positionTo),i={start:{x:o.x,y:o.y},end:{x:r.x,y:r.y}},a=null,s=null,c=null,l=null;if(this._objectFrom){var u=new d.WBGetObjectEvent(this._objectFrom);h.App.triggerEvent(null,u),(a=u.object||null)&&(s=a.worldTransform,i.start.x=s.e,i.start.y=s.f)}if(this._objectTo){u=new d.WBGetObjectEvent(this._objectTo);h.App.triggerEvent(null,u),(c=u.object||null)&&(l=c.worldTransform,i.end.x=l.e,i.end.y=l.f)}a&&s&&((t=(e=a.boundingShape)?h.IntersectionTestShapeSegment(e.getTransformedShape(s),i):null)&&0<t.length&&(i.start=t[0]));c&&l&&((t=(e=c.boundingShape)?h.IntersectionTestShapeSegment(e.getTransformedShape(l),i):null)&&0<t.length&&(i.end=t[0]));var p=h.Matrix2d.invert(n);return i.start=p.transformPoint(i.start),i.end=p.transformPoint(i.end),i},e.prototype.drawArrow=function(e,t,n,o,r,i,a,s,c,l){var u=180*Math.atan2(n-r,t-o)/Math.PI,p=(u+i)*Math.PI/180,h=(u-i)*Math.PI/180,d=a*Math.cos(p),f=a*Math.sin(p),y=a*Math.cos(h),v=a*Math.sin(h);e.beginPath();var m=t-d,g=n-f;e.moveTo(m,g),e.lineTo(t,n),m=t-y,g=n-v,e.lineTo(m,g),e.moveTo(t,n),e.lineTo(o,r),l&&(m=o+d,g=r+f,e.moveTo(m,g),e.lineTo(o,r),m=o+y,g=r+v,e.lineTo(m,g)),e.strokeStyle=c,e.lineWidth=s,e.stroke()},e.prototype.update=function(){if(this._segment=this.getSegment(),this._segment){var e=h.GetVector(this._segment.start,this._segment.end),t=h.VectorLength(e),n=Math.floor(this._lineWidth/2+3),o=n*e.y/t,r=-n*e.x/t;null===this._boundingShape?this._boundingShape=new h.BoundingHull:this._boundingShape.clear(),this._boundingShape.addPoint({x:this._segment.start.x+o,y:this._segment.start.y+r}),this._boundingShape.addPoint({x:this._segment.start.x-o,y:this._segment.start.y-r}),this._boundingShape.addPoint({x:this._segment.end.x-o,y:this._segment.end.y-r}),this._boundingShape.addPoint({x:this._segment.end.x+o,y:this._segment.end.y+r})}},e}(h.SceneObject);t.WBArrow=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getCreationProperties=function(){return[{name:"lineWidth",desc:"线宽",readonly:!1,type:"number",value:3},{name:"arrowLen",desc:"箭头长度",readonly:!1,type:"number",value:15},{name:"style",desc:"箭头样式",readonly:!1,type:"string",value:"single",enum:[{value:"none",desc:"无"},{value:"single",desc:"单向箭头"},{value:"double",desc:"双向箭头"}]},{name:"color",desc:"颜色",readonly:!1,type:"color",value:"#000000"}]},t.prototype._createEntity=function(e){return new r(null,e)},t}(d.WBFactory);t.WBArrowFactory=i});t(P);P.WBArrow,P.WBArrowFactory;var j=n(function(e,t){var o,n=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(o){function e(e,t){void 0===t&&(t=null);var r=o.call(this,e||void 0)||this;r._canvas=null,r._boundingShape=null,r._cp=[],r._lastMoveTime=0,r._action=!1;var n=t||{};return r._lineWidth=Number(n.lineWidth||1),r._color=n.color||"#000000",r._mode=n.mode||"draw",r._mousePosX=0,r._mousePosY=0,r._eraseSize=n.eraseSize||20,r._curveMode=n.curveMode||0,r.on(h.EvtCanvasResize.type,function(e){e.view===r.view&&r._canvas&&(r._canvas.width=e.view.canvas.width,r._canvas.height=e.view.canvas.height,r._boundingShape&&(r._boundingShape.rect={x:0,y:0,w:r._canvas.width,h:r._canvas.height}))}),r.on(h.EvtGetBoundingShape.type,function(e){null===r._boundingShape&&r.canvas&&(r._boundingShape=new h.BoundingBox({x:0,y:0,w:r.canvas.width,h:r.canvas.height})),r._boundingShape&&(e.shape=r._boundingShape)}),r.on(h.EvtHitTest.type,function(e){var t=r.canvas;if(t&&0<=e.x&&e.x<t.width&&0<=e.y&&e.y<t.height){var n=t.getContext("2d");if(n){var o=n.getImageData(e.x,e.y,1,1);o&&0<o.data[3]&&(e.result=!0)}}e.eat()}),r.on(h.EvtDraw.type,function(e){if(r.canvas){var t=r.canvas.width,n=r.canvas.height;e.canvas.context.drawImage(r.canvas,-Math.round(t*r.anchorPoint.x)-.5,-Math.round(n*r.anchorPoint.y)-.5,t,n),"erase"===r._mode&&(e.canvas.context.strokeStyle="#000000",e.canvas.context.strokeRect(Math.round(r._mousePosX-r._eraseSize/2),Math.round(r._mousePosY-r._eraseSize/2),r._eraseSize,r._eraseSize))}}),r.on(h.EvtMouseDown.type,function(e){var t=h.Matrix2d.invert(r.worldTransform).transformPoint({x:e.x,y:e.y});if(r.canvas)if("draw"===r._mode)(n=r.canvas.getContext("2d"))&&(n.lineWidth=r._lineWidth,n.strokeStyle=r._color,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(t.x+.5,t.y+.5),r._cp.length=0,r._action=!0);else if("erase"===r._mode){var n;(n=r.canvas.getContext("2d"))&&(n.clearRect(t.x-r._eraseSize/2,t.y-r._eraseSize/2,r._eraseSize,r._eraseSize),r._action=!0)}}),r.on(h.EvtMouseMove.type,function(e){if(r._mousePosX=e.x,r._mousePosY=e.y,r._action&&r.canvas){var t=h.Matrix2d.invert(r.worldTransform).transformPoint({x:e.x,y:e.y});if("draw"===r._mode)(n=r.canvas.getContext("2d"))&&(0===r._curveMode?(n.lineTo(t.x+.5,t.y+.5),n.stroke()):1===r._curveMode?1===r._cp.length?(n.quadraticCurveTo(r._cp[0].x+.5,r._cp[0].y+.5,t.x+.5,t.y+.5),n.stroke(),r._cp.length=0):(r._cp.push({x:t.x,y:t.y}),r._lastMoveTime=Date.now()):2===r._curveMode&&(2===r._cp.length?(n.bezierCurveTo(r._cp[0].x+.5,r._cp[0].y+.5,r._cp[1].x+.5,r._cp[1].y+.5,t.x+.5,t.y+.5),n.stroke(),r._cp.length=0):(r._cp.push({x:t.x,y:t.y}),r._lastMoveTime=Date.now())));else if("erase"===r._mode){var n;(n=r.canvas.getContext("2d"))&&n.clearRect(t.x-r._eraseSize/2,t.y-r._eraseSize/2,r._eraseSize,r._eraseSize)}}}),r.on(h.EvtFrame.type,function(e){"draw"===r._mode&&r._action&&(Date.now()>r._lastMoveTime+250&&r.finishDraw())}),r.on(h.EvtMouseUp.type,function(e){"draw"===r._mode&&r._action&&r.finishDraw(),r._action=!1}),r.on(d.WBGetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":e.value=r._lineWidth;break;case"color":e.value=r._color;break;case"curveMode":e.value=r._curveMode;break;case"eraseSize":e.value=r._eraseSize}}),r.on(d.WBSetPropertyEvent.type,function(e){switch(e.name){case"lineWidth":r._lineWidth=Number(e.value);break;case"color":r._color=String(e.value);break;case"curveMode":r._curveMode=Number(e.value);break;case"eraseSize":r._eraseSize=Number(e.value)}}),r.on(d.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[r.entityType]=e.properties[r.entityType]||{desc:r.entityType,properties:[]},e.properties[r.entityType].properties.push({name:"lineWidth",desc:"画笔宽度",readonly:!1,type:"number",value:r._lineWidth}),e.properties[r.entityType].properties.push({name:"color",desc:"画笔颜色",readonly:!1,type:"color",value:r._color}),e.properties[r.entityType].properties.push({name:"curveMode",desc:"平滑模式",readonly:!1,type:"number",value:r._curveMode,enum:[{value:0,desc:"无"},{value:1,desc:"二次样条"},{value:2,desc:"三次样条"}]}),e.properties[r.entityType].properties.push({name:"eraseSize",desc:"橡皮宽度",readonly:!1,type:"number",value:r._eraseSize})}),r}return n(e,o),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode!==e&&("draw"===this._mode&&this.finishDraw(),this._action=!1,this._mode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return null===this._canvas&&this.view&&(this._canvas=document.createElement("canvas"),this._canvas.style.backgroundColor="#00000000",this._canvas.width=this.view.canvas.width,this._canvas.height=this.view.canvas.height,this._boundingShape&&(this._boundingShape=new h.BoundingBox({x:0,y:0,w:this._canvas.width,h:this._canvas.height}))),this._canvas},enumerable:!0,configurable:!0}),e.prototype.finishDraw=function(){if(this.canvas&&"draw"===this._mode&&0<this._cp.length){var e=this.canvas.getContext("2d");e&&(1===this._cp.length?e.lineTo(this._cp[0].x+.5,this._cp[0].y+.5):this._cp.length&&e.quadraticCurveTo(this._cp[0].x+.5,this._cp[0].y+.5,this._cp[1].x+.5,this._cp[1].y+.5),e.stroke(),this._cp.length=0)}},e}(h.SceneObject);t.WBFreeDraw=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getCreationProperties=function(){return[{name:"lineWidth",desc:"画笔宽度",readonly:!1,type:"number",value:3},{name:"color",desc:"颜色",readonly:!1,type:"color",value:"#000000"},{name:"curveMode",desc:"平滑模式",readonly:!1,type:"number",value:0,enum:[{value:0,desc:"无"},{value:1,desc:"二次样条"},{value:2,desc:"三次样条"}]},{name:"eraseSize",desc:"橡皮宽度",readonly:!1,type:"number",value:20}]},t.prototype._createEntity=function(e){return new r(null,e)},t}(d.WBFactory);t.WBFreeDrawFactory=i});t(j);j.WBFreeDraw,j.WBFreeDrawFactory;var T=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.installFactories=function(e){e.addFactory(new x.WBLabelFactory("Label")),e.addFactory(new P.WBArrowFactory("Arrow")),e.addFactory(new j.WBFreeDrawFactory("FreeDraw"))}});t(T);T.installFactories;var k=n(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(x),t(P),t(j),t(T)});t(k);var S=n(function(e,t){var o,i=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function o(e){var t=n.call(this,o.type)||this;return t.selectIndex=e,t}return i(o,n),o.type="@WBSelect",o}(h.BaseEvent);t.WBSelectEvent=r;var a=function(e){function t(){return e.call(this,t.type)||this}return i(t,e),t.type="@WBDeselect",t}(h.BaseEvent);t.WBDeselectEvent=a;var s=function(n){function o(e){var t=n.call(this,o.type)||this;return t.objects=e,t}return i(o,n),o.type="@WBObjectSelected",o}(h.BaseEvent);t.WBObjectSelectedEvent=s;var c=function(n){function o(e){var t=n.call(this,o.type)||this;return t.objects=e,t}return i(o,n),o.type="@WBObjectMoved",o}(h.BaseEvent);t.WBObjectMovedEvent=c;var l=function(o){function r(e,t){var n=o.call(this,r.type)||this;return n.object=e,n.objects=t,n}return i(r,o),r.type="@WBObjectDeselected",r}(h.BaseEvent);t.WBObjectDeselectedEvent=l;var u=function(t){function n(e){var o=t.call(this,n.type)||this;return o.tool=e,o._selected=!1,o.on(h.EvtDraw.type,function(e){if(o._selected){var t=o.object.boundingShape;if(t){var n=t.getBoundingbox();n&&(e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.strokeRect(n.x,n.y,n.w,n.h))}}}),o.on(r.type,function(e){o._selected=!0}),o.on(a.type,function(e){o._selected=!1}),o}return i(n,t),n.type="WBSelect",n}(h.Component);t.WBSelectComponent=u;var n=function(n){function o(e){var t=n.call(this,o.toolname,e)||this;return t._selectedObjects=[],t._moving=!1,t._rangeSelecting=!1,t._mouseStartPosX=0,t._mouseStartPosY=0,t._mouseCurrentPosX=0,t._mouseCurrentPosY=0,t}return i(o,n),Object.defineProperty(o.prototype,"selectedObjects",{get:function(){return this._selectedObjects},enumerable:!0,configurable:!0}),o.prototype.activate=function(e){var r=this;n.prototype.activate.call(this,e),this._selectedObjects.length=0,this.on(h.EvtKeyDown.type,function(e){1===r._selectedObjects.length&&r._selectedObjects[0].triggerEx(e)}),this.on(h.EvtKeyUp.type,function(e){1===r._selectedObjects.length&&r._selectedObjects[0].triggerEx(e)}),this.on(h.EvtKeyPress.type,function(e){1===r._selectedObjects.length&&r._selectedObjects[0].triggerEx(e)}),this.on(h.EvtMouseDown.type,function(e){r._mouseStartPosX=e.x,r._mouseStartPosY=e.y;var t=r._wb.view;if(t){var n=t.hitObjects;1<n.length?(r.selectObject(n[0],e),r._moving=!0,r._rangeSelecting=!1):(r.deselectAll(),r._rangeSelecting=!0,r._moving=!1,r._mouseCurrentPosX=e.x,r._mouseCurrentPosY=e.y)}}),this.on(h.EvtMouseMove.type,function(e){if(r._moving){var n=e.x-r._mouseStartPosX,o=e.y-r._mouseStartPosY;r._mouseStartPosX=e.x,r._mouseStartPosY=e.y,r._selectedObjects.forEach(function(e){var t=e.translation;e.translation={x:t.x+n,y:t.y+o}})}else if(r._rangeSelecting){var t=r._wb.view;t&&t.rootNode&&(r.rangeSelectR(t.rootNode,r._mouseStartPosX,r._mouseStartPosY,e.x-r._mouseStartPosX,e.y-r._mouseStartPosY),r._mouseCurrentPosX=e.x,r._mouseCurrentPosY=e.y)}}),this.on(h.EvtMouseUp.type,function(e){r._moving&&r._selectedObjects&&0<r._selectedObjects.length&&h.App.triggerEvent(null,new c(r._selectedObjects)),r._moving=!1,r._rangeSelecting=!1}),this.on(h.EvtDraw.type,function(e){r._rangeSelecting&&(e.canvas.context.save(),e.canvas.context.setTransform(1,0,0,1,.5,.5),e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.setLineDash([6,3]),e.canvas.context.beginPath(),e.canvas.context.moveTo(r._mouseStartPosX,r._mouseStartPosY),e.canvas.context.lineTo(r._mouseCurrentPosX,r._mouseStartPosY),e.canvas.context.lineTo(r._mouseCurrentPosX,r._mouseCurrentPosY),e.canvas.context.moveTo(r._mouseStartPosX,r._mouseStartPosY),e.canvas.context.lineTo(r._mouseStartPosX,r._mouseCurrentPosY),e.canvas.context.lineTo(r._mouseCurrentPosX,r._mouseCurrentPosY),e.canvas.context.stroke(),e.canvas.context.restore())})},o.prototype.deactivate=function(){this.off(h.EvtKeyDown.type),this.off(h.EvtKeyUp.type),this.off(h.EvtKeyPress.type),this.off(h.EvtMouseDown.type),this.off(h.EvtMouseMove.type),this.off(h.EvtMouseUp.type),this.off(h.EvtDraw.type),n.prototype.deactivate.call(this)},o.prototype.activateObject=function(e){this.deactivateObject(e),e.addComponent(new u(this))},o.prototype.deactivateObject=function(e){var t=e.getComponents(u.type);t&&0<t.length&&(this.deselectObject(e),e.removeComponentsByType(u.type))},o.prototype.executeCommand=function(e){"GetSelected"===e.command&&(e.selectedObjects=this._selectedObjects)},o.prototype.selectObject=function(e,t){this._selectedObjects.indexOf(e)<0&&(!t||(h.EvtSysInfo.isMac()?t.metaDown:t.ctrlDown)||this.deselectAll(),this.selectedObjects.push(e),e.triggerEx(new r(this.selectedObjects.length)),h.App.triggerEvent(null,new s(this._selectedObjects)))},o.prototype.deselectObject=function(e){var t=this._selectedObjects.indexOf(e);0<=t&&(e.triggerEx(new a),this.selectedObjects.splice(t,1),h.App.triggerEvent(null,new l(e,this._selectedObjects)))},o.prototype.deselectAll=function(){for(;0<this.selectedObjects.length;)this.deselectObject(this.selectedObjects[this.selectedObjects.length-1])},o.prototype.rangeSelectR=function(e,r,i,a,s){var c=this;e.forEachChild(function(e){if(0===a||0===s)c.deselectObject(e);else{var t=e.boundingShape;if(t){var n=h.Matrix2d.invert(e.worldTransform),o=[n.transformPoint({x:r,y:i}),n.transformPoint({x:r,y:i+s}),n.transformPoint({x:r+a,y:i+s}),n.transformPoint({x:r+a,y:i})];h.IntersectionTestShapeHull(t,o)?c.selectObject(e,null):c.deselectObject(e)}c.rangeSelectR(e,r,i,a,s)}})},o.toolname="Select",o}(d.WBTool);t.WBSelectTool=n});t(S);S.WBSelectEvent,S.WBDeselectEvent,S.WBObjectSelectedEvent,S.WBObjectMovedEvent,S.WBObjectDeselectedEvent,S.WBSelectComponent,S.WBSelectTool;var O=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(t){function n(e){var o=t.call(this,n.type)||this;return o.tool=e,o.selected=!1,o.on(h.EvtMouseDown.type,function(e){o.tool.currentObject?o.tool.currentObject.getComponent(n.type,0).selected=!1:o.selected=!0,o.tool.selectObject(o.object,e)}),o.on(h.EvtDraw.type,function(e){if(o.selected){var t=o.object.boundingShape;if(t){var n=t.getBoundingbox();n&&(e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.strokeRect(n.x,n.y,n.w,n.h))}}}),o}return r(n,t),n.type="WBSwap",n}(h.Component);t.WBSwapComponent=i;var n=function(n){function o(e){var t=n.call(this,o.toolname,e)||this;return t._curObject=null,t}return r(o,n),Object.defineProperty(o.prototype,"currentObject",{get:function(){return this._curObject},enumerable:!0,configurable:!0}),o.prototype.activate=function(e){n.prototype.activate.call(this,e),this._curObject=null},o.prototype.deactivate=function(){this._curObject&&(this._curObject.triggerEx(new S.WBDeselectEvent),this._curObject=null),n.prototype.deactivate.call(this)},o.prototype.activateObject=function(e){this.deactivateObject(e),e.addComponent(new i(this))},o.prototype.deactivateObject=function(e){e.removeComponentsByType(i.type)},o.prototype.selectObject=function(e,t){null==this._curObject?this._curObject=e:(this._curObject!==e&&this.swapObject(this._curObject,e,200),this._curObject=null)},o.prototype.swapObject=function(e,t,n){var o=e.translation,r=t.translation;(t.getComponents(h.CoKeyframeAnimation.type)||[]).forEach(function(e){e.finish(),t.removeComponentsByType(h.CoKeyframeAnimation.type)}),t.addComponent(new h.CoKeyframeAnimation({delay:0,repeat:1,exclusive:!0,tracks:{translation:{cp:[{x:0,y:[r.x,r.y]},{x:n,y:[o.x,o.y]}],type:h.SplineType.LINEAR}}})),e.addComponent(new h.CoKeyframeAnimation({delay:0,repeat:1,exclusive:!0,tracks:{translation:{cp:[{x:0,y:[o.x,o.y]},{x:n,y:[r.x,r.y]}],type:h.SplineType.LINEAR}}}))},o.toolname="Swap",o}(d.WBTool);t.WBSwapTool=n});t(O);O.WBSwapComponent,O.WBSwapTool;var E=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function o(e){var t=n.call(this,o.toolname,e)||this;return t.options={},t._factoryProperties=[],t._creationParams={},t}return r(o,n),o.prototype.activate=function(t){var o=this;t&&(this.options=t,void 0===this._creationParams[t.createType]&&(this._creationParams[t.createType]={},this._factoryProperties=this._wb.getFactory(t.createType).getCreationProperties(),this._factoryProperties&&this._factoryProperties.forEach(function(e){o._creationParams[t.createType][e.name]=e.value}))),this.on(h.EvtMouseDown.type,function(e){var t={command:"CreateObject",type:o.options.createType,name:null};for(var n in o.options)"command"!==n&&"createType"!==n&&"type"!==n&&(t[n]=o.options[n]);t.x=e.x,t.y=e.y,t.params=o._creationParams[o.options.createType],o._wb.executeCommand(t)}),this.on(d.WBGetPropertyEvent.type,function(e){e.name in o._creationParams[o.options.createType]&&(e.value=o._creationParams[o.options.createType][e.name])}),this.on(d.WBSetPropertyEvent.type,function(e){e.name in o._creationParams[o.options.createType]&&(o._creationParams[o.options.createType][e.name]=e.value)}),this.on(d.WBGetPropertyListEvent.type,function(e){o._factoryProperties&&0<o._factoryProperties.length&&(e.properties=e.properties||{},e.properties[o.options.createType]=e.properties[o.options.createType]||{desc:o.options.createType,properties:[]},e.properties[o.options.createType].properties=o._factoryProperties)}),n.prototype.activate.call(this,t)},o.prototype.deactivate=function(){this.off(h.EvtMouseDown.type),this.options={},n.prototype.deactivate.call(this)},o.toolname="Create",o}(d.WBTool);t.WBCreateTool=n});t(E);E.WBCreateTool;var C=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function o(e){var t=n.call(this,o.toolname,e)||this;return t._createParams={lineWidth:3,arrowLen:15,style:"single",color:"#000000",objectFrom:null,positionFromX:0,positionFromY:0,objectTo:null,positionToX:0,positionToY:0},t._moving=!1,t.on(d.WBGetPropertyEvent.type,function(e){e.name in t._createParams&&(e.value=t._createParams[e.name])}),t.on(d.WBSetPropertyEvent.type,function(e){e.name in t._createParams&&(t._createParams[e.name]=e.value)}),t.on(d.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},e.properties[t.name]=e.properties[t.name]||{desc:"画笔工具",properties:[]},e.properties[t.name].properties.push({name:"lineWidth",desc:"线宽",readonly:!1,type:"number",value:t._createParams.lineWidth}),e.properties[t.name].properties.push({name:"arrowLen",desc:"箭头长度",readonly:!1,type:"number",value:t._createParams.arrowLen}),e.properties[t.name].properties.push({name:"style",desc:"箭头样式",readonly:!1,type:"string",value:t._createParams.style,enum:[{value:"none",desc:"无"},{value:"single",desc:"单向箭头"},{value:"double",desc:"双向箭头"}]}),e.properties[t.name].properties.push({name:"color",desc:"颜色",readonly:!1,type:"color",value:t._createParams.color})}),t}return r(o,n),o.prototype.activate=function(e){var r=this;n.prototype.activate.call(this,e),this._moving=!1,this.on(h.EvtMouseDown.type,function(e){var t=r._wb.view;if(t){r._moving=!0,r._createParams.objectFrom=null,r._createParams.objectTo=null,r._createParams.positionToX=e.x,r._createParams.positionToY=e.y;var n=t.hitObjects;1<n.length&&"Arrow"!==n[0].entityType?r._createParams.objectFrom=n[0]:(r._createParams.positionFromX=e.x,r._createParams.positionFromY=e.y)}}),this.on(h.EvtMouseMove.type,function(e){if(r._moving){var t=r._wb.view;if(t){var n=t.hitObjects;1<n.length&&n[0]!==r._createParams.objectFrom&&"Arrow"!==n[0].entityType?r._createParams.objectTo=n[0]:(r._createParams.objectTo=null,r._createParams.positionToX=e.x,r._createParams.positionToY=e.y)}}}),this.on(h.EvtMouseUp.type,function(e){r._moving=!1;var t=0,n=0;r._createParams.objectFrom&&r._createParams.objectTo?(r._createParams.objectFrom=r._createParams.objectFrom.entityName,r._createParams.objectTo=r._createParams.objectTo.entityName):r._createParams.objectFrom?(r._createParams.objectFrom=r._createParams.objectFrom.entityName,t=r._createParams.positionToX,n=r._createParams.positionToY,r._createParams.positionToX=0,r._createParams.positionToY=0):(r._createParams.objectTo?(r._createParams.objectTo=r._createParams.objectTo.entityName,t=r._createParams.positionFromX,n=r._createParams.positionFromY):(t=r._createParams.positionFromX,n=r._createParams.positionFromY,r._createParams.positionToX-=t,r._createParams.positionToY-=n),r._createParams.positionFromX=0,r._createParams.positionFromY=0);var o={command:"CreateObject",type:"Arrow",name:null,x:t,y:n,params:r._createParams};r._wb.executeCommand(o)}),this.on(h.EvtDraw.type,function(e){if(r._moving){if(e.canvas.context.save(),e.canvas.context.setTransform(1,0,0,1,.5,.5),e.canvas.context.strokeStyle="#000",e.canvas.context.lineWidth=1,e.canvas.context.setLineDash([6,3]),e.canvas.context.beginPath(),r._createParams.objectFrom){var t=r._createParams.objectFrom.worldTransform;e.canvas.context.moveTo(t.e,t.f)}else e.canvas.context.moveTo(r._createParams.positionFromX,r._createParams.positionFromY);if(r._createParams.objectTo){t=r._createParams.objectTo.worldTransform;e.canvas.context.lineTo(t.e,t.f)}else e.canvas.context.lineTo(r._createParams.positionToX,r._createParams.positionToY);e.canvas.context.stroke(),e.canvas.context.restore()}})},o.prototype.deactivate=function(){this.off(h.EvtMouseDown.type),this.off(h.EvtMouseMove.type),this.off(h.EvtMouseUp.type),n.prototype.deactivate.call(this)},o.prototype.activateObject=function(e){n.prototype.activateObject.call(this,e)},o.prototype.deactivateObject=function(e){n.prototype.deactivateObject.call(this,e)},o.prototype.executeCommand=function(e){},o.toolname="Connect",o}(d.WBTool);t.WBConnectTool=n});t(C);C.WBConnectTool;var B=n(function(e,t){var o,n=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(o){function t(e){var n=o.call(this,t.toolname,e)||this;return n._freedrawNode=null,n._mode="draw",n._paramsDraw={color:"#000",lineWidth:2,curveMode:0},n._paramsErase={eraseSize:20},n.on(d.WBGetPropertyEvent.type,function(e){var t=null;"draw"===n._mode?t=n._paramsDraw:"erase"===n._mode&&(t=n._paramsErase),t&&e.name in t&&(e.value=t[e.name])}),n.on(d.WBSetPropertyEvent.type,function(e){var t=null;"draw"===n._mode?t=n._paramsDraw:"erase"===n._mode&&(t=n._paramsErase),t&&e.name in t&&(t[e.name]=e.value,n.applyProperty(e.name,e.value))}),n.on(d.WBGetPropertyListEvent.type,function(e){e.properties=e.properties||{},"draw"===n._mode?(e.properties[n.name]=e.properties[n.name]||{desc:"画笔工具",properties:[]},e.properties[n.name].properties.push({name:"color",desc:"画笔颜色",readonly:!1,type:"color",value:n._paramsDraw.color}),e.properties[n.name].properties.push({name:"lineWidth",desc:"画笔粗细",readonly:!1,type:"number",value:n._paramsDraw.lineWidth}),e.properties[n.name].properties.push({name:"curveMode",desc:"平滑模式",readonly:!1,type:"number",value:n._paramsDraw.curveMode,enum:[{value:0,desc:"无"},{value:1,desc:"二次样条"},{value:2,desc:"三次样条"}]})):"erase"===n._mode&&(e.properties[n.name]=e.properties[n.name]||{desc:"橡皮工具",properties:[]},e.properties[n.name].properties.push({name:"eraseSize",desc:"橡皮大小",readonly:!1,type:"number",value:n._paramsErase.eraseSize}))}),n}return n(t,o),t.prototype.activate=function(e){if(e&&(this._mode=e.mode||"draw"),this._freedrawNode=this.findFreedrawNode(),!this._freedrawNode){var t={command:"CreateObject",type:"FreeDraw",name:null,x:0,y:0};this._wb.executeCommand(t),this._freedrawNode=t.objectCreated}this._freedrawNode&&(this._freedrawNode.mode=this._mode,this._freedrawNode.setCapture(),this.applyProperties(this._paramsDraw),this.applyProperties(this._paramsErase),o.prototype.activate.call(this,e))},t.prototype.deactivate=function(){this._freedrawNode&&(this._freedrawNode.releaseCapture(),this._freedrawNode.mode="none",this._freedrawNode=null),o.prototype.deactivate.call(this)},t.prototype.activateObject=function(e){o.prototype.activateObject.call(this,e)},t.prototype.deactivateObject=function(e){o.prototype.deactivateObject.call(this,e)},t.prototype.applyProperty=function(e,t){this._freedrawNode&&this._freedrawNode.triggerEx(new d.WBSetPropertyEvent(e,t))},t.prototype.applyProperties=function(e){for(var t in e)this.applyProperty(t,e[t])},t.prototype.findFreedrawNode=function(e){var t=this._wb.view;if(t){var n=e||t.rootNode;if(n){if("FreeDraw"===n.entityType)return n;for(var o=0;o<n.numChildren;o++){var r=this.findFreedrawNode(n.childAt(o));if(r)return r}}}return null},t.toolname="HandWriting",t}(d.WBTool);t.WBHandWritingTool=r});t(B);B.WBHandWritingTool;var M=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.installTools=function(e){e.addTool(new S.WBSelectTool(e)),e.addTool(new O.WBSwapTool(e)),e.addTool(new E.WBCreateTool(e)),e.addTool(new C.WBConnectTool(e)),e.addTool(new B.WBHandWritingTool(e))}});t(M);M.installTools;var W=n(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(S),t(O),t(E),t(C),t(B),t(M)});t(W);var D=n(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(w),t(k),t(W),t(c),t(d)});t(D);var A=n(function(e,t){var o,r=Q&&Q.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var n=function(n){function o(e){var t=n.call(this,o.type)||this;return t.cmd=e,t}return r(o,n),o.type="@postCommand",o}(h.BaseEvent);t.EvtPostCommand=n;var i=function(n){function o(e){var t=n.call(this,o.type)||this;return t.cmd=e,t}return r(o,n),o.type="@receiveCommand",o}(h.BaseEvent);t.EvtReceiveCommand=i;var a=function(t){function e(){var e=t.call(this)||this;return e._started=!1,e}return r(e,t),e.prototype.start=function(){!this._started&&this._start()&&(this._started=!0)},e.prototype.stop=function(){this._started&&this._stop()&&(this._started=!1)},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e}(h.EventObserver),s=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype._start=function(){return this.on(n.type,function(e){e.cmd&&h.App.triggerEvent(null,new i(e.cmd))}),!0},t.prototype._stop=function(){return this.off(n.type),!0},t}(a);t.LocalCommandServer=s;var c=function(o){function e(e,t){var n=o.call(this)||this;return n._host=e,n._port=t,n._socket=null,n}return r(e,o),e.prototype._start=function(){var t=this;return this._socket=l(this._host+":"+this._port,{transports:["websocket"]}),this._socket.on("connect",function(){t.onConnect()}),this._socket.on("event",function(e){t.onEvent(e)}),this._socket.on("disconnect",function(){t.onDisconnect()}),!0},e.prototype._stop=function(){return this._socket&&this._socket.close(),!0},e.prototype.onConnect=function(){console.log("connected")},e.prototype.onEvent=function(e){console.log("event")},e.prototype.onDisconnect=function(){console.log("disconnect")},e}(a);t.SocketCommandServer=c});t(A);A.EvtPostCommand,A.EvtReceiveCommand,A.LocalCommandServer,A.SocketCommandServer;var F=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.init=function(e,t){new A.SocketCommandServer(e,t).start();var n=new D.WhiteBoard(document.querySelector("#playground-canvas"),!0);D.installTools(n),D.installFactories(n);var o=document.querySelector("#tool-toolbox"),r=document.querySelector("#op-toolbox"),i=document.querySelector("#object-propgrid"),a=document.querySelector("#tool-propgrid"),s=new D.WBEditor(n,D.WBDefaultToolSet,o,r,i,a);n.on(D.WBObjectSelectedEvent.type,function(e){1===e.objects.length?s.objectPropertyGrid.loadObjectProperties(e.objects[0]):s.objectPropertyGrid.loadPageProperties()}),n.on(D.WBObjectDeselectedEvent.type,function(e){1===e.objects.length?s.objectPropertyGrid.loadObjectProperties(e.objects[0]):s.objectPropertyGrid.loadPageProperties()}),n.on(D.WBObjectMovedEvent.type,function(e){s.objectPropertyGrid.reloadObjectProperties()}),n.on(D.WBToolActivateEvent.type,function(e){s.toolPropertyGrid.loadToolProperties(e.tool),e.tool.name===D.WBSelectTool.toolname&&s.objectPropertyGrid.loadPageProperties()}),n.on(D.WBToolDeactivateEvent.type,function(e){s.toolPropertyGrid.clear(),e.tool.name===D.WBSelectTool.toolname&&s.objectPropertyGrid.loadPageProperties()}),h.App.run()}}),I=t(F),L=F.init;e.default=I,e.init=L,Object.defineProperty(e,"__esModule",{value:!0})});
